<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ComponentAction.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">sonarqube</a> &gt; <a href="index.source.html" class="el_package">org.sonar.server.measure.ws</a> &gt; <span class="el_source">ComponentAction.java</span></div><h1>ComponentAction.java</h1><pre class="source lang-java linenums">/*
 * SonarQube
 * Copyright (C) 2009-2025 SonarSource SA
 * mailto:info AT sonarsource DOT com
 *
 * This program is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 3 of the License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public License
 * along with this program; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
 */
package org.sonar.server.measure.ws;

import com.google.common.collect.ImmutableSortedSet;
import java.util.Collection;
import java.util.HashSet;
import java.util.List;
import java.util.Optional;
import java.util.Set;
import java.util.stream.Collectors;
import javax.annotation.CheckForNull;
import javax.annotation.Nullable;
import org.sonar.api.server.ws.Change;
import org.sonar.api.server.ws.Request;
import org.sonar.api.server.ws.Response;
import org.sonar.api.server.ws.WebService;
import org.sonar.db.DbClient;
import org.sonar.db.DbSession;
import org.sonar.db.component.BranchDto;
import org.sonar.db.component.ComponentDto;
import org.sonar.db.component.ComponentQualifiers;
import org.sonar.db.component.SnapshotDto;
import org.sonar.db.measure.MeasureDto;
import org.sonar.db.metric.MetricDto;
import org.sonar.db.metric.MetricDtoFunctions;
import org.sonar.db.permission.GlobalPermission;
import org.sonar.db.permission.ProjectPermission;
import org.sonar.server.component.ComponentFinder;
import org.sonar.server.exceptions.NotFoundException;
import org.sonar.server.user.UserSession;
import org.sonarqube.ws.Measures;
import org.sonarqube.ws.Measures.ComponentWsResponse;

import static java.lang.String.format;
import static java.util.Collections.emptyMap;
import static java.util.Collections.singletonMap;
import static org.sonar.db.metric.RemovedMetricConverter.withRemovedMetricAlias;
import static org.sonar.server.component.ws.MeasuresWsParameters.ACTION_COMPONENT;
import static org.sonar.server.component.ws.MeasuresWsParameters.ADDITIONAL_METRICS;
import static org.sonar.server.component.ws.MeasuresWsParameters.ADDITIONAL_PERIOD;
import static org.sonar.server.component.ws.MeasuresWsParameters.PARAM_ADDITIONAL_FIELDS;
import static org.sonar.server.component.ws.MeasuresWsParameters.PARAM_BRANCH;
import static org.sonar.server.component.ws.MeasuresWsParameters.PARAM_COMPONENT;
import static org.sonar.server.component.ws.MeasuresWsParameters.PARAM_METRIC_KEYS;
import static org.sonar.server.component.ws.MeasuresWsParameters.PARAM_PULL_REQUEST;
import static org.sonar.server.exceptions.BadRequestException.checkRequest;
import static org.sonar.server.measure.ws.ComponentDtoToWsComponent.componentDtoToWsComponent;
import static org.sonar.server.measure.ws.ComponentResponseCommon.addMetricToResponseIncludingRenamedMetric;
import static org.sonar.server.measure.ws.MeasuresWsParametersBuilder.createAdditionalFieldsParameter;
import static org.sonar.server.measure.ws.MeasuresWsParametersBuilder.createMetricKeysParameter;
import static org.sonar.server.measure.ws.SnapshotDtoToWsPeriod.snapshotToWsPeriods;
import static org.sonar.server.user.AbstractUserSession.insufficientPrivilegesException;
import static org.sonar.server.ws.KeyExamples.KEY_BRANCH_EXAMPLE_001;
import static org.sonar.server.ws.KeyExamples.KEY_PROJECT_EXAMPLE_001;
import static org.sonar.server.ws.KeyExamples.KEY_PULL_REQUEST_EXAMPLE_001;
import static org.sonar.server.ws.WsUtils.writeProtobuf;

public class ComponentAction implements MeasuresWsAction {
<span class="fc" id="L77">  private static final Set&lt;String&gt; QUALIFIERS_ELIGIBLE_FOR_BEST_VALUE = ImmutableSortedSet.of(ComponentQualifiers.FILE, ComponentQualifiers.UNIT_TEST_FILE);</span>

  private final DbClient dbClient;
  private final ComponentFinder componentFinder;
  private final UserSession userSession;

<span class="fc" id="L83">  public ComponentAction(DbClient dbClient, ComponentFinder componentFinder, UserSession userSession) {</span>
<span class="fc" id="L84">    this.dbClient = dbClient;</span>
<span class="fc" id="L85">    this.componentFinder = componentFinder;</span>
<span class="fc" id="L86">    this.userSession = userSession;</span>
<span class="fc" id="L87">  }</span>

  @Override
  public void define(WebService.NewController context) {
<span class="fc" id="L91">    WebService.NewAction action = context.createAction(ACTION_COMPONENT)</span>
<span class="fc" id="L92">      .setDescription(&quot;Return component with specified measures.&lt;br&gt;&quot; +</span>
          &quot;Requires one of the following permissions:&quot; +
          &quot;&lt;ul&gt;&quot; +
          &quot;&lt;li&gt;'Browse' on the project of the specified component&lt;/li&gt;&quot; +
          &quot;&lt;li&gt;'Execute Analysis' on the project of the specified component&lt;/li&gt;&quot; +
          &quot;&lt;/ul&gt;&quot;)
<span class="fc" id="L98">      .setResponseExample(getClass().getResource(&quot;component-example.json&quot;))</span>
<span class="fc" id="L99">      .setSince(&quot;5.4&quot;)</span>
<span class="fc" id="L100">      .setChangelog(</span>
<span class="fc" id="L101">        new Change(&quot;2025.4&quot;, format(</span>
          &quot;The following SCA metrics are available on licensed enterprise/datacenter editions with SCA enabled: %s&quot;,
<span class="fc" id="L103">          MeasuresWsModule.getNewScaMetricsInSonarQube202504())),</span>
        new Change(&quot;2025.2&quot;, &quot;The 'Execute Analysis' permission also allows to access the endpoint&quot;),
<span class="fc" id="L105">        new Change(&quot;10.8&quot;, format(&quot;The following metrics are not deprecated anymore: %s&quot;,</span>
<span class="fc" id="L106">          MeasuresWsModule.getUndeprecatedMetricsinSonarQube108())),</span>
<span class="fc" id="L107">        new Change(&quot;10.8&quot;, String.format(&quot;Added new accepted values for the 'metricKeys' param: %s&quot;,</span>
<span class="fc" id="L108">          MeasuresWsModule.getNewMetricsInSonarQube108())),</span>
<span class="fc" id="L109">        new Change(&quot;10.8&quot;, String.format(&quot;The metrics %s are now deprecated. Use 'software_quality_maintainability_issues', &quot; +</span>
          &quot;'software_quality_reliability_issues', 'software_quality_security_issues', 'new_software_quality_maintainability_issues', &quot; +
          &quot;'new_software_quality_reliability_issues', 'new_software_quality_security_issues' instead.&quot;,
<span class="fc" id="L112">          MeasuresWsModule.getDeprecatedMetricsInSonarQube108())),</span>
<span class="fc" id="L113">        new Change(&quot;10.7&quot;, &quot;Added new accepted values for the 'metricKeys' param: %s&quot;.formatted(MeasuresWsModule.getNewMetricsInSonarQube107())),</span>
<span class="fc" id="L114">        new Change(&quot;10.5&quot;, String.format(&quot;The metrics %s are now deprecated &quot; +</span>
          &quot;without exact replacement. Use 'maintainability_issues', 'reliability_issues' and 'security_issues' instead.&quot;,
<span class="fc" id="L116">          MeasuresWsModule.getDeprecatedMetricsInSonarQube105())),</span>
        new Change(&quot;10.5&quot;, &quot;Added new accepted values for the 'metricKeys' param: 'new_maintainability_issues', 'new_reliability_issues', 'new_security_issues'&quot;),
<span class="fc" id="L118">        new Change(&quot;10.4&quot;, String.format(&quot;The metrics %s are now deprecated &quot; +</span>
          &quot;without exact replacement. Use 'maintainability_issues', 'reliability_issues' and 'security_issues' instead.&quot;,
<span class="fc" id="L120">          MeasuresWsModule.getDeprecatedMetricsInSonarQube104())),</span>
        new Change(&quot;10.4&quot;, &quot;Added new accepted values for the 'metricKeys' param: 'maintainability_issues', 'reliability_issues', 'security_issues'&quot;),
        new Change(&quot;10.4&quot;, &quot;The metrics 'open_issues', 'reopened_issues' and 'confirmed_issues' are now deprecated in the response. Consume 'violations' instead.&quot;),
        new Change(&quot;10.4&quot;, &quot;The use of 'open_issues', 'reopened_issues' and 'confirmed_issues' values in 'metricKeys' param are now deprecated. Use 'violations' instead.&quot;),
        new Change(&quot;10.4&quot;, &quot;The metric 'wont_fix_issues' is now deprecated in the response. Consume 'accepted_issues' instead.&quot;),
        new Change(&quot;10.4&quot;, &quot;The use of 'wont_fix_issues' value in 'metricKeys' param is now deprecated. Use 'accepted_issues' instead.&quot;),
        new Change(&quot;10.4&quot;, &quot;Added new accepted value for the 'metricKeys' param: 'accepted_issues'.&quot;),
<span class="fc" id="L127">        new Change(&quot;10.1&quot;, String.format(&quot;The use of module keys in parameter '%s' is removed&quot;, PARAM_COMPONENT)),</span>
<span class="fc" id="L128">        new Change(&quot;10.0&quot;, format(&quot;The use of the following metrics in 'metricKeys' parameter is not deprecated anymore: %s&quot;,</span>
<span class="fc" id="L129">          MeasuresWsModule.getDeprecatedMetricsInSonarQube93())),</span>
        new Change(&quot;10.0&quot;, &quot;the response field periods under measures field is removed.&quot;),
        new Change(&quot;10.0&quot;, &quot;the option `periods` of 'additionalFields' request field is removed.&quot;),
        new Change(&quot;9.3&quot;, &quot;When the new code period is set to 'reference branch', the response field 'date' under the 'period' field has been removed&quot;),
<span class="fc" id="L133">        new Change(&quot;9.3&quot;, format(&quot;The use of the following metrics in 'metricKeys' parameter is deprecated: %s&quot;,</span>
<span class="fc" id="L134">          MeasuresWsModule.getDeprecatedMetricsInSonarQube93())),</span>
        new Change(&quot;8.8&quot;, &quot;deprecated response field 'id' has been removed&quot;),
        new Change(&quot;8.8&quot;, &quot;deprecated response field 'refId' has been removed.&quot;),
        new Change(&quot;8.1&quot;, &quot;the response field periods under measures field is deprecated. Use period instead.&quot;),
        new Change(&quot;8.1&quot;, &quot;the response field periods is deprecated. Use period instead.&quot;),
<span class="fc" id="L139">        new Change(&quot;7.6&quot;, format(&quot;The use of module keys in parameter '%s' is deprecated&quot;, PARAM_COMPONENT)),</span>
        new Change(&quot;6.6&quot;, &quot;the response field 'id' is deprecated. Use 'key' instead.&quot;),
        new Change(&quot;6.6&quot;, &quot;the response field 'refId' is deprecated. Use 'refKey' instead.&quot;))
<span class="fc" id="L142">      .setHandler(this);</span>

<span class="fc" id="L144">    action.createParam(PARAM_COMPONENT)</span>
<span class="fc" id="L145">      .setDescription(&quot;Component key&quot;)</span>
<span class="fc" id="L146">      .setRequired(true)</span>
<span class="fc" id="L147">      .setExampleValue(KEY_PROJECT_EXAMPLE_001);</span>

<span class="fc" id="L149">    action.createParam(PARAM_BRANCH)</span>
<span class="fc" id="L150">      .setDescription(&quot;Branch key. Not available in the community edition.&quot;)</span>
<span class="fc" id="L151">      .setExampleValue(KEY_BRANCH_EXAMPLE_001)</span>
<span class="fc" id="L152">      .setSince(&quot;6.6&quot;);</span>

<span class="fc" id="L154">    action.createParam(PARAM_PULL_REQUEST)</span>
<span class="fc" id="L155">      .setDescription(&quot;Pull request id. Not available in the community edition.&quot;)</span>
<span class="fc" id="L156">      .setExampleValue(KEY_PULL_REQUEST_EXAMPLE_001)</span>
<span class="fc" id="L157">      .setSince(&quot;7.1&quot;);</span>

<span class="fc" id="L159">    createMetricKeysParameter(action);</span>
<span class="fc" id="L160">    createAdditionalFieldsParameter(action);</span>
<span class="fc" id="L161">  }</span>

  @Override
  public void handle(Request request, Response response) throws Exception {
<span class="fc" id="L165">    ComponentWsResponse componentWsResponse = doHandle(toComponentWsRequest(request));</span>
<span class="fc" id="L166">    writeProtobuf(componentWsResponse, request, response);</span>
<span class="fc" id="L167">  }</span>

  private ComponentWsResponse doHandle(ComponentRequest request) {
<span class="fc" id="L170">    try (DbSession dbSession = dbClient.openSession(false)) {</span>
<span class="fc" id="L171">      String branch = request.getBranch();</span>
<span class="fc" id="L172">      String pullRequest = request.getPullRequest();</span>
<span class="fc" id="L173">      ComponentDto component = loadComponent(dbSession, request, branch, pullRequest);</span>
<span class="fc" id="L174">      checkPermissions(component);</span>
<span class="fc" id="L175">      SnapshotDto analysis = dbClient.snapshotDao().selectLastAnalysisByRootComponentUuid(dbSession, component.branchUuid()).orElse(null);</span>

<span class="fc" id="L177">      List&lt;MetricDto&gt; metrics = searchMetrics(dbSession, new HashSet&lt;&gt;(withRemovedMetricAlias(request.getMetricKeys())));</span>
<span class="fc" id="L178">      MeasureDto measureDto = searchMeasures(dbSession, component, metrics);</span>

<span class="fc" id="L180">      Measures.Period period = snapshotToWsPeriods(analysis).orElse(null);</span>
<span class="fc" id="L181">      return buildResponse(dbSession, request, component, measureDto, metrics, period, request.getMetricKeys());</span>
    }
  }

  public List&lt;MetricDto&gt; searchMetrics(DbSession dbSession, Set&lt;String&gt; metricKeys) {
<span class="fc" id="L186">    List&lt;MetricDto&gt; metrics = dbClient.metricDao().selectByKeys(dbSession, metricKeys);</span>
<span class="fc bfc" id="L187" title="All 2 branches covered.">    if (metrics.size() &lt; metricKeys.size()) {</span>
<span class="fc" id="L188">      Set&lt;String&gt; foundMetricKeys = metrics.stream().map(MetricDto::getKey).collect(Collectors.toSet());</span>
<span class="fc bfc" id="L189" title="All 2 branches covered.">      Set&lt;String&gt; missingMetricKeys = metricKeys.stream().filter(m -&gt; !foundMetricKeys.contains(m)).collect(Collectors.toSet());</span>
<span class="fc" id="L190">      throw new NotFoundException(format(&quot;The following metric keys are not found: %s&quot;, String.join(&quot;, &quot;, missingMetricKeys)));</span>
    }

<span class="fc" id="L193">    return metrics;</span>
  }

  @CheckForNull
  private MeasureDto searchMeasures(DbSession dbSession, ComponentDto component, Collection&lt;MetricDto&gt; metrics) {
<span class="fc" id="L198">    MeasureDto measureDto = dbClient.measureDao().selectByComponentUuid(dbSession, component.uuid()).orElse(null);</span>
<span class="fc" id="L199">    addBestValuesToMeasures(measureDto, component, metrics);</span>
<span class="fc" id="L200">    return measureDto;</span>
  }

  /**
   * Conditions for best value measure:
   * &lt;ul&gt;
   * &lt;li&gt;component is a production file or test file&lt;/li&gt;
   * &lt;li&gt;metric is optimized for best value&lt;/li&gt;
   * &lt;/ul&gt;
   */
  private static void addBestValuesToMeasures(@Nullable MeasureDto measureDto, ComponentDto component, Collection&lt;MetricDto&gt; metrics) {
<span class="fc bfc" id="L211" title="All 4 branches covered.">    if (measureDto == null || !QUALIFIERS_ELIGIBLE_FOR_BEST_VALUE.contains(component.qualifier())) {</span>
<span class="fc" id="L212">      return;</span>
    }

<span class="fc" id="L215">    metrics.stream()</span>
<span class="fc" id="L216">      .filter(MetricDtoFunctions.isOptimizedForBestValue())</span>
<span class="fc" id="L217">      .forEach(metricWithBestValue -&gt; {</span>
<span class="fc" id="L218">        String metricKey = metricWithBestValue.getKey();</span>
<span class="fc bfc" id="L219" title="All 2 branches covered.">        if (!measureDto.getMetricValues().containsKey(metricKey)) {</span>
<span class="fc" id="L220">          measureDto.addValue(metricKey, metricWithBestValue.getBestValue());</span>
        }
<span class="fc" id="L222">      });</span>
<span class="fc" id="L223">  }</span>

  private ComponentDto loadComponent(DbSession dbSession, ComponentRequest request, @Nullable String branch, @Nullable String pullRequest) {
<span class="fc" id="L226">    String componentKey = request.getComponent();</span>
<span class="pc bpc" id="L227" title="1 of 2 branches missed.">    checkRequest(componentKey != null, &quot;The '%s' parameter is missing&quot;, PARAM_COMPONENT);</span>
<span class="fc" id="L228">    return componentFinder.getByKeyAndOptionalBranchOrPullRequest(dbSession, componentKey, branch, pullRequest);</span>
  }

  private Optional&lt;RefComponent&gt; getReference(DbSession dbSession, ComponentDto component) {
<span class="fc" id="L232">    String copyComponentUuid = component.getCopyComponentUuid();</span>
<span class="fc bfc" id="L233" title="All 2 branches covered.">    if (copyComponentUuid == null) {</span>
<span class="fc" id="L234">      return Optional.empty();</span>
    }

<span class="fc" id="L237">    Optional&lt;ComponentDto&gt; refComponent = dbClient.componentDao().selectByUuid(dbSession, copyComponentUuid);</span>
<span class="pc bpc" id="L238" title="1 of 2 branches missed.">    if (refComponent.isEmpty()) {</span>
<span class="nc" id="L239">      return Optional.empty();</span>
    }
<span class="fc" id="L241">    Optional&lt;BranchDto&gt; refBranch = dbClient.branchDao().selectByUuid(dbSession, refComponent.get().branchUuid());</span>
<span class="fc" id="L242">    return refBranch.map(rb -&gt; new RefComponent(rb, refComponent.get()));</span>
  }

  private ComponentWsResponse buildResponse(DbSession dbSession, ComponentRequest request, ComponentDto component,
    @Nullable MeasureDto measureDto, Collection&lt;MetricDto&gt; metrics, @Nullable Measures.Period period, Collection&lt;String&gt; requestedMetrics) {

<span class="fc" id="L248">    ComponentWsResponse.Builder response = ComponentWsResponse.newBuilder();</span>

<span class="fc" id="L250">    RefComponent reference = getReference(dbSession, component).orElse(null);</span>
<span class="fc bfc" id="L251" title="All 2 branches covered.">    if (reference != null) {</span>
<span class="fc" id="L252">      BranchDto refBranch = reference.getRefBranch();</span>
<span class="fc" id="L253">      ComponentDto refComponent = reference.getComponent();</span>
<span class="fc" id="L254">      response.setComponent(componentDtoToWsComponent(component, measureDto, singletonMap(refComponent.uuid(), refComponent),</span>
<span class="pc bpc" id="L255" title="1 of 2 branches missed.">        refBranch.isMain() ? null : refBranch.getBranchKey(), null, metrics, requestedMetrics));</span>
<span class="fc" id="L256">    } else {</span>
<span class="fc" id="L257">      boolean isMainBranch = dbClient.branchDao().selectByUuid(dbSession, component.branchUuid()).map(BranchDto::isMain).orElse(true);</span>
<span class="fc bfc" id="L258" title="All 2 branches covered.">      response.setComponent(componentDtoToWsComponent(component, measureDto, emptyMap(), isMainBranch ? null : request.getBranch(),</span>
<span class="fc" id="L259">        request.getPullRequest(), metrics, requestedMetrics));</span>
    }

<span class="fc" id="L262">    setAdditionalFields(request, metrics, period, response, requestedMetrics);</span>

<span class="fc" id="L264">    return response.build();</span>
  }

  private static void setAdditionalFields(ComponentRequest request, Collection&lt;MetricDto&gt; metrics, @Nullable Measures.Period period,
    ComponentWsResponse.Builder response, Collection&lt;String&gt; requestedMetrics) {
<span class="fc" id="L269">    List&lt;String&gt; additionalFields = request.getAdditionalFields();</span>
<span class="fc bfc" id="L270" title="All 2 branches covered.">    if (additionalFields != null) {</span>
<span class="pc bpc" id="L271" title="1 of 2 branches missed.">      if (additionalFields.contains(ADDITIONAL_METRICS)) {</span>
<span class="fc bfc" id="L272" title="All 2 branches covered.">        for (MetricDto metricDto : metrics) {</span>
<span class="fc" id="L273">          addMetricToResponseIncludingRenamedMetric(metric -&gt; response.getMetricsBuilder().addMetrics(metric), requestedMetrics, metricDto);</span>
<span class="fc" id="L274">        }</span>
      }

<span class="fc bfc" id="L277" title="All 4 branches covered.">      if (additionalFields.contains(ADDITIONAL_PERIOD) &amp;&amp; period != null) {</span>
<span class="fc" id="L278">        response.setPeriod(period);</span>
      }
    }
<span class="fc" id="L281">  }</span>

  private static ComponentRequest toComponentWsRequest(Request request) {
<span class="fc" id="L284">    ComponentRequest componentRequest = new ComponentRequest()</span>
<span class="fc" id="L285">      .setComponent(request.mandatoryParam(PARAM_COMPONENT))</span>
<span class="fc" id="L286">      .setBranch(request.param(PARAM_BRANCH))</span>
<span class="fc" id="L287">      .setPullRequest(request.param(PARAM_PULL_REQUEST))</span>
<span class="fc" id="L288">      .setAdditionalFields(request.paramAsStrings(PARAM_ADDITIONAL_FIELDS))</span>
<span class="fc" id="L289">      .setMetricKeys(request.mandatoryParamAsStrings(PARAM_METRIC_KEYS));</span>
<span class="fc bfc" id="L290" title="All 2 branches covered.">    checkRequest(!componentRequest.getMetricKeys().isEmpty(), &quot;At least one metric key must be provided&quot;);</span>
<span class="fc" id="L291">    return componentRequest;</span>
  }

  private void checkPermissions(ComponentDto baseComponent) {
<span class="fc bfc" id="L295" title="All 2 branches covered.">    if (!userSession.hasComponentPermission(ProjectPermission.USER, baseComponent) &amp;&amp;</span>
<span class="fc bfc" id="L296" title="All 2 branches covered.">      !userSession.hasComponentPermission(ProjectPermission.SCAN, baseComponent) &amp;&amp;</span>
<span class="fc bfc" id="L297" title="All 2 branches covered.">      !userSession.hasPermission(GlobalPermission.SCAN)) {</span>
<span class="fc" id="L298">      throw insufficientPrivilegesException();</span>
    }
<span class="fc" id="L300">  }</span>

<span class="fc" id="L302">  private static class ComponentRequest {</span>
<span class="fc" id="L303">    private String component = null;</span>
<span class="fc" id="L304">    private String branch = null;</span>
<span class="fc" id="L305">    private String pullRequest = null;</span>
<span class="fc" id="L306">    private List&lt;String&gt; metricKeys = null;</span>
<span class="fc" id="L307">    private List&lt;String&gt; additionalFields = null;</span>

    private String getComponent() {
<span class="fc" id="L310">      return component;</span>
    }

    private ComponentRequest setComponent(@Nullable String component) {
<span class="fc" id="L314">      this.component = component;</span>
<span class="fc" id="L315">      return this;</span>
    }

    @CheckForNull
    private String getBranch() {
<span class="fc" id="L320">      return branch;</span>
    }

    private ComponentRequest setBranch(@Nullable String branch) {
<span class="fc" id="L324">      this.branch = branch;</span>
<span class="fc" id="L325">      return this;</span>
    }

    @CheckForNull
    public String getPullRequest() {
<span class="fc" id="L330">      return pullRequest;</span>
    }

    public ComponentRequest setPullRequest(@Nullable String pullRequest) {
<span class="fc" id="L334">      this.pullRequest = pullRequest;</span>
<span class="fc" id="L335">      return this;</span>
    }

    private List&lt;String&gt; getMetricKeys() {
<span class="fc" id="L339">      return metricKeys;</span>
    }

    private ComponentRequest setMetricKeys(@Nullable List&lt;String&gt; metricKeys) {
<span class="fc" id="L343">      this.metricKeys = metricKeys;</span>
<span class="fc" id="L344">      return this;</span>
    }

    @CheckForNull
    private List&lt;String&gt; getAdditionalFields() {
<span class="fc" id="L349">      return additionalFields;</span>
    }

    private ComponentRequest setAdditionalFields(@Nullable List&lt;String&gt; additionalFields) {
<span class="fc" id="L353">      this.additionalFields = additionalFields;</span>
<span class="fc" id="L354">      return this;</span>
    }
  }

  private static class RefComponent {

    private final BranchDto refBranch;
    private final ComponentDto component;

<span class="fc" id="L363">    public RefComponent(BranchDto refBranch, ComponentDto component) {</span>
<span class="fc" id="L364">      this.refBranch = refBranch;</span>
<span class="fc" id="L365">      this.component = component;</span>
<span class="fc" id="L366">    }</span>

    public BranchDto getRefBranch() {
<span class="fc" id="L369">      return refBranch;</span>
    }

    public ComponentDto getComponent() {
<span class="fc" id="L373">      return component;</span>
    }
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>