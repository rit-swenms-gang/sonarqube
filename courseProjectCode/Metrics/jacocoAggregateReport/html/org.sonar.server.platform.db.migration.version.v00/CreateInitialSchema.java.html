<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CreateInitialSchema.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">sonarqube</a> &gt; <a href="index.source.html" class="el_package">org.sonar.server.platform.db.migration.version.v00</a> &gt; <span class="el_source">CreateInitialSchema.java</span></div><h1>CreateInitialSchema.java</h1><pre class="source lang-java linenums">/*
 * SonarQube
 * Copyright (C) 2009-2025 SonarSource SA
 * mailto:info AT sonarsource DOT com
 *
 * This program is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 3 of the License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public License
 * along with this program; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
 */
package org.sonar.server.platform.db.migration.version.v00;

import java.sql.SQLException;
import org.sonar.db.Database;
import org.sonar.server.platform.db.migration.def.BigIntegerColumnDef;
import org.sonar.server.platform.db.migration.def.BooleanColumnDef;
import org.sonar.server.platform.db.migration.def.ColumnDef;
import org.sonar.server.platform.db.migration.def.DecimalColumnDef;
import org.sonar.server.platform.db.migration.def.IntegerColumnDef;
import org.sonar.server.platform.db.migration.def.TimestampColumnDef;
import org.sonar.server.platform.db.migration.def.TinyIntColumnDef;
import org.sonar.server.platform.db.migration.def.VarcharColumnDef;
import org.sonar.server.platform.db.migration.sql.AddPrimaryKeyBuilder;
import org.sonar.server.platform.db.migration.sql.CreateIndexBuilder;
import org.sonar.server.platform.db.migration.sql.CreateTableBuilder;
import org.sonar.server.platform.db.migration.step.DdlChange;

import static java.util.Arrays.stream;
import static java.util.stream.Stream.concat;
import static java.util.stream.Stream.of;
import static org.sonar.server.platform.db.migration.def.BigIntegerColumnDef.newBigIntegerColumnDefBuilder;
import static org.sonar.server.platform.db.migration.def.BlobColumnDef.newBlobColumnDefBuilder;
import static org.sonar.server.platform.db.migration.def.BooleanColumnDef.newBooleanColumnDefBuilder;
import static org.sonar.server.platform.db.migration.def.ClobColumnDef.newClobColumnDefBuilder;
import static org.sonar.server.platform.db.migration.def.DecimalColumnDef.newDecimalColumnDefBuilder;
import static org.sonar.server.platform.db.migration.def.IntegerColumnDef.newIntegerColumnDefBuilder;
import static org.sonar.server.platform.db.migration.def.TimestampColumnDef.newTimestampColumnDefBuilder;
import static org.sonar.server.platform.db.migration.def.TinyIntColumnDef.newTinyIntColumnDefBuilder;
import static org.sonar.server.platform.db.migration.def.VarcharColumnDef.DESCRIPTION_SECTION_KEY_SIZE;
import static org.sonar.server.platform.db.migration.def.VarcharColumnDef.MAX_SIZE;
import static org.sonar.server.platform.db.migration.def.VarcharColumnDef.USER_UUID_SIZE;
import static org.sonar.server.platform.db.migration.def.VarcharColumnDef.UUID_SIZE;
import static org.sonar.server.platform.db.migration.def.VarcharColumnDef.newVarcharColumnDefBuilder;

public class CreateInitialSchema extends DdlChange {

  /**
   * Initially, UUID columns were created with size 50 when only 40 is needed. {@link VarcharColumnDef#UUID_SIZE}
   * should be used instead of this constant whenever reducing the column size is possible.
   */
  private static final int OLD_UUID_VARCHAR_SIZE = 50;

  // keep column name constants in alphabetic order
  private static final String ANALYSIS_UUID_COL_NAME = &quot;analysis_uuid&quot;;
  private static final String COMPONENT_UUID_COL_NAME = &quot;component_uuid&quot;;
  private static final String CREATED_AT_COL_NAME = &quot;created_at&quot;;
  private static final String DESCRIPTION_COL_NAME = &quot;description&quot;;
  private static final String GROUP_UUID_COL_NAME = &quot;group_uuid&quot;;
  private static final String LANGUAGE_COL_NAME = &quot;language&quot;;
  private static final String METRIC_UUID_COL_NAME = &quot;metric_uuid&quot;;
  private static final String PROJECT_UUID_COL_NAME = &quot;project_uuid&quot;;
  private static final String BRANCH_UUID_COL_NAME = &quot;branch_uuid&quot;;
  public static final String RULE_UUID_COL_NAME = &quot;rule_uuid&quot;;
  private static final String STATUS_COL_NAME = &quot;status&quot;;
  private static final String TASK_UUID_COL_NAME = &quot;task_uuid&quot;;
  private static final String TEMPLATE_UUID_COL_NAME = &quot;template_uuid&quot;;
  private static final String TEXT_VALUE_COL_NAME = &quot;text_value&quot;;
  private static final String UPDATED_AT_COL_NAME = &quot;updated_at&quot;;
  private static final String USER_UUID_COL_NAME = &quot;user_uuid&quot;;
  private static final String VALUE_COL_NAME = &quot;value&quot;;
  private static final String PRIVATE_COL_NAME = &quot;private&quot;;
  private static final String QPROFILE_UUID_COL_NAME = &quot;qprofile_uuid&quot;;
  private static final String EXPIRATION_DATE_COL_NAME = &quot;expiration_date&quot;;
  public static final String QUALITY_GATE_UUID_COL_NAME = &quot;quality_gate_uuid&quot;;
  public static final String CLOB_VALUE_COL_NAME = &quot;clob_value&quot;;
  public static final String IS_EMPTY_COL_NAME = &quot;is_empty&quot;;
  private static final String UNIQUE_INDEX_SUFFIX = &quot;_unique&quot;;

  // usual technical columns
<span class="fc" id="L89">  private static final VarcharColumnDef UUID_COL = newVarcharColumnDefBuilder().setColumnName(&quot;uuid&quot;).setIsNullable(false).setLimit(UUID_SIZE).build();</span>

<span class="fc" id="L91">  private static final BigIntegerColumnDef TECHNICAL_CREATED_AT_COL = newBigIntegerColumnDefBuilder().setColumnName(CREATED_AT_COL_NAME).setIsNullable(false).build();</span>
<span class="fc" id="L92">  private static final BigIntegerColumnDef NULLABLE_TECHNICAL_CREATED_AT_COL = newBigIntegerColumnDefBuilder().setColumnName(CREATED_AT_COL_NAME).setIsNullable(true).build();</span>
<span class="fc" id="L93">  private static final BigIntegerColumnDef TECHNICAL_UPDATED_AT_COL = newBigIntegerColumnDefBuilder().setColumnName(UPDATED_AT_COL_NAME).setIsNullable(false).build();</span>
<span class="fc" id="L94">  private static final BigIntegerColumnDef NULLABLE_TECHNICAL_UPDATED_AT_COL = newBigIntegerColumnDefBuilder().setColumnName(UPDATED_AT_COL_NAME).setIsNullable(true).build();</span>
<span class="fc" id="L95">  private static final TimestampColumnDef DEPRECATED_TECHNICAL_CREATED_AT_COL = newTimestampColumnDefBuilder().setColumnName(CREATED_AT_COL_NAME).setIsNullable(true).build();</span>
<span class="fc" id="L96">  private static final TimestampColumnDef DEPRECATED_TECHNICAL_UPDATED_AT_COL = newTimestampColumnDefBuilder().setColumnName(UPDATED_AT_COL_NAME).setIsNullable(true).build();</span>

  public CreateInitialSchema(Database db) {
<span class="fc" id="L99">    super(db);</span>
<span class="fc" id="L100">  }</span>

  @Override
  public void execute(Context context) throws SQLException {
<span class="fc" id="L104">    createActiveRuleParameters(context);</span>
<span class="fc" id="L105">    createActiveRules(context);</span>
<span class="fc" id="L106">    createAlmPats(context);</span>
<span class="fc" id="L107">    createAlmSettings(context);</span>
<span class="fc" id="L108">    createAnticipatedTransitions(context);</span>
<span class="fc" id="L109">    createProjectAlmSettings(context);</span>
<span class="fc" id="L110">    createAnalysisProperties(context);</span>
<span class="fc" id="L111">    createAppBranchProjectBranch(context);</span>
<span class="fc" id="L112">    createAppProjects(context);</span>
<span class="fc" id="L113">    createAudits(context);</span>
<span class="fc" id="L114">    createCeActivity(context);</span>
<span class="fc" id="L115">    createCeQueue(context);</span>
<span class="fc" id="L116">    createCeScannerContext(context);</span>
<span class="fc" id="L117">    createCeTaskCharacteristics(context);</span>
<span class="fc" id="L118">    createCeTaskInput(context);</span>
<span class="fc" id="L119">    createCeTaskMessage(context);</span>
<span class="fc" id="L120">    createComponents(context);</span>
<span class="fc" id="L121">    createCves(context);</span>
<span class="fc" id="L122">    createCveCwe(context);</span>
<span class="fc" id="L123">    createDefaultQProfiles(context);</span>
<span class="fc" id="L124">    createDeprecatedRuleKeys(context);</span>
<span class="fc" id="L125">    createDuplicationsIndex(context);</span>
<span class="fc" id="L126">    createDevopsPermsMapping(context);</span>
<span class="fc" id="L127">    createEsQueue(context);</span>
<span class="fc" id="L128">    createEventComponentChanges(context);</span>
<span class="fc" id="L129">    createEvents(context);</span>
<span class="fc" id="L130">    createExternalGroups(context);</span>
<span class="fc" id="L131">    createFileSources(context);</span>
<span class="fc" id="L132">    createGithubOrganizationGroups(context);</span>
<span class="fc" id="L133">    createGroupRoles(context);</span>
<span class="fc" id="L134">    createGroups(context);</span>
<span class="fc" id="L135">    createGroupsUsers(context);</span>
<span class="fc" id="L136">    createInternalComponentProps(context);</span>
<span class="fc" id="L137">    createInternalProperties(context);</span>
<span class="fc" id="L138">    createIssueChanges(context);</span>
<span class="fc" id="L139">    createIssueImpacts(context);</span>
<span class="fc" id="L140">    createIssues(context);</span>
<span class="fc" id="L141">    createIssuesDependency(context);</span>
<span class="fc" id="L142">    createIssuesFixed(context);</span>
<span class="fc" id="L143">    createMetrics(context);</span>
<span class="fc" id="L144">    createMeasures(context);</span>
<span class="fc" id="L145">    createNewCodePeriods(context);</span>
<span class="fc" id="L146">    createNewCodeReferenceIssues(context);</span>
<span class="fc" id="L147">    createNotifications(context);</span>
<span class="fc" id="L148">    createOrgQProfiles(context);</span>
<span class="fc" id="L149">    createPermTemplatesGroups(context);</span>
<span class="fc" id="L150">    createPermTemplatesUsers(context);</span>
<span class="fc" id="L151">    createPermTemplatesCharacteristics(context);</span>
<span class="fc" id="L152">    createPermissionTemplates(context);</span>
<span class="fc" id="L153">    createPlugins(context);</span>
<span class="fc" id="L154">    createPortfolioProjBranches(context);</span>
<span class="fc" id="L155">    createPortfolioProjects(context);</span>
<span class="fc" id="L156">    createPortfolioReferences(context);</span>
<span class="fc" id="L157">    createPortfolios(context);</span>
<span class="fc" id="L158">    createProjectBadgeToken(context);</span>
<span class="fc" id="L159">    createProjectBranches(context);</span>
<span class="fc" id="L160">    createProjectDependencies(context);</span>
<span class="fc" id="L161">    createProjectLinks(context);</span>
<span class="fc" id="L162">    createProjectMeasures(context);</span>
<span class="fc" id="L163">    createProjectQprofiles(context);</span>
<span class="fc" id="L164">    createProjects(context);</span>
<span class="fc" id="L165">    createProjectQGates(context);</span>
<span class="fc" id="L166">    createProperties(context);</span>
<span class="fc" id="L167">    createPushEvents(context);</span>
<span class="fc" id="L168">    createReportSchedules(context);</span>
<span class="fc" id="L169">    createReportSubscriptions(context);</span>
<span class="fc" id="L170">    createQGateGroupPermissions(context);</span>
<span class="fc" id="L171">    createQGateUserPermissions(context);</span>
<span class="fc" id="L172">    createQProfileChanges(context);</span>
<span class="fc" id="L173">    createQProfileEditGroups(context);</span>
<span class="fc" id="L174">    createQProfileEditUsers(context);</span>
<span class="fc" id="L175">    createQualityGateConditions(context);</span>
<span class="fc" id="L176">    createQualityGates(context);</span>
<span class="fc" id="L177">    createRuleChanges(context);</span>
<span class="fc" id="L178">    createRuleImpactChanges(context);</span>
<span class="fc" id="L179">    createRuleTags(context);</span>
<span class="fc" id="L180">    createScimGroups(context);</span>
<span class="fc" id="L181">    createScimUsers(context);</span>
<span class="fc" id="L182">    createScmAccounts(context);</span>
<span class="fc" id="L183">    createSessionTokens(context);</span>
<span class="fc" id="L184">    createTelemetryMetricsSent(context);</span>
<span class="fc" id="L185">    createRulesRepository(context);</span>
<span class="fc" id="L186">    createRuleDescSections(context);</span>
<span class="fc" id="L187">    createRules(context);</span>
<span class="fc" id="L188">    createRulesDefaultImpacts(context);</span>
<span class="fc" id="L189">    createRulesParameters(context);</span>
<span class="fc" id="L190">    createRulesProfiles(context);</span>
<span class="fc" id="L191">    createSamlMessageIds(context);</span>
<span class="fc" id="L192">    createScannerAnalysisCache(context);</span>
<span class="fc" id="L193">    createSnapshots(context);</span>
<span class="fc" id="L194">    createUserRoles(context);</span>
<span class="fc" id="L195">    createUserDismissedMessage(context);</span>
<span class="fc" id="L196">    createUserTokens(context);</span>
<span class="fc" id="L197">    createUsers(context);</span>
<span class="fc" id="L198">    createWebhookDeliveries(context);</span>
<span class="fc" id="L199">    createWebhooks(context);</span>
<span class="fc" id="L200">  }</span>

  private void createAnticipatedTransitions(Context context) {
<span class="fc" id="L203">    context.execute(new CreateTableBuilder(getDialect(), &quot;anticipated_transitions&quot;)</span>
<span class="fc" id="L204">      .addPkColumn(newVarcharColumnDefBuilder().setColumnName(&quot;uuid&quot;).setIsNullable(false).setLimit(UUID_SIZE).build())</span>
<span class="fc" id="L205">      .addColumn(newVarcharColumnDefBuilder().setColumnName(&quot;project_uuid&quot;).setIsNullable(false).setLimit(UUID_SIZE).build())</span>
<span class="fc" id="L206">      .addColumn(newVarcharColumnDefBuilder().setColumnName(&quot;user_uuid&quot;).setIsNullable(false).setLimit(USER_UUID_SIZE).build())</span>
<span class="fc" id="L207">      .addColumn(newVarcharColumnDefBuilder().setColumnName(&quot;transition&quot;).setIsNullable(false).setLimit(20).build())</span>
<span class="fc" id="L208">      .addColumn(newVarcharColumnDefBuilder().setColumnName(&quot;transition_comment&quot;).setLimit(MAX_SIZE).build())</span>
<span class="fc" id="L209">      .addColumn(newIntegerColumnDefBuilder().setColumnName(&quot;line&quot;).build())</span>
<span class="fc" id="L210">      .addColumn(newVarcharColumnDefBuilder().setColumnName(&quot;message&quot;).setLimit(MAX_SIZE).build())</span>
<span class="fc" id="L211">      .addColumn(newVarcharColumnDefBuilder().setColumnName(&quot;line_hash&quot;).setLimit(255).build())</span>
<span class="fc" id="L212">      .addColumn(newVarcharColumnDefBuilder().setColumnName(&quot;rule_key&quot;).setIsNullable(false).setLimit(200).build())</span>
<span class="fc" id="L213">      .addColumn(newVarcharColumnDefBuilder().setColumnName(&quot;file_path&quot;).setIsNullable(false).setLimit(1500).build())</span>
<span class="fc" id="L214">      .addColumn(newBigIntegerColumnDefBuilder().setColumnName(&quot;created_at&quot;).setIsNullable(false).build())</span>
<span class="fc" id="L215">      .build());</span>
<span class="fc" id="L216">  }</span>

  private void createActiveRuleParameters(Context context) {
<span class="fc" id="L219">    String tableName = &quot;active_rule_parameters&quot;;</span>
<span class="fc" id="L220">    VarcharColumnDef activeRuleUuidColumnDef = newVarcharColumnDefBuilder(&quot;active_rule_uuid&quot;).setLimit(UUID_SIZE).setIsNullable(false).build();</span>
<span class="fc" id="L221">    VarcharColumnDef rulesParameterUuidColumnDef = newVarcharColumnDefBuilder(&quot;rules_parameter_uuid&quot;).setLimit(UUID_SIZE).setIsNullable(false).build();</span>
<span class="fc" id="L222">    context.execute(</span>
<span class="fc" id="L223">      newTableBuilder(tableName)</span>
<span class="fc" id="L224">        .addPkColumn(UUID_COL)</span>
<span class="fc" id="L225">        .addColumn(newVarcharColumnDefBuilder(VALUE_COL_NAME).setLimit(MAX_SIZE).build())</span>
<span class="fc" id="L226">        .addColumn(newVarcharColumnDefBuilder(&quot;rules_parameter_key&quot;).setLimit(128).build())</span>
<span class="fc" id="L227">        .addColumn(activeRuleUuidColumnDef)</span>
<span class="fc" id="L228">        .addColumn(rulesParameterUuidColumnDef)</span>
<span class="fc" id="L229">        .build());</span>
<span class="fc" id="L230">    addIndex(context, tableName, &quot;arp_active_rule_uuid&quot;, false, activeRuleUuidColumnDef);</span>
<span class="fc" id="L231">  }</span>

  private void createActiveRules(Context context) {
<span class="fc" id="L234">    VarcharColumnDef profileUuidCol = newVarcharColumnDefBuilder(&quot;profile_uuid&quot;).setLimit(UUID_SIZE).setIsNullable(false).build();</span>
<span class="fc" id="L235">    VarcharColumnDef ruleUuidCol = newVarcharColumnDefBuilder(RULE_UUID_COL_NAME).setLimit(UUID_SIZE).setIsNullable(false).build();</span>
<span class="fc" id="L236">    context.execute(</span>
<span class="fc" id="L237">      newTableBuilder(&quot;active_rules&quot;)</span>
<span class="fc" id="L238">        .addPkColumn(UUID_COL)</span>
<span class="fc" id="L239">        .addColumn(newIntegerColumnDefBuilder().setColumnName(&quot;failure_level&quot;).setIsNullable(false).build())</span>
<span class="fc" id="L240">        .addColumn(newVarcharColumnDefBuilder(&quot;inheritance&quot;).setLimit(10).build())</span>
<span class="fc" id="L241">        .addColumn(NULLABLE_TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L242">        .addColumn(NULLABLE_TECHNICAL_UPDATED_AT_COL)</span>
<span class="fc" id="L243">        .addColumn(profileUuidCol)</span>
<span class="fc" id="L244">        .addColumn(ruleUuidCol)</span>
<span class="fc" id="L245">        .addColumn(newBooleanColumnDefBuilder().setColumnName(&quot;prioritized_rule&quot;).setIsNullable(true).build())</span>
<span class="fc" id="L246">        .addColumn(newVarcharColumnDefBuilder().setColumnName(&quot;impacts&quot;).setIsNullable(true).setLimit(500).build())</span>
<span class="fc" id="L247">        .build());</span>
<span class="fc" id="L248">    addIndex(context, &quot;active_rules&quot;, &quot;uniq_profile_rule_uuids&quot;, true, profileUuidCol, ruleUuidCol);</span>
<span class="fc" id="L249">  }</span>

  private void createAlmPats(Context context) {
<span class="fc" id="L252">    String tableName = &quot;alm_pats&quot;;</span>
<span class="fc" id="L253">    VarcharColumnDef patCol = newVarcharColumnDefBuilder(&quot;pat&quot;).setIsNullable(false).setLimit(2000).build();</span>
<span class="fc" id="L254">    VarcharColumnDef userUuidCol = newVarcharColumnDefBuilder(USER_UUID_COL_NAME).setIsNullable(false).setLimit(256).build();</span>
<span class="fc" id="L255">    VarcharColumnDef almSettingUuidCol = newVarcharColumnDefBuilder(&quot;alm_setting_uuid&quot;).setIsNullable(false).setLimit(UUID_SIZE).build();</span>

<span class="fc" id="L257">    context.execute(newTableBuilder(tableName)</span>
<span class="fc" id="L258">      .addPkColumn(UUID_COL)</span>
<span class="fc" id="L259">      .addColumn(patCol)</span>
<span class="fc" id="L260">      .addColumn(userUuidCol)</span>
<span class="fc" id="L261">      .addColumn(almSettingUuidCol)</span>
<span class="fc" id="L262">      .addColumn(TECHNICAL_UPDATED_AT_COL)</span>
<span class="fc" id="L263">      .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L264">      .build());</span>
<span class="fc" id="L265">    addIndex(context, tableName, &quot;uniq_alm_pats&quot;, true, userUuidCol, almSettingUuidCol);</span>
<span class="fc" id="L266">  }</span>

  private void createAlmSettings(Context context) {
<span class="fc" id="L269">    String tableName = &quot;alm_settings&quot;;</span>
<span class="fc" id="L270">    VarcharColumnDef keeCol = newVarcharColumnDefBuilder(&quot;kee&quot;).setIsNullable(false).setLimit(200).build();</span>

<span class="fc" id="L272">    context.execute(newTableBuilder(tableName)</span>
<span class="fc" id="L273">      .addPkColumn(UUID_COL)</span>
<span class="fc" id="L274">      .addColumn(newVarcharColumnDefBuilder(&quot;alm_id&quot;).setIsNullable(false).setLimit(UUID_SIZE).build())</span>
<span class="fc" id="L275">      .addColumn(keeCol)</span>
<span class="fc" id="L276">      .addColumn(newVarcharColumnDefBuilder(&quot;url&quot;).setIsNullable(true).setLimit(2000).build())</span>
<span class="fc" id="L277">      .addColumn(newVarcharColumnDefBuilder(&quot;app_id&quot;).setIsNullable(true).setLimit(80).build())</span>
<span class="fc" id="L278">      .addColumn(newVarcharColumnDefBuilder(&quot;private_key&quot;).setIsNullable(true).setLimit(2500).build())</span>
<span class="fc" id="L279">      .addColumn(newVarcharColumnDefBuilder(&quot;pat&quot;).setIsNullable(true).setLimit(2000).build())</span>
<span class="fc" id="L280">      .addColumn(TECHNICAL_UPDATED_AT_COL)</span>
<span class="fc" id="L281">      .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L282">      .addColumn(newVarcharColumnDefBuilder(&quot;client_id&quot;).setIsNullable(true).setLimit(80).build())</span>
<span class="fc" id="L283">      .addColumn(newVarcharColumnDefBuilder(&quot;client_secret&quot;).setIsNullable(true).setLimit(160).build())</span>
<span class="fc" id="L284">      .addColumn(newVarcharColumnDefBuilder(&quot;webhook_secret&quot;).setIsNullable(true).setLimit(160).build())</span>
<span class="fc" id="L285">      .build());</span>
<span class="fc" id="L286">    addIndex(context, tableName, &quot;uniq_alm_settings&quot;, true, keeCol);</span>
<span class="fc" id="L287">  }</span>

  private void createProjectAlmSettings(Context context) {
<span class="fc" id="L290">    String tableName = &quot;project_alm_settings&quot;;</span>
<span class="fc" id="L291">    VarcharColumnDef almSettingUuidCol = newVarcharColumnDefBuilder(&quot;alm_setting_uuid&quot;).setIsNullable(false).setLimit(UUID_SIZE).build();</span>
<span class="fc" id="L292">    VarcharColumnDef projectUuidCol = newVarcharColumnDefBuilder(PROJECT_UUID_COL_NAME).setIsNullable(false).setLimit(OLD_UUID_VARCHAR_SIZE).build();</span>
<span class="fc" id="L293">    VarcharColumnDef almRepoCol = newVarcharColumnDefBuilder(&quot;alm_repo&quot;).setIsNullable(true).setLimit(256).build();</span>
<span class="fc" id="L294">    VarcharColumnDef almSlugCol = newVarcharColumnDefBuilder(&quot;alm_slug&quot;).setIsNullable(true).setLimit(256).build();</span>
<span class="fc" id="L295">    BooleanColumnDef summaryCommentEnabledCol = newBooleanColumnDefBuilder(&quot;summary_comment_enabled&quot;).setIsNullable(true).build();</span>
<span class="fc" id="L296">    BooleanColumnDef monorepoCol = newBooleanColumnDefBuilder(&quot;monorepo&quot;).setIsNullable(false).build();</span>

<span class="fc" id="L298">    context.execute(newTableBuilder(tableName)</span>
<span class="fc" id="L299">      .addPkColumn(UUID_COL)</span>
<span class="fc" id="L300">      .addColumn(almSettingUuidCol)</span>
<span class="fc" id="L301">      .addColumn(projectUuidCol)</span>
<span class="fc" id="L302">      .addColumn(almRepoCol)</span>
<span class="fc" id="L303">      .addColumn(almSlugCol)</span>
<span class="fc" id="L304">      .addColumn(TECHNICAL_UPDATED_AT_COL)</span>
<span class="fc" id="L305">      .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L306">      .addColumn(summaryCommentEnabledCol)</span>
<span class="fc" id="L307">      .addColumn(monorepoCol)</span>
<span class="fc" id="L308">      .build());</span>
<span class="fc" id="L309">    addIndex(context, tableName, &quot;uniq_project_alm_settings&quot;, true, projectUuidCol);</span>
<span class="fc" id="L310">    addIndex(context, tableName, &quot;project_alm_settings_alm&quot;, false, almSettingUuidCol);</span>
<span class="fc" id="L311">    addIndex(context, tableName, &quot;project_alm_settings_slug&quot;, false, almSlugCol);</span>
<span class="fc" id="L312">  }</span>

  private void createAnalysisProperties(Context context) {
<span class="fc" id="L315">    String tableName = &quot;analysis_properties&quot;;</span>
<span class="fc" id="L316">    VarcharColumnDef snapshotUuidColumn = newVarcharColumnDefBuilder(ANALYSIS_UUID_COL_NAME)</span>
<span class="fc" id="L317">      .setIsNullable(false)</span>
<span class="fc" id="L318">      .setLimit(UUID_SIZE)</span>
<span class="fc" id="L319">      .build();</span>
<span class="fc" id="L320">    context.execute(</span>
<span class="fc" id="L321">      newTableBuilder(tableName)</span>
<span class="fc" id="L322">        .addPkColumn(UUID_COL)</span>
<span class="fc" id="L323">        .addColumn(snapshotUuidColumn)</span>
<span class="fc" id="L324">        .addColumn(newVarcharColumnDefBuilder(&quot;kee&quot;).setIsNullable(false).setLimit(512).build())</span>
<span class="fc" id="L325">        .addColumn(newVarcharColumnDefBuilder(TEXT_VALUE_COL_NAME).setIsNullable(true).setLimit(MAX_SIZE).build())</span>
<span class="fc" id="L326">        .addColumn(newClobColumnDefBuilder().setColumnName(CLOB_VALUE_COL_NAME).setIsNullable(true).build())</span>
<span class="fc" id="L327">        .addColumn(newBooleanColumnDefBuilder().setColumnName(IS_EMPTY_COL_NAME).setIsNullable(false).build())</span>
<span class="fc" id="L328">        .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L329">        .build());</span>
<span class="fc" id="L330">    addIndex(context, tableName, &quot;analysis_properties_analysis&quot;, false, snapshotUuidColumn);</span>
<span class="fc" id="L331">  }</span>

  private void createAppBranchProjectBranch(Context context) {
<span class="fc" id="L334">    String tableName = &quot;app_branch_project_branch&quot;;</span>
<span class="fc" id="L335">    VarcharColumnDef applicationBranchUuid = newVarcharColumnDefBuilder(&quot;application_branch_uuid&quot;).setIsNullable(false).setLimit(UUID_SIZE).build();</span>
<span class="fc" id="L336">    VarcharColumnDef projectBranchUuid = newVarcharColumnDefBuilder(&quot;project_branch_uuid&quot;).setIsNullable(false).setLimit(UUID_SIZE).build();</span>
<span class="fc" id="L337">    VarcharColumnDef applicationUuid = newVarcharColumnDefBuilder(&quot;application_uuid&quot;).setIsNullable(false).setLimit(UUID_SIZE).build();</span>
<span class="fc" id="L338">    VarcharColumnDef projectUuid = newVarcharColumnDefBuilder(PROJECT_UUID_COL_NAME).setIsNullable(false).setLimit(UUID_SIZE).build();</span>
<span class="fc" id="L339">    context.execute(</span>
<span class="fc" id="L340">      newTableBuilder(tableName)</span>
<span class="fc" id="L341">        .addPkColumn(UUID_COL)</span>
<span class="fc" id="L342">        .addColumn(applicationUuid)</span>
<span class="fc" id="L343">        .addColumn(applicationBranchUuid)</span>
<span class="fc" id="L344">        .addColumn(projectUuid)</span>
<span class="fc" id="L345">        .addColumn(projectBranchUuid)</span>
<span class="fc" id="L346">        .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L347">        .build());</span>
<span class="fc" id="L348">    addIndex(context, tableName, &quot;uniq_app_branch_proj&quot;, true, applicationBranchUuid, projectBranchUuid);</span>
<span class="fc" id="L349">    addIndex(context, tableName, &quot;idx_abpb_app_uuid&quot;, false, applicationUuid);</span>
<span class="fc" id="L350">    addIndex(context, tableName, &quot;idx_abpb_app_branch_uuid&quot;, false, applicationBranchUuid);</span>
<span class="fc" id="L351">    addIndex(context, tableName, &quot;idx_abpb_proj_uuid&quot;, false, projectUuid);</span>
<span class="fc" id="L352">    addIndex(context, tableName, &quot;idx_abpb_proj_branch_uuid&quot;, false, projectBranchUuid);</span>
<span class="fc" id="L353">  }</span>

  private void createAppProjects(Context context) {
<span class="fc" id="L356">    String tableName = &quot;app_projects&quot;;</span>
<span class="fc" id="L357">    VarcharColumnDef applicationUuid = newVarcharColumnDefBuilder(&quot;application_uuid&quot;).setIsNullable(false).setLimit(UUID_SIZE).build();</span>
<span class="fc" id="L358">    VarcharColumnDef projectUuid = newVarcharColumnDefBuilder(PROJECT_UUID_COL_NAME).setIsNullable(false).setLimit(UUID_SIZE).build();</span>
<span class="fc" id="L359">    context.execute(</span>
<span class="fc" id="L360">      newTableBuilder(tableName)</span>
<span class="fc" id="L361">        .addPkColumn(UUID_COL)</span>
<span class="fc" id="L362">        .addColumn(applicationUuid)</span>
<span class="fc" id="L363">        .addColumn(projectUuid)</span>
<span class="fc" id="L364">        .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L365">        .build());</span>

<span class="fc" id="L367">    addIndex(context, tableName, &quot;uniq_app_projects&quot;, true, applicationUuid, projectUuid);</span>
<span class="fc" id="L368">    addIndex(context, tableName, &quot;idx_app_proj_application_uuid&quot;, false, applicationUuid);</span>
<span class="fc" id="L369">    addIndex(context, tableName, &quot;idx_app_proj_project_uuid&quot;, false, projectUuid);</span>
<span class="fc" id="L370">  }</span>

  private void createAudits(Context context) {
<span class="fc" id="L373">    String tableName = &quot;audits&quot;;</span>

<span class="fc" id="L375">    context.execute(newTableBuilder(tableName)</span>
<span class="fc" id="L376">      .addPkColumn(UUID_COL)</span>
<span class="fc" id="L377">      .addColumn(newVarcharColumnDefBuilder(USER_UUID_COL_NAME).setIsNullable(false).setLimit(USER_UUID_SIZE).build())</span>
<span class="fc" id="L378">      .addColumn(newVarcharColumnDefBuilder(&quot;user_login&quot;).setIsNullable(false).setLimit(USER_UUID_SIZE).build())</span>
<span class="fc" id="L379">      .addColumn(newVarcharColumnDefBuilder(&quot;category&quot;).setIsNullable(false).setLimit(25).build())</span>
<span class="fc" id="L380">      .addColumn(newVarcharColumnDefBuilder(&quot;operation&quot;).setIsNullable(false).setLimit(50).build())</span>
<span class="fc" id="L381">      .addColumn(newVarcharColumnDefBuilder(&quot;new_value&quot;).setIsNullable(true).setLimit(4000).build())</span>
<span class="fc" id="L382">      .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L383">      .addColumn(newBooleanColumnDefBuilder(&quot;user_triggered&quot;).setIsNullable(false).setDefaultValue(true).build())</span>
<span class="fc" id="L384">      .build());</span>
<span class="fc" id="L385">    addIndex(context, tableName, &quot;audits_created_at&quot;, false, TECHNICAL_CREATED_AT_COL);</span>
<span class="fc" id="L386">  }</span>

  private void createCeActivity(Context context) {
<span class="fc" id="L389">    String tableName = &quot;ce_activity&quot;;</span>
<span class="fc" id="L390">    VarcharColumnDef componentUuidColumn = newVarcharColumnDefBuilder(&quot;component_uuid&quot;).setLimit(UUID_SIZE).setIsNullable(true).build();</span>
<span class="fc" id="L391">    VarcharColumnDef entityUuidColumn = newVarcharColumnDefBuilder(&quot;entity_uuid&quot;).setLimit(UUID_SIZE).setIsNullable(true).build();</span>
<span class="fc" id="L392">    VarcharColumnDef statusCol = newVarcharColumnDefBuilder(STATUS_COL_NAME).setLimit(15).setIsNullable(false).build();</span>
<span class="fc" id="L393">    BooleanColumnDef mainIsLastCol = newBooleanColumnDefBuilder().setColumnName(&quot;main_is_last&quot;).setIsNullable(false).build();</span>
<span class="fc" id="L394">    VarcharColumnDef mainIsLastKeyCol = newVarcharColumnDefBuilder(&quot;main_is_last_key&quot;).setLimit(80).setIsNullable(false).build();</span>
<span class="fc" id="L395">    BooleanColumnDef isLastCol = newBooleanColumnDefBuilder().setColumnName(&quot;is_last&quot;).setIsNullable(false).build();</span>
<span class="fc" id="L396">    VarcharColumnDef isLastKeyCol = newVarcharColumnDefBuilder(&quot;is_last_key&quot;).setLimit(80).setIsNullable(false).build();</span>
<span class="fc" id="L397">    context.execute(</span>
<span class="fc" id="L398">      newTableBuilder(tableName)</span>
<span class="fc" id="L399">        .addPkColumn(UUID_COL)</span>
<span class="fc" id="L400">        .addColumn(newVarcharColumnDefBuilder(&quot;task_type&quot;).setLimit(40).setIsNullable(false).build())</span>
<span class="fc" id="L401">        .addColumn(entityUuidColumn)</span>
<span class="fc" id="L402">        .addColumn(componentUuidColumn)</span>
<span class="fc" id="L403">        .addColumn(statusCol)</span>
<span class="fc" id="L404">        .addColumn(mainIsLastCol)</span>
<span class="fc" id="L405">        .addColumn(mainIsLastKeyCol)</span>
<span class="fc" id="L406">        .addColumn(isLastCol)</span>
<span class="fc" id="L407">        .addColumn(isLastKeyCol)</span>
<span class="fc" id="L408">        .addColumn(newVarcharColumnDefBuilder(&quot;submitter_uuid&quot;).setLimit(USER_UUID_SIZE).setIsNullable(true).build())</span>
<span class="fc" id="L409">        .addColumn(newBigIntegerColumnDefBuilder().setColumnName(&quot;submitted_at&quot;).setIsNullable(false).build())</span>
<span class="fc" id="L410">        .addColumn(newBigIntegerColumnDefBuilder().setColumnName(&quot;started_at&quot;).setIsNullable(true).build())</span>
<span class="fc" id="L411">        .addColumn(newBigIntegerColumnDefBuilder().setColumnName(&quot;executed_at&quot;).setIsNullable(true).build())</span>
<span class="fc" id="L412">        .addColumn(newIntegerColumnDefBuilder().setColumnName(&quot;execution_count&quot;).setIsNullable(false).build())</span>
<span class="fc" id="L413">        .addColumn(newBigIntegerColumnDefBuilder().setColumnName(&quot;execution_time_ms&quot;).setIsNullable(true).build())</span>
<span class="fc" id="L414">        .addColumn(newVarcharColumnDefBuilder(ANALYSIS_UUID_COL_NAME).setLimit(OLD_UUID_VARCHAR_SIZE).setIsNullable(true).build())</span>
<span class="fc" id="L415">        .addColumn(newVarcharColumnDefBuilder(&quot;error_message&quot;).setLimit(1_000).setIsNullable(true).build())</span>
<span class="fc" id="L416">        .addColumn(newClobColumnDefBuilder().setColumnName(&quot;error_stacktrace&quot;).setIsNullable(true).build())</span>
<span class="fc" id="L417">        .addColumn(newVarcharColumnDefBuilder(&quot;error_type&quot;).setLimit(20).setIsNullable(true).build())</span>
<span class="fc" id="L418">        .addColumn(newVarcharColumnDefBuilder(&quot;worker_uuid&quot;).setLimit(UUID_SIZE).setIsNullable(true).build())</span>
<span class="fc" id="L419">        .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L420">        .addColumn(TECHNICAL_UPDATED_AT_COL)</span>
<span class="fc" id="L421">        .addColumn(newVarcharColumnDefBuilder(&quot;node_name&quot;).setLimit(100).setIsNullable(true).build())</span>
<span class="fc" id="L422">        .build());</span>
<span class="fc" id="L423">    addIndex(context, tableName, &quot;ce_activity_component&quot;, false, componentUuidColumn);</span>
<span class="fc" id="L424">    addIndex(context, tableName, &quot;ce_activity_islast&quot;, false, isLastCol, statusCol);</span>
<span class="fc" id="L425">    addIndex(context, tableName, &quot;ce_activity_islast_key&quot;, false, isLastKeyCol);</span>
<span class="fc" id="L426">    addIndex(context, tableName, &quot;ce_activity_main_islast&quot;, false, mainIsLastCol, statusCol);</span>
<span class="fc" id="L427">    addIndex(context, tableName, &quot;ce_activity_main_islast_key&quot;, false, mainIsLastKeyCol);</span>
<span class="fc" id="L428">    addIndex(context, tableName, &quot;ce_activity_entity_uuid&quot;, false, entityUuidColumn);</span>
<span class="fc" id="L429">  }</span>

  private void createCeQueue(Context context) {
<span class="fc" id="L432">    String tableName = &quot;ce_queue&quot;;</span>
<span class="fc" id="L433">    VarcharColumnDef entityUuidColumn = newVarcharColumnDefBuilder(&quot;entity_uuid&quot;).setLimit(UUID_SIZE).setIsNullable(true).build();</span>
<span class="fc" id="L434">    VarcharColumnDef componentUuidCol = newVarcharColumnDefBuilder(COMPONENT_UUID_COL_NAME).setLimit(UUID_SIZE).setIsNullable(true).build();</span>
<span class="fc" id="L435">    context.execute(</span>
<span class="fc" id="L436">      newTableBuilder(tableName)</span>
<span class="fc" id="L437">        .addPkColumn(UUID_COL)</span>
<span class="fc" id="L438">        .addColumn(newVarcharColumnDefBuilder(&quot;task_type&quot;).setLimit(40).setIsNullable(false).build())</span>
<span class="fc" id="L439">        .addColumn(entityUuidColumn)</span>
<span class="fc" id="L440">        .addColumn(componentUuidCol)</span>
<span class="fc" id="L441">        .addColumn(newVarcharColumnDefBuilder(STATUS_COL_NAME).setLimit(15).setIsNullable(true).build())</span>
<span class="fc" id="L442">        .addColumn(newVarcharColumnDefBuilder(&quot;submitter_uuid&quot;).setLimit(USER_UUID_SIZE).setIsNullable(true).build())</span>
<span class="fc" id="L443">        .addColumn(newBigIntegerColumnDefBuilder().setColumnName(&quot;started_at&quot;).setIsNullable(true).build())</span>
<span class="fc" id="L444">        .addColumn(newVarcharColumnDefBuilder(&quot;worker_uuid&quot;).setLimit(UUID_SIZE).setIsNullable(true).build())</span>
<span class="fc" id="L445">        .addColumn(newIntegerColumnDefBuilder().setColumnName(&quot;execution_count&quot;).setIsNullable(false).build())</span>
<span class="fc" id="L446">        .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L447">        .addColumn(TECHNICAL_UPDATED_AT_COL)</span>
<span class="fc" id="L448">        .build());</span>
<span class="fc" id="L449">    addIndex(context, tableName, &quot;ce_queue_component&quot;, false, componentUuidCol);</span>
<span class="fc" id="L450">    addIndex(context, tableName, &quot;ce_queue_entity_uuid&quot;, false, entityUuidColumn);</span>
<span class="fc" id="L451">  }</span>

  private void createCeScannerContext(Context context) {
<span class="fc" id="L454">    context.execute(</span>
<span class="fc" id="L455">      newTableBuilder(&quot;ce_scanner_context&quot;)</span>
<span class="fc" id="L456">        .addPkColumn(newVarcharColumnDefBuilder(TASK_UUID_COL_NAME).setLimit(UUID_SIZE).setIsNullable(false).build())</span>
<span class="fc" id="L457">        .addColumn(newBlobColumnDefBuilder().setColumnName(&quot;context_data&quot;).setIsNullable(false).build())</span>
<span class="fc" id="L458">        .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L459">        .addColumn(TECHNICAL_UPDATED_AT_COL)</span>
<span class="fc" id="L460">        .build());</span>
<span class="fc" id="L461">  }</span>

  private void createCeTaskCharacteristics(Context context) {
<span class="fc" id="L464">    String tableName = &quot;ce_task_characteristics&quot;;</span>
<span class="fc" id="L465">    VarcharColumnDef ceTaskUuidColumn = newVarcharColumnDefBuilder(TASK_UUID_COL_NAME)</span>
<span class="fc" id="L466">      .setLimit(UUID_SIZE)</span>
<span class="fc" id="L467">      .setIsNullable(false)</span>
<span class="fc" id="L468">      .build();</span>

<span class="fc" id="L470">    context.execute(</span>
<span class="fc" id="L471">      newTableBuilder(tableName)</span>
<span class="fc" id="L472">        .addPkColumn(UUID_COL)</span>
<span class="fc" id="L473">        .addColumn(ceTaskUuidColumn)</span>
<span class="fc" id="L474">        .addColumn(newVarcharColumnDefBuilder(&quot;kee&quot;).setLimit(512).setIsNullable(false).build())</span>
<span class="fc" id="L475">        .addColumn(newVarcharColumnDefBuilder(TEXT_VALUE_COL_NAME).setLimit(512).setIsNullable(true).build())</span>
<span class="fc" id="L476">        .build());</span>
<span class="fc" id="L477">    addIndex(context, tableName, &quot;ce_characteristics_&quot; + ceTaskUuidColumn.getName(), false, ceTaskUuidColumn);</span>
<span class="fc" id="L478">  }</span>

  private void createCeTaskInput(Context context) {
<span class="fc" id="L481">    context.execute(</span>
<span class="fc" id="L482">      newTableBuilder(&quot;ce_task_input&quot;)</span>
<span class="fc" id="L483">        .addPkColumn(newVarcharColumnDefBuilder(TASK_UUID_COL_NAME).setLimit(UUID_SIZE).setIsNullable(false).build())</span>
<span class="fc" id="L484">        .addColumn(newBlobColumnDefBuilder().setColumnName(&quot;input_data&quot;).setIsNullable(true).build())</span>
<span class="fc" id="L485">        .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L486">        .addColumn(TECHNICAL_UPDATED_AT_COL)</span>
<span class="fc" id="L487">        .build());</span>
<span class="fc" id="L488">  }</span>

  private void createCeTaskMessage(Context context) {
<span class="fc" id="L491">    String tableName = &quot;ce_task_message&quot;;</span>
<span class="fc" id="L492">    VarcharColumnDef taskUuidCol = newVarcharColumnDefBuilder(TASK_UUID_COL_NAME).setIsNullable(false).setLimit(UUID_SIZE).build();</span>
<span class="fc" id="L493">    VarcharColumnDef messageTypeCol = newVarcharColumnDefBuilder(&quot;message_type&quot;).setIsNullable(false).setLimit(255).build();</span>
<span class="fc" id="L494">    context.execute(newTableBuilder(tableName)</span>
<span class="fc" id="L495">      .addPkColumn(UUID_COL)</span>
<span class="fc" id="L496">      .addColumn(taskUuidCol)</span>
<span class="fc" id="L497">      .addColumn(newVarcharColumnDefBuilder(&quot;message&quot;).setIsNullable(false).setLimit(MAX_SIZE).build())</span>
<span class="fc" id="L498">      .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L499">      .addColumn(messageTypeCol)</span>
<span class="fc" id="L500">      .build());</span>
<span class="fc" id="L501">    addIndex(context, tableName, tableName + &quot;_task&quot;, false, taskUuidCol);</span>
<span class="fc" id="L502">    addIndex(context, tableName, &quot;ctm_message_type&quot;, false, messageTypeCol);</span>
<span class="fc" id="L503">  }</span>

  private void createComponents(Context context) {
<span class="fc" id="L506">    String tableName = &quot;components&quot;;</span>
<span class="fc" id="L507">    VarcharColumnDef keeCol = newVarcharColumnDefBuilder(&quot;kee&quot;).setIsNullable(true).setLimit(1000).build();</span>
<span class="fc" id="L508">    VarcharColumnDef branchUuidCol = newVarcharColumnDefBuilder(BRANCH_UUID_COL_NAME).setIsNullable(false).setLimit(50).build();</span>
<span class="fc" id="L509">    VarcharColumnDef qualifierCol = newVarcharColumnDefBuilder(&quot;qualifier&quot;).setIsNullable(true).setLimit(10).build();</span>
<span class="fc" id="L510">    VarcharColumnDef uuidCol = newVarcharColumnDefBuilder(&quot;uuid&quot;).setIsNullable(false).setLimit(50).build();</span>

<span class="fc" id="L512">    context.execute(newTableBuilder(tableName)</span>
<span class="fc" id="L513">      .addColumn(uuidCol)</span>
<span class="fc" id="L514">      .addColumn(keeCol)</span>
<span class="fc" id="L515">      .addColumn(newVarcharColumnDefBuilder(&quot;deprecated_kee&quot;).setIsNullable(true).setLimit(400).build())</span>
<span class="fc" id="L516">      .addColumn(newVarcharColumnDefBuilder(&quot;name&quot;).setIsNullable(true).setLimit(2000).build())</span>
<span class="fc" id="L517">      .addColumn(newVarcharColumnDefBuilder(&quot;long_name&quot;).setIsNullable(true).setLimit(2000).build())</span>
<span class="fc" id="L518">      .addColumn(newVarcharColumnDefBuilder(DESCRIPTION_COL_NAME).setIsNullable(true).setLimit(2000).build())</span>
<span class="fc" id="L519">      .addColumn(newBooleanColumnDefBuilder().setColumnName(&quot;enabled&quot;).setIsNullable(false).setDefaultValue(true).build())</span>
<span class="fc" id="L520">      .addColumn(newVarcharColumnDefBuilder(&quot;scope&quot;).setIsNullable(true).setLimit(3).build())</span>
<span class="fc" id="L521">      .addColumn(qualifierCol)</span>
<span class="fc" id="L522">      .addColumn(newBooleanColumnDefBuilder().setColumnName(PRIVATE_COL_NAME).setIsNullable(false).build())</span>
<span class="fc" id="L523">      .addColumn(newVarcharColumnDefBuilder(LANGUAGE_COL_NAME).setIsNullable(true).setLimit(20).build())</span>
<span class="fc" id="L524">      .addColumn(newVarcharColumnDefBuilder(&quot;copy_component_uuid&quot;).setIsNullable(true).setLimit(50).build())</span>
<span class="fc" id="L525">      .addColumn(newVarcharColumnDefBuilder(&quot;path&quot;).setIsNullable(true).setLimit(2000).build())</span>
<span class="fc" id="L526">      .addColumn(newVarcharColumnDefBuilder(&quot;uuid_path&quot;).setIsNullable(false).setLimit(1500).build())</span>
<span class="fc" id="L527">      .addColumn(branchUuidCol)</span>
<span class="fc" id="L528">      .addColumn(newBooleanColumnDefBuilder().setColumnName(&quot;b_changed&quot;).setIsNullable(true).build())</span>
<span class="fc" id="L529">      .addColumn(newVarcharColumnDefBuilder(&quot;b_name&quot;).setIsNullable(true).setLimit(500).build())</span>
<span class="fc" id="L530">      .addColumn(newVarcharColumnDefBuilder(&quot;b_long_name&quot;).setIsNullable(true).setLimit(500).build())</span>
<span class="fc" id="L531">      .addColumn(newVarcharColumnDefBuilder(&quot;b_description&quot;).setIsNullable(true).setLimit(2000).build())</span>
<span class="fc" id="L532">      .addColumn(newBooleanColumnDefBuilder().setColumnName(&quot;b_enabled&quot;).setIsNullable(true).build())</span>
<span class="fc" id="L533">      .addColumn(newVarcharColumnDefBuilder(&quot;b_qualifier&quot;).setIsNullable(true).setLimit(10).build())</span>
<span class="fc" id="L534">      .addColumn(newVarcharColumnDefBuilder(&quot;b_language&quot;).setIsNullable(true).setLimit(20).build())</span>
<span class="fc" id="L535">      .addColumn(newVarcharColumnDefBuilder(&quot;b_copy_component_uuid&quot;).setIsNullable(true).setLimit(50).build())</span>
<span class="fc" id="L536">      .addColumn(newVarcharColumnDefBuilder(&quot;b_path&quot;).setIsNullable(true).setLimit(2000).build())</span>
<span class="fc" id="L537">      .addColumn(newVarcharColumnDefBuilder(&quot;b_uuid_path&quot;).setIsNullable(true).setLimit(1500).build())</span>
<span class="fc" id="L538">      .addColumn(newTimestampColumnDefBuilder().setColumnName(CREATED_AT_COL_NAME).setIsNullable(true).build())</span>
<span class="fc" id="L539">      .build());</span>

<span class="fc" id="L541">    addIndex(context, tableName, &quot;projects_qualifier&quot;, false, qualifierCol);</span>
<span class="fc" id="L542">    addIndex(context, tableName, &quot;components_uuid&quot;, true, uuidCol);</span>
<span class="fc" id="L543">    addIndex(context, tableName, &quot;components_branch_uuid&quot;, false, branchUuidCol);</span>
<span class="fc" id="L544">    addIndex(context, tableName, &quot;components_kee_branch_uuid&quot;, true, keeCol, branchUuidCol);</span>
<span class="fc" id="L545">  }</span>


  private void createCves(Context context) {
<span class="fc" id="L549">    String tableName = &quot;cves&quot;;</span>

<span class="fc" id="L551">    VarcharColumnDef uuidColumn = newVarcharColumnDefBuilder().setColumnName(&quot;uuid&quot;).setIsNullable(false).setLimit(UUID_SIZE).build();</span>
<span class="fc" id="L552">    VarcharColumnDef idColumn = newVarcharColumnDefBuilder().setColumnName(&quot;id&quot;).setIsNullable(false).setLimit(DESCRIPTION_SECTION_KEY_SIZE).build();</span>
<span class="fc" id="L553">    VarcharColumnDef descriptionColumn = newVarcharColumnDefBuilder().setColumnName(&quot;description&quot;).setIsNullable(false).setLimit(MAX_SIZE).build();</span>
<span class="fc" id="L554">    BigIntegerColumnDef updatedAtColumn = newBigIntegerColumnDefBuilder().setColumnName(&quot;updated_at&quot;).setIsNullable(false).build();</span>
<span class="fc" id="L555">    BigIntegerColumnDef createdAtColumn = newBigIntegerColumnDefBuilder().setColumnName(&quot;created_at&quot;).setIsNullable(false).build();</span>
<span class="fc" id="L556">    BigIntegerColumnDef lastModifiedColumn = newBigIntegerColumnDefBuilder().setColumnName(&quot;last_modified_at&quot;).setIsNullable(true).build();</span>
<span class="fc" id="L557">    BigIntegerColumnDef publishedColumn = newBigIntegerColumnDefBuilder().setColumnName(&quot;published_at&quot;).setIsNullable(true).build();</span>
<span class="fc" id="L558">    DecimalColumnDef cvssScoreColumn = newDecimalColumnDefBuilder().setColumnName(&quot;cvss_score&quot;).setIsNullable(true).build();</span>
<span class="fc" id="L559">    DecimalColumnDef epssScoreColumn = newDecimalColumnDefBuilder().setColumnName(&quot;epss_score&quot;).setIsNullable(true).build();</span>
<span class="fc" id="L560">    DecimalColumnDef epssPercentileColumn = newDecimalColumnDefBuilder().setColumnName(&quot;epss_percentile&quot;).setIsNullable(true).build();</span>

<span class="fc" id="L562">    context.execute(new CreateTableBuilder(getDialect(), tableName)</span>
<span class="fc" id="L563">      .addPkColumn(uuidColumn)</span>
<span class="fc" id="L564">      .addColumn(idColumn)</span>
<span class="fc" id="L565">      .addColumn(descriptionColumn)</span>
<span class="fc" id="L566">      .addColumn(cvssScoreColumn)</span>
<span class="fc" id="L567">      .addColumn(epssScoreColumn)</span>
<span class="fc" id="L568">      .addColumn(epssPercentileColumn)</span>
<span class="fc" id="L569">      .addColumn(publishedColumn)</span>
<span class="fc" id="L570">      .addColumn(lastModifiedColumn)</span>
<span class="fc" id="L571">      .addColumn(createdAtColumn)</span>
<span class="fc" id="L572">      .addColumn(updatedAtColumn)</span>
<span class="fc" id="L573">      .build());</span>
<span class="fc" id="L574">  }</span>

  private void createCveCwe(Context context) {
<span class="fc" id="L577">    String tableName = &quot;cve_cwe&quot;;</span>

<span class="fc" id="L579">    VarcharColumnDef cveUuidColumn = newVarcharColumnDefBuilder().setColumnName(&quot;cve_uuid&quot;).setIsNullable(false).setLimit(UUID_SIZE).build();</span>
<span class="fc" id="L580">    VarcharColumnDef cweColumn = newVarcharColumnDefBuilder().setColumnName(&quot;cwe&quot;).setIsNullable(false).setLimit(DESCRIPTION_SECTION_KEY_SIZE).build();</span>

<span class="fc" id="L582">    context.execute(new CreateTableBuilder(getDialect(), tableName)</span>
<span class="fc" id="L583">      .addPkColumn(cveUuidColumn)</span>
<span class="fc" id="L584">      .addPkColumn(cweColumn)</span>
<span class="fc" id="L585">      .build());</span>
<span class="fc" id="L586">  }</span>

  private void createIssuesDependency(Context context) {
<span class="fc" id="L589">    String tableName = &quot;issues_dependency&quot;;</span>

<span class="fc" id="L591">    context.execute(new CreateTableBuilder(getDialect(), tableName)</span>
<span class="fc" id="L592">      .addPkColumn(newVarcharColumnDefBuilder().setColumnName(&quot;issue_uuid&quot;).setIsNullable(false).setLimit(UUID_SIZE).build())</span>
<span class="fc" id="L593">      .addColumn(newVarcharColumnDefBuilder().setColumnName(&quot;cve_uuid&quot;).setIsNullable(false).setLimit(UUID_SIZE).build())</span>
<span class="fc" id="L594">      .build());</span>
<span class="fc" id="L595">  }</span>

  private void createDefaultQProfiles(Context context) {
<span class="fc" id="L598">    String tableName = &quot;default_qprofiles&quot;;</span>
<span class="fc" id="L599">    VarcharColumnDef profileUuidColumn = newVarcharColumnDefBuilder(QPROFILE_UUID_COL_NAME)</span>
<span class="fc" id="L600">      .setLimit(255)</span>
<span class="fc" id="L601">      .setIsNullable(false)</span>
<span class="fc" id="L602">      .build();</span>

<span class="fc" id="L604">    context.execute(</span>
<span class="fc" id="L605">      newTableBuilder(tableName)</span>
<span class="fc" id="L606">        .addPkColumn(newVarcharColumnDefBuilder(LANGUAGE_COL_NAME).setLimit(20).setIsNullable(false).build())</span>
<span class="fc" id="L607">        .addColumn(profileUuidColumn)</span>
<span class="fc" id="L608">        .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L609">        .addColumn(TECHNICAL_UPDATED_AT_COL)</span>
<span class="fc" id="L610">        .build());</span>
<span class="fc" id="L611">    addIndex(context, tableName, &quot;uniq_default_qprofiles_uuid&quot;, true, profileUuidColumn);</span>
<span class="fc" id="L612">  }</span>

  private void createDeprecatedRuleKeys(Context context) {
<span class="fc" id="L615">    String tableName = &quot;deprecated_rule_keys&quot;;</span>
<span class="fc" id="L616">    VarcharColumnDef ruleUuidCol = newVarcharColumnDefBuilder(RULE_UUID_COL_NAME).setIsNullable(false).setLimit(UUID_SIZE).build();</span>
<span class="fc" id="L617">    VarcharColumnDef oldRepositoryKeyCol = newVarcharColumnDefBuilder(&quot;old_repository_key&quot;).setIsNullable(false).setLimit(255).build();</span>
<span class="fc" id="L618">    VarcharColumnDef oldRuleKeyCol = newVarcharColumnDefBuilder(&quot;old_rule_key&quot;).setIsNullable(false).setLimit(200).build();</span>
<span class="fc" id="L619">    context.execute(newTableBuilder(tableName)</span>
<span class="fc" id="L620">      .addPkColumn(UUID_COL)</span>
<span class="fc" id="L621">      .addColumn(oldRepositoryKeyCol)</span>
<span class="fc" id="L622">      .addColumn(oldRuleKeyCol)</span>
<span class="fc" id="L623">      .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L624">      .addColumn(ruleUuidCol)</span>
<span class="fc" id="L625">      .build());</span>
<span class="fc" id="L626">    addIndex(context, tableName, &quot;uniq_deprecated_rule_keys&quot;, true, oldRepositoryKeyCol, oldRuleKeyCol);</span>
<span class="fc" id="L627">    addIndex(context, tableName, &quot;rule_uuid_deprecated_rule_keys&quot;, false, ruleUuidCol);</span>
<span class="fc" id="L628">  }</span>

  private void createDuplicationsIndex(Context context) {
<span class="fc" id="L631">    String tableName = &quot;duplications_index&quot;;</span>
<span class="fc" id="L632">    VarcharColumnDef hashCol = newVarcharColumnDefBuilder(&quot;hash&quot;).setLimit(50).setIsNullable(false).build();</span>
<span class="fc" id="L633">    VarcharColumnDef analysisUuidCol = newVarcharColumnDefBuilder(ANALYSIS_UUID_COL_NAME).setLimit(OLD_UUID_VARCHAR_SIZE).setIsNullable(false).build();</span>
<span class="fc" id="L634">    VarcharColumnDef componentUuidCol = newVarcharColumnDefBuilder(COMPONENT_UUID_COL_NAME).setLimit(OLD_UUID_VARCHAR_SIZE).setIsNullable(false).build();</span>
<span class="fc" id="L635">    context.execute(</span>
<span class="fc" id="L636">      newTableBuilder(tableName)</span>
<span class="fc" id="L637">        .addPkColumn(UUID_COL)</span>
<span class="fc" id="L638">        .addColumn(analysisUuidCol)</span>
<span class="fc" id="L639">        .addColumn(componentUuidCol)</span>
<span class="fc" id="L640">        .addColumn(hashCol)</span>
<span class="fc" id="L641">        .addColumn(newIntegerColumnDefBuilder().setColumnName(&quot;index_in_file&quot;).setIsNullable(false).build())</span>
<span class="fc" id="L642">        .addColumn(newIntegerColumnDefBuilder().setColumnName(&quot;start_line&quot;).setIsNullable(false).build())</span>
<span class="fc" id="L643">        .addColumn(newIntegerColumnDefBuilder().setColumnName(&quot;end_line&quot;).setIsNullable(false).build())</span>
<span class="fc" id="L644">        .build());</span>

<span class="fc" id="L646">    addIndex(context, tableName, &quot;duplications_index_hash&quot;, false, hashCol);</span>
<span class="fc" id="L647">    addIndex(context, tableName, &quot;duplication_analysis_component&quot;, false, analysisUuidCol, componentUuidCol);</span>
<span class="fc" id="L648">  }</span>

  private void createEsQueue(Context context) {
<span class="fc" id="L651">    String tableName = &quot;es_queue&quot;;</span>
<span class="fc" id="L652">    BigIntegerColumnDef createdAtCol = TECHNICAL_CREATED_AT_COL;</span>
<span class="fc" id="L653">    context.execute(</span>
<span class="fc" id="L654">      newTableBuilder(tableName)</span>
<span class="fc" id="L655">        .addPkColumn(UUID_COL)</span>
<span class="fc" id="L656">        .addColumn(newVarcharColumnDefBuilder(&quot;doc_type&quot;).setIsNullable(false).setLimit(40).build())</span>
<span class="fc" id="L657">        .addColumn(newVarcharColumnDefBuilder(&quot;doc_id&quot;).setIsNullable(false).setLimit(MAX_SIZE).build())</span>
<span class="fc" id="L658">        .addColumn(newVarcharColumnDefBuilder(&quot;doc_id_type&quot;).setIsNullable(true).setLimit(20).build())</span>
<span class="fc" id="L659">        .addColumn(newVarcharColumnDefBuilder(&quot;doc_routing&quot;).setIsNullable(true).setLimit(MAX_SIZE).build())</span>
<span class="fc" id="L660">        .addColumn(createdAtCol)</span>
<span class="fc" id="L661">        .build());</span>
<span class="fc" id="L662">    addIndex(context, tableName, &quot;es_queue_created_at&quot;, false, createdAtCol);</span>
<span class="fc" id="L663">  }</span>

  private void createEventComponentChanges(Context context) {
<span class="fc" id="L666">    String tableName = &quot;event_component_changes&quot;;</span>
<span class="fc" id="L667">    VarcharColumnDef eventUuidCol = newVarcharColumnDefBuilder(&quot;event_uuid&quot;).setIsNullable(false).setLimit(UUID_SIZE).build();</span>
<span class="fc" id="L668">    VarcharColumnDef eventComponentUuidCol = newVarcharColumnDefBuilder(&quot;event_component_uuid&quot;).setIsNullable(false).setLimit(OLD_UUID_VARCHAR_SIZE).build();</span>
<span class="fc" id="L669">    VarcharColumnDef eventAnalysisUuidCol = newVarcharColumnDefBuilder(&quot;event_analysis_uuid&quot;).setIsNullable(false).setLimit(OLD_UUID_VARCHAR_SIZE).build();</span>
<span class="fc" id="L670">    VarcharColumnDef changeCategoryCol = newVarcharColumnDefBuilder(&quot;change_category&quot;).setIsNullable(false).setLimit(12).build();</span>
<span class="fc" id="L671">    VarcharColumnDef componentUuidCol = newVarcharColumnDefBuilder(COMPONENT_UUID_COL_NAME).setIsNullable(false).setLimit(OLD_UUID_VARCHAR_SIZE).build();</span>
<span class="fc" id="L672">    context.execute(newTableBuilder(tableName)</span>
<span class="fc" id="L673">      .addPkColumn(UUID_COL)</span>
<span class="fc" id="L674">      .addColumn(eventUuidCol)</span>
<span class="fc" id="L675">      .addColumn(eventComponentUuidCol)</span>
<span class="fc" id="L676">      .addColumn(eventAnalysisUuidCol)</span>
<span class="fc" id="L677">      .addColumn(changeCategoryCol)</span>
<span class="fc" id="L678">      .addColumn(componentUuidCol)</span>
<span class="fc" id="L679">      .addColumn(newVarcharColumnDefBuilder(&quot;component_key&quot;).setIsNullable(false).setLimit(400).build())</span>
<span class="fc" id="L680">      .addColumn(newVarcharColumnDefBuilder(&quot;component_name&quot;).setIsNullable(false).setLimit(2000).build())</span>
<span class="fc" id="L681">      .addColumn(newVarcharColumnDefBuilder(&quot;component_branch_key&quot;).setIsNullable(true).setLimit(255).build())</span>
<span class="fc" id="L682">      .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L683">      .build());</span>
<span class="fc" id="L684">    addIndex(context, tableName, tableName + UNIQUE_INDEX_SUFFIX, true, eventUuidCol, changeCategoryCol, componentUuidCol);</span>
<span class="fc" id="L685">    addIndex(context, tableName, &quot;event_cpnt_changes_cpnt&quot;, false, eventComponentUuidCol);</span>
<span class="fc" id="L686">    addIndex(context, tableName, &quot;event_cpnt_changes_analysis&quot;, false, eventAnalysisUuidCol);</span>
<span class="fc" id="L687">  }</span>

  private void createEvents(Context context) {
<span class="fc" id="L690">    String tableName = &quot;events&quot;;</span>
<span class="fc" id="L691">    VarcharColumnDef uuidCol = UUID_COL;</span>
<span class="fc" id="L692">    VarcharColumnDef analysisUuidCol = newVarcharColumnDefBuilder(ANALYSIS_UUID_COL_NAME).setLimit(OLD_UUID_VARCHAR_SIZE).setIsNullable(false).build();</span>
<span class="fc" id="L693">    VarcharColumnDef componentUuid = newVarcharColumnDefBuilder(COMPONENT_UUID_COL_NAME).setLimit(OLD_UUID_VARCHAR_SIZE).setIsNullable(false).build();</span>
<span class="fc" id="L694">    context.execute(</span>
<span class="fc" id="L695">      newTableBuilder(tableName)</span>
<span class="fc" id="L696">        .addPkColumn(uuidCol)</span>
<span class="fc" id="L697">        .addColumn(analysisUuidCol)</span>
<span class="fc" id="L698">        .addColumn(newVarcharColumnDefBuilder(&quot;name&quot;).setLimit(400).setIsNullable(true).build())</span>
<span class="fc" id="L699">        .addColumn(newVarcharColumnDefBuilder(&quot;category&quot;).setLimit(50).build())</span>
<span class="fc" id="L700">        .addColumn(newVarcharColumnDefBuilder(DESCRIPTION_COL_NAME).setLimit(MAX_SIZE).build())</span>
<span class="fc" id="L701">        .addColumn(newVarcharColumnDefBuilder(&quot;event_data&quot;).setLimit(MAX_SIZE).build())</span>
<span class="fc" id="L702">        .addColumn(newBigIntegerColumnDefBuilder().setColumnName(&quot;event_date&quot;).setIsNullable(false).build())</span>
<span class="fc" id="L703">        .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L704">        .addColumn(componentUuid)</span>
<span class="fc" id="L705">        .build());</span>
<span class="fc" id="L706">    addIndex(context, tableName, &quot;events_analysis&quot;, false, analysisUuidCol);</span>
<span class="fc" id="L707">    addIndex(context, tableName, &quot;events_component_uuid&quot;, false, componentUuid);</span>
<span class="fc" id="L708">  }</span>

  private void createExternalGroups(Context context) {
<span class="fc" id="L711">    String tableName = &quot;external_groups&quot;;</span>
<span class="fc" id="L712">    ColumnDef externalIdentityColumn = newVarcharColumnDefBuilder().setColumnName(&quot;external_identity_provider&quot;).setIsNullable(false).setLimit(100).build();</span>
<span class="fc" id="L713">    ColumnDef externalGroupIdColumn = newVarcharColumnDefBuilder().setColumnName(&quot;external_group_id&quot;).setIsNullable(false).setLimit(255).build();</span>
<span class="fc" id="L714">    context.execute(new CreateTableBuilder(getDialect(), tableName)</span>
<span class="fc" id="L715">      .addPkColumn(newVarcharColumnDefBuilder().setColumnName(&quot;group_uuid&quot;).setIsNullable(false).setLimit(UUID_SIZE).build())</span>
<span class="fc" id="L716">      .addColumn(externalGroupIdColumn)</span>
<span class="fc" id="L717">      .addColumn(externalIdentityColumn)</span>
<span class="fc" id="L718">      .build());</span>

<span class="fc" id="L720">    addIndex(context, tableName, &quot;uniq_ext_grp_ext_id_provider&quot;, true, externalIdentityColumn, externalGroupIdColumn);</span>
<span class="fc" id="L721">  }</span>

  private void createFileSources(Context context) {
<span class="fc" id="L724">    String tableName = &quot;file_sources&quot;;</span>
<span class="fc" id="L725">    VarcharColumnDef projectUuidCol = newVarcharColumnDefBuilder(PROJECT_UUID_COL_NAME).setLimit(OLD_UUID_VARCHAR_SIZE).setIsNullable(false).build();</span>
<span class="fc" id="L726">    BigIntegerColumnDef updatedAtCol = TECHNICAL_UPDATED_AT_COL;</span>
<span class="fc" id="L727">    VarcharColumnDef fileUuidCol = newVarcharColumnDefBuilder(&quot;file_uuid&quot;).setLimit(OLD_UUID_VARCHAR_SIZE).setIsNullable(false).build();</span>
<span class="fc" id="L728">    context.execute(</span>
<span class="fc" id="L729">      newTableBuilder(tableName)</span>
<span class="fc" id="L730">        .addPkColumn(UUID_COL)</span>
<span class="fc" id="L731">        .addColumn(projectUuidCol)</span>
<span class="fc" id="L732">        .addColumn(fileUuidCol)</span>
<span class="fc" id="L733">        .addColumn(newClobColumnDefBuilder().setColumnName(&quot;line_hashes&quot;).setIsNullable(true).build())</span>
<span class="fc" id="L734">        .addColumn(newIntegerColumnDefBuilder().setColumnName(&quot;line_hashes_version&quot;).setIsNullable(true).build())</span>
<span class="fc" id="L735">        .addColumn(newVarcharColumnDefBuilder(&quot;data_hash&quot;).setLimit(50).setIsNullable(true).build())</span>
<span class="fc" id="L736">        .addColumn(newVarcharColumnDefBuilder(&quot;src_hash&quot;).setLimit(50).setIsNullable(true).build())</span>
<span class="fc" id="L737">        .addColumn(newVarcharColumnDefBuilder(&quot;revision&quot;).setLimit(100).setIsNullable(true).build())</span>
<span class="fc" id="L738">        .addColumn(newIntegerColumnDefBuilder().setColumnName(&quot;line_count&quot;).setIsNullable(false).build())</span>
<span class="fc" id="L739">        .addColumn(newBlobColumnDefBuilder().setColumnName(&quot;binary_data&quot;).setIsNullable(true).build())</span>
<span class="fc" id="L740">        .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L741">        .addColumn(updatedAtCol)</span>
<span class="fc" id="L742">        .build());</span>
<span class="fc" id="L743">    addIndex(context, tableName, &quot;file_sources_file_uuid&quot;, true, fileUuidCol);</span>
<span class="fc" id="L744">    addIndex(context, tableName, &quot;file_sources_project_uuid&quot;, false, projectUuidCol);</span>
<span class="fc" id="L745">    addIndex(context, tableName, &quot;file_sources_updated_at&quot;, false, updatedAtCol);</span>
<span class="fc" id="L746">  }</span>


  private void createGithubOrganizationGroups(Context context) {
<span class="fc" id="L750">    String tableName = &quot;github_orgs_groups&quot;;</span>
<span class="fc" id="L751">    context.execute(new CreateTableBuilder(getDialect(), tableName)</span>
<span class="fc" id="L752">      .addPkColumn(newVarcharColumnDefBuilder().setColumnName(&quot;group_uuid&quot;).setIsNullable(false).setLimit(UUID_SIZE).build())</span>
<span class="fc" id="L753">      .addColumn(newVarcharColumnDefBuilder().setColumnName(&quot;organization_name&quot;).setIsNullable(false).setLimit(100).build())</span>
<span class="fc" id="L754">      .build());</span>
<span class="fc" id="L755">  }</span>

  private void createDevopsPermsMapping(Context context) {
<span class="fc" id="L758">    String tableName = &quot;devops_perms_mapping&quot;;</span>
<span class="fc" id="L759">    VarcharColumnDef devopsPlatformRoleColumn = newVarcharColumnDefBuilder().setColumnName(&quot;devops_platform_role&quot;).setIsNullable(false).setLimit(100).build();</span>
<span class="fc" id="L760">    VarcharColumnDef sonarqubePermissionColumn = newVarcharColumnDefBuilder().setColumnName(&quot;sonarqube_permission&quot;).setIsNullable(false).setLimit(64).build();</span>
<span class="fc" id="L761">    VarcharColumnDef devopsPlatformColumn = newVarcharColumnDefBuilder().setColumnName(&quot;devops_platform&quot;).setLimit(40).setIsNullable(false).setDefaultValue(&quot;github&quot;).build();</span>
<span class="fc" id="L762">    context.execute(new CreateTableBuilder(getDialect(), tableName)</span>
<span class="fc" id="L763">      .addPkColumn(newVarcharColumnDefBuilder().setColumnName(&quot;uuid&quot;).setIsNullable(false).setLimit(UUID_SIZE).build())</span>
<span class="fc" id="L764">      .addColumn(devopsPlatformRoleColumn)</span>
<span class="fc" id="L765">      .addColumn(sonarqubePermissionColumn)</span>
<span class="fc" id="L766">      .addColumn(devopsPlatformColumn)</span>
<span class="fc" id="L767">      .build());</span>

<span class="fc" id="L769">    addIndex(context, tableName, &quot;uniq_devops_perms_mapping&quot;, true, devopsPlatformColumn, devopsPlatformRoleColumn, sonarqubePermissionColumn);</span>
<span class="fc" id="L770">  }</span>

  private void createGroupRoles(Context context) {
<span class="fc" id="L773">    String tableName = &quot;group_roles&quot;;</span>
<span class="fc" id="L774">    VarcharColumnDef roleCol = newVarcharColumnDefBuilder(&quot;role&quot;).setLimit(64).setIsNullable(false).build();</span>
<span class="fc" id="L775">    VarcharColumnDef componentUuidCol = newVarcharColumnDefBuilder(&quot;entity_uuid&quot;).setIsNullable(true).setLimit(UUID_SIZE).build();</span>
<span class="fc" id="L776">    VarcharColumnDef groupUuidCol = newVarcharColumnDefBuilder(GROUP_UUID_COL_NAME).setIsNullable(true).setLimit(UUID_SIZE).build();</span>
<span class="fc" id="L777">    context.execute(</span>
<span class="fc" id="L778">      newTableBuilder(tableName)</span>
<span class="fc" id="L779">        .addPkColumn(UUID_COL)</span>
<span class="fc" id="L780">        .addColumn(roleCol)</span>
<span class="fc" id="L781">        .addColumn(componentUuidCol)</span>
<span class="fc" id="L782">        .addColumn(groupUuidCol)</span>
<span class="fc" id="L783">        .build());</span>
<span class="fc" id="L784">    addIndex(context, tableName, &quot;uniq_group_roles&quot;, true, groupUuidCol, componentUuidCol, roleCol);</span>
<span class="fc" id="L785">    addIndex(context, tableName, &quot;group_roles_entity_uuid&quot;, false, componentUuidCol);</span>
<span class="fc" id="L786">  }</span>

  private void createGroups(Context context) {
<span class="fc" id="L789">    String tableName = &quot;groups&quot;;</span>
<span class="fc" id="L790">    VarcharColumnDef nameCol = newVarcharColumnDefBuilder(&quot;name&quot;).setLimit(500).setIsNullable(false).build();</span>
<span class="fc" id="L791">    context.execute(</span>
<span class="fc" id="L792">      newTableBuilder(tableName)</span>
<span class="fc" id="L793">        .addPkColumn(UUID_COL)</span>
<span class="fc" id="L794">        .addColumn(nameCol)</span>
<span class="fc" id="L795">        .addColumn(newVarcharColumnDefBuilder(DESCRIPTION_COL_NAME).setLimit(200).setIsNullable(true).build())</span>
<span class="fc" id="L796">        .addColumn(DEPRECATED_TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L797">        .addColumn(DEPRECATED_TECHNICAL_UPDATED_AT_COL)</span>
<span class="fc" id="L798">        .build());</span>
<span class="fc" id="L799">    addIndex(context, tableName, &quot;uniq_groups_name&quot;, true, nameCol);</span>
<span class="fc" id="L800">  }</span>

  private void createGroupsUsers(Context context) {
<span class="fc" id="L803">    String tableName = &quot;groups_users&quot;;</span>
<span class="fc" id="L804">    VarcharColumnDef groupUuidCol = newVarcharColumnDefBuilder(GROUP_UUID_COL_NAME).setLimit(40).setIsNullable(false).build();</span>
<span class="fc" id="L805">    VarcharColumnDef userUuidCol = newVarcharColumnDefBuilder(USER_UUID_COL_NAME).setLimit(255).setIsNullable(false).build();</span>
<span class="fc" id="L806">    context.execute(</span>
<span class="fc" id="L807">      newTableBuilder(tableName)</span>
<span class="fc" id="L808">        .addColumn(groupUuidCol)</span>
<span class="fc" id="L809">        .addColumn(userUuidCol)</span>
<span class="fc" id="L810">        .addPkColumn(newVarcharColumnDefBuilder().setColumnName(&quot;uuid&quot;).setLimit(UUID_SIZE).setIsNullable(false).build())</span>
<span class="fc" id="L811">        .build());</span>
<span class="fc" id="L812">    addIndex(context, tableName, &quot;index_groups_users_group_uuid&quot;, false, groupUuidCol);</span>
<span class="fc" id="L813">    addIndex(context, tableName, &quot;index_groups_users_user_uuid&quot;, false, userUuidCol);</span>
<span class="fc" id="L814">    addIndex(context, tableName, &quot;groups_users_unique&quot;, true, userUuidCol, groupUuidCol);</span>
<span class="fc" id="L815">  }</span>

  private void createInternalComponentProps(Context context) {
<span class="fc" id="L818">    String tableName = &quot;internal_component_props&quot;;</span>
<span class="fc" id="L819">    VarcharColumnDef componentUuidCol = newVarcharColumnDefBuilder(COMPONENT_UUID_COL_NAME).setIsNullable(false).setLimit(OLD_UUID_VARCHAR_SIZE).build();</span>
<span class="fc" id="L820">    VarcharColumnDef keeCol = newVarcharColumnDefBuilder(&quot;kee&quot;).setIsNullable(false).setLimit(512).build();</span>
<span class="fc" id="L821">    context.execute(newTableBuilder(tableName)</span>
<span class="fc" id="L822">      .addPkColumn(UUID_COL)</span>
<span class="fc" id="L823">      .addColumn(componentUuidCol)</span>
<span class="fc" id="L824">      .addColumn(keeCol)</span>
<span class="fc" id="L825">      .addColumn(newVarcharColumnDefBuilder(VALUE_COL_NAME).setIsNullable(true).setLimit(MAX_SIZE).build())</span>
<span class="fc" id="L826">      .addColumn(TECHNICAL_UPDATED_AT_COL)</span>
<span class="fc" id="L827">      .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L828">      .build());</span>
<span class="fc" id="L829">    addIndex(context, tableName, &quot;unique_component_uuid_kee&quot;, true, componentUuidCol, keeCol);</span>
<span class="fc" id="L830">  }</span>

  private void createInternalProperties(Context context) {
<span class="fc" id="L833">    context.execute(</span>
<span class="fc" id="L834">      newTableBuilder(&quot;internal_properties&quot;)</span>
<span class="fc" id="L835">        .addPkColumn(newVarcharColumnDefBuilder(&quot;kee&quot;).setLimit(40).setIsNullable(false).build())</span>
<span class="fc" id="L836">        .addColumn(newBooleanColumnDefBuilder().setColumnName(IS_EMPTY_COL_NAME).setIsNullable(false).build())</span>
<span class="fc" id="L837">        .addColumn(newVarcharColumnDefBuilder().setColumnName(TEXT_VALUE_COL_NAME).setLimit(MAX_SIZE).setIgnoreOracleUnit(true).build())</span>
<span class="fc" id="L838">        .addColumn(newClobColumnDefBuilder().setColumnName(CLOB_VALUE_COL_NAME).setIsNullable(true).build())</span>
<span class="fc" id="L839">        .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L840">        .build());</span>
<span class="fc" id="L841">  }</span>

  private void createIssueChanges(Context context) {
<span class="fc" id="L844">    String tableName = &quot;issue_changes&quot;;</span>
<span class="fc" id="L845">    VarcharColumnDef issueKeyCol = newVarcharColumnDefBuilder(&quot;issue_key&quot;).setLimit(50).setIsNullable(false).build();</span>
<span class="fc" id="L846">    VarcharColumnDef keeCol = newVarcharColumnDefBuilder(&quot;kee&quot;).setLimit(50).build();</span>
<span class="fc" id="L847">    VarcharColumnDef projectUuidCol = newVarcharColumnDefBuilder(PROJECT_UUID_COL_NAME).setLimit(50).setIsNullable(false).build();</span>
<span class="fc" id="L848">    VarcharColumnDef changeTypeCol = newVarcharColumnDefBuilder(&quot;change_type&quot;).setLimit(20).build();</span>
<span class="fc" id="L849">    context.execute(</span>
<span class="fc" id="L850">      newTableBuilder(tableName)</span>
<span class="fc" id="L851">        .addPkColumn(UUID_COL)</span>
<span class="fc" id="L852">        .addColumn(keeCol)</span>
<span class="fc" id="L853">        .addColumn(issueKeyCol)</span>
<span class="fc" id="L854">        .addColumn(newVarcharColumnDefBuilder(&quot;user_login&quot;).setLimit(USER_UUID_SIZE).build())</span>
<span class="fc" id="L855">        .addColumn(changeTypeCol)</span>
<span class="fc" id="L856">        .addColumn(newClobColumnDefBuilder().setColumnName(&quot;change_data&quot;).build())</span>
<span class="fc" id="L857">        .addColumn(NULLABLE_TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L858">        .addColumn(NULLABLE_TECHNICAL_UPDATED_AT_COL)</span>
<span class="fc" id="L859">        .addColumn(newBigIntegerColumnDefBuilder().setColumnName(&quot;issue_change_creation_date&quot;).build())</span>
<span class="fc" id="L860">        .addColumn(projectUuidCol)</span>
<span class="fc" id="L861">        .build());</span>
<span class="fc" id="L862">    addIndex(context, tableName, &quot;issue_changes_issue_key&quot;, false, issueKeyCol);</span>
<span class="fc" id="L863">    addIndex(context, tableName, &quot;issue_changes_kee&quot;, false, keeCol);</span>
<span class="fc" id="L864">    addIndex(context, tableName, &quot;issue_changes_project_uuid&quot;, false, projectUuidCol);</span>
<span class="fc" id="L865">    addIndex(context, tableName, &quot;issue_changes_issue_key_type&quot;, false, issueKeyCol, changeTypeCol);</span>
<span class="fc" id="L866">  }</span>

  private void createIssuesFixed(Context context) {
<span class="fc" id="L869">    String tableName = &quot;issues_fixed&quot;;</span>
<span class="fc" id="L870">    context.execute(new CreateTableBuilder(getDialect(), tableName)</span>
<span class="fc" id="L871">      .addPkColumn(newVarcharColumnDefBuilder().setColumnName(&quot;pull_request_uuid&quot;).setIsNullable(false).setLimit(UUID_SIZE).build())</span>
<span class="fc" id="L872">      .addPkColumn(newVarcharColumnDefBuilder().setColumnName(&quot;issue_key&quot;).setIsNullable(false).setLimit(50).build())</span>
<span class="fc" id="L873">      .build());</span>
<span class="fc" id="L874">  }</span>

  private void createIssueImpacts(Context context) {
<span class="fc" id="L877">    String tableName = &quot;issues_impacts&quot;;</span>

<span class="fc" id="L879">    VarcharColumnDef issueKeyColumn = newVarcharColumnDefBuilder().setColumnName(&quot;issue_key&quot;).setIsNullable(false).setLimit(UUID_SIZE).build();</span>
<span class="fc" id="L880">    VarcharColumnDef softwareQualityColumn = newVarcharColumnDefBuilder().setColumnName(&quot;software_quality&quot;).setIsNullable(false).setLimit(40).build();</span>
<span class="fc" id="L881">    context.execute(new CreateTableBuilder(getDialect(), tableName)</span>
<span class="fc" id="L882">      .addColumn(issueKeyColumn)</span>
<span class="fc" id="L883">      .addColumn(softwareQualityColumn)</span>
<span class="fc" id="L884">      .addColumn(newVarcharColumnDefBuilder().setColumnName(&quot;severity&quot;).setIsNullable(false).setLimit(40).build())</span>
<span class="fc" id="L885">      .addColumn(newBooleanColumnDefBuilder().setColumnName(&quot;manual_severity&quot;).setIsNullable(false).setDefaultValue(false).build())</span>
<span class="fc" id="L886">      .build());</span>

<span class="fc" id="L888">    addIndex(context, tableName, &quot;uniq_iss_key_sof_qual&quot;, true, issueKeyColumn, softwareQualityColumn);</span>

<span class="fc" id="L890">    context.execute(new AddPrimaryKeyBuilder(tableName, &quot;issue_key&quot;, &quot;software_quality&quot;).build());</span>
<span class="fc" id="L891">  }</span>

  private void createIssues(Context context) {
<span class="fc" id="L894">    var tableName = &quot;issues&quot;;</span>
<span class="fc" id="L895">    VarcharColumnDef assigneeCol = newVarcharColumnDefBuilder(&quot;assignee&quot;).setLimit(USER_UUID_SIZE).build();</span>
<span class="fc" id="L896">    VarcharColumnDef componentUuidCol = newVarcharColumnDefBuilder(COMPONENT_UUID_COL_NAME).setLimit(50).build();</span>
<span class="fc" id="L897">    BigIntegerColumnDef issueCreationDateCol = newBigIntegerColumnDefBuilder().setColumnName(&quot;issue_creation_date&quot;).build();</span>
<span class="fc" id="L898">    VarcharColumnDef keeCol = newVarcharColumnDefBuilder(&quot;kee&quot;).setLimit(50).setIsNullable(false).build();</span>
<span class="fc" id="L899">    VarcharColumnDef projectUuidCol = newVarcharColumnDefBuilder(PROJECT_UUID_COL_NAME).setLimit(50).build();</span>
<span class="fc" id="L900">    VarcharColumnDef resolutionCol = newVarcharColumnDefBuilder(&quot;resolution&quot;).setLimit(20).build();</span>
<span class="fc" id="L901">    VarcharColumnDef ruleUuidCol = newVarcharColumnDefBuilder(RULE_UUID_COL_NAME).setLimit(40).setIsNullable(true).build();</span>
<span class="fc" id="L902">    BigIntegerColumnDef updatedAtCol = NULLABLE_TECHNICAL_UPDATED_AT_COL;</span>
<span class="fc" id="L903">    context.execute(</span>
<span class="fc" id="L904">      newTableBuilder(tableName)</span>
<span class="fc" id="L905">        .addPkColumn(keeCol)</span>
<span class="fc" id="L906">        .addColumn(ruleUuidCol)</span>
<span class="fc" id="L907">        .addColumn(newVarcharColumnDefBuilder(&quot;severity&quot;).setLimit(10).build())</span>
<span class="fc" id="L908">        .addColumn(newBooleanColumnDefBuilder().setColumnName(&quot;manual_severity&quot;).setIsNullable(false).build())</span>
        // unit has been fixed in SonarQube 5.6 (see migration 1151, SONAR-7493)
<span class="fc" id="L910">        .addColumn(newVarcharColumnDefBuilder(&quot;message&quot;).setLimit(MAX_SIZE).build())</span>
<span class="fc" id="L911">        .addColumn(newIntegerColumnDefBuilder().setColumnName(&quot;line&quot;).build())</span>
<span class="fc" id="L912">        .addColumn(newDecimalColumnDefBuilder().setColumnName(&quot;gap&quot;).setPrecision(30).setScale(20).build())</span>
<span class="fc" id="L913">        .addColumn(newVarcharColumnDefBuilder(STATUS_COL_NAME).setLimit(20).build())</span>
<span class="fc" id="L914">        .addColumn(resolutionCol)</span>
<span class="fc" id="L915">        .addColumn(newVarcharColumnDefBuilder(&quot;checksum&quot;).setLimit(1000).build())</span>
<span class="fc" id="L916">        .addColumn(assigneeCol)</span>
<span class="fc" id="L917">        .addColumn(newVarcharColumnDefBuilder(&quot;author_login&quot;).setLimit(255).build())</span>
<span class="fc" id="L918">        .addColumn(newIntegerColumnDefBuilder().setColumnName(&quot;effort&quot;).build())</span>
<span class="fc" id="L919">        .addColumn(NULLABLE_TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L920">        .addColumn(updatedAtCol)</span>
<span class="fc" id="L921">        .addColumn(issueCreationDateCol)</span>
<span class="fc" id="L922">        .addColumn(newBigIntegerColumnDefBuilder().setColumnName(&quot;issue_update_date&quot;).build())</span>
<span class="fc" id="L923">        .addColumn(newBigIntegerColumnDefBuilder().setColumnName(&quot;issue_close_date&quot;).build())</span>
<span class="fc" id="L924">        .addColumn(newVarcharColumnDefBuilder(&quot;tags&quot;).setLimit(MAX_SIZE).build())</span>
<span class="fc" id="L925">        .addColumn(componentUuidCol)</span>
<span class="fc" id="L926">        .addColumn(projectUuidCol)</span>
<span class="fc" id="L927">        .addColumn(newBlobColumnDefBuilder().setColumnName(&quot;locations&quot;).build())</span>
<span class="fc" id="L928">        .addColumn(new TinyIntColumnDef.Builder().setColumnName(&quot;issue_type&quot;).build())</span>
<span class="fc" id="L929">        .addColumn(newBooleanColumnDefBuilder().setColumnName(&quot;quick_fix_available&quot;).setIsNullable(true).build())</span>
<span class="fc" id="L930">        .addColumn(newVarcharColumnDefBuilder(&quot;rule_description_context_key&quot;).setLimit(50).build())</span>
<span class="fc" id="L931">        .addColumn(newBlobColumnDefBuilder().setColumnName(&quot;message_formattings&quot;).build())</span>
<span class="fc" id="L932">        .addColumn(newVarcharColumnDefBuilder().setColumnName(&quot;code_variants&quot;).setLimit(4000).setIsNullable(true).build())</span>
<span class="fc" id="L933">        .addColumn(newVarcharColumnDefBuilder().setColumnName(&quot;clean_code_attribute&quot;).setLimit(40).setIsNullable(true).build())</span>
<span class="fc" id="L934">        .addColumn(newBooleanColumnDefBuilder().setColumnName(&quot;prioritized_rule&quot;).setIsNullable(true).build())</span>
<span class="fc" id="L935">        .build());</span>

<span class="fc" id="L937">    addIndex(context, tableName, &quot;issues_assignee&quot;, false, assigneeCol);</span>
<span class="fc" id="L938">    addIndex(context, tableName, &quot;issues_component_uuid&quot;, false, componentUuidCol);</span>
<span class="fc" id="L939">    addIndex(context, tableName, &quot;issues_creation_date&quot;, false, issueCreationDateCol);</span>
<span class="fc" id="L940">    addIndex(context, tableName, &quot;issues_project_uuid&quot;, false, projectUuidCol);</span>
<span class="fc" id="L941">    addIndex(context, tableName, &quot;issues_resolution&quot;, false, resolutionCol);</span>
<span class="fc" id="L942">    addIndex(context, tableName, &quot;issues_updated_at&quot;, false, updatedAtCol);</span>
<span class="fc" id="L943">    addIndex(context, tableName, &quot;issues_rule_uuid&quot;, false, ruleUuidCol);</span>
<span class="fc" id="L944">  }</span>

  private void createMeasures(Context context) {
<span class="fc" id="L947">    String columnComponentUuid = &quot;component_uuid&quot;;</span>
<span class="fc" id="L948">    String columnBranchUuid = &quot;branch_uuid&quot;;</span>
<span class="fc" id="L949">    String columnJsonValue = &quot;json_value&quot;;</span>
<span class="fc" id="L950">    String columnJsonValueHash = &quot;json_value_hash&quot;;</span>
<span class="fc" id="L951">    String columnCreatedAt = &quot;created_at&quot;;</span>
<span class="fc" id="L952">    String columnUpdatedAt = &quot;updated_at&quot;;</span>

<span class="fc" id="L954">    String tableName = &quot;measures&quot;;</span>

<span class="fc" id="L956">    VarcharColumnDef branchUuidColumnDef = newVarcharColumnDefBuilder().setColumnName(columnBranchUuid).setIsNullable(false).setLimit(UUID_SIZE).build();</span>
<span class="fc" id="L957">    context.execute(new CreateTableBuilder(getDialect(), tableName)</span>
<span class="fc" id="L958">      .addPkColumn(newVarcharColumnDefBuilder().setColumnName(columnComponentUuid).setIsNullable(false).setLimit(UUID_SIZE).build())</span>
<span class="fc" id="L959">      .addColumn(branchUuidColumnDef)</span>
<span class="fc" id="L960">      .addColumn(newClobColumnDefBuilder().setColumnName(columnJsonValue).setIsNullable(false).build())</span>
<span class="fc" id="L961">      .addColumn(newBigIntegerColumnDefBuilder().setColumnName(columnJsonValueHash).setIsNullable(false).build())</span>
<span class="fc" id="L962">      .addColumn(newBigIntegerColumnDefBuilder().setColumnName(columnCreatedAt).setIsNullable(false).build())</span>
<span class="fc" id="L963">      .addColumn(newBigIntegerColumnDefBuilder().setColumnName(columnUpdatedAt).setIsNullable(false).build())</span>
<span class="fc" id="L964">      .build());</span>

<span class="fc" id="L966">    addIndex(context, tableName, &quot;measures_branch_uuid&quot;, false, branchUuidColumnDef);</span>
<span class="fc" id="L967">  }</span>

  private void createMetrics(Context context) {
<span class="fc" id="L970">    String tableName = &quot;metrics&quot;;</span>
<span class="fc" id="L971">    VarcharColumnDef nameCol = newVarcharColumnDefBuilder(&quot;name&quot;).setLimit(64).setIsNullable(false).build();</span>
<span class="fc" id="L972">    context.execute(</span>
<span class="fc" id="L973">      newTableBuilder(tableName)</span>
<span class="fc" id="L974">        .addPkColumn(UUID_COL)</span>
<span class="fc" id="L975">        .addColumn(nameCol)</span>
<span class="fc" id="L976">        .addColumn(newVarcharColumnDefBuilder(DESCRIPTION_COL_NAME).setLimit(255).build())</span>
<span class="fc" id="L977">        .addColumn(newIntegerColumnDefBuilder().setColumnName(&quot;direction&quot;).setIsNullable(false).setDefaultValue(0).build())</span>
<span class="fc" id="L978">        .addColumn(newVarcharColumnDefBuilder(&quot;domain&quot;).setLimit(64).build())</span>
<span class="fc" id="L979">        .addColumn(newVarcharColumnDefBuilder(&quot;short_name&quot;).setLimit(64).build())</span>
<span class="fc" id="L980">        .addColumn(newBooleanColumnDefBuilder().setColumnName(&quot;qualitative&quot;).setDefaultValue(false).setIsNullable(false).build())</span>
<span class="fc" id="L981">        .addColumn(newVarcharColumnDefBuilder(&quot;val_type&quot;).setLimit(8).build())</span>
<span class="fc" id="L982">        .addColumn(newBooleanColumnDefBuilder().setColumnName(&quot;enabled&quot;).setDefaultValue(true).build())</span>
<span class="fc" id="L983">        .addColumn(newDecimalColumnDefBuilder().setColumnName(&quot;worst_value&quot;).setPrecision(38).setScale(20).build())</span>
<span class="fc" id="L984">        .addColumn(newDecimalColumnDefBuilder().setColumnName(&quot;best_value&quot;).setPrecision(38).setScale(20).build())</span>
<span class="fc" id="L985">        .addColumn(newBooleanColumnDefBuilder().setColumnName(&quot;optimized_best_value&quot;).build())</span>
<span class="fc" id="L986">        .addColumn(newBooleanColumnDefBuilder().setColumnName(&quot;hidden&quot;).build())</span>
<span class="fc" id="L987">        .addColumn(newBooleanColumnDefBuilder().setColumnName(&quot;delete_historical_data&quot;).build())</span>
<span class="fc" id="L988">        .addColumn(newIntegerColumnDefBuilder().setColumnName(&quot;decimal_scale&quot;).build())</span>
<span class="fc" id="L989">        .build());</span>
<span class="fc" id="L990">    addIndex(context, tableName, &quot;metrics_unique_name&quot;, true, nameCol);</span>
<span class="fc" id="L991">  }</span>

  private void createNewCodePeriods(Context context) {
<span class="fc" id="L994">    String tableName = &quot;new_code_periods&quot;;</span>
<span class="fc" id="L995">    VarcharColumnDef projectUuidCol = newVarcharColumnDefBuilder(PROJECT_UUID_COL_NAME).setLimit(UUID_SIZE).setIsNullable(true).build();</span>
<span class="fc" id="L996">    VarcharColumnDef branchUuidCol = newVarcharColumnDefBuilder(BRANCH_UUID_COL_NAME).setLimit(UUID_SIZE).setIsNullable(true).build();</span>
<span class="fc" id="L997">    VarcharColumnDef typeCol = newVarcharColumnDefBuilder(&quot;type&quot;).setLimit(30).setIsNullable(false).build();</span>
<span class="fc" id="L998">    VarcharColumnDef valueCol = newVarcharColumnDefBuilder(VALUE_COL_NAME).setLimit(255).setIsNullable(true).build();</span>
<span class="fc" id="L999">    context.execute(</span>
<span class="fc" id="L1000">      newTableBuilder(tableName)</span>
<span class="fc" id="L1001">        .addPkColumn(UUID_COL)</span>
<span class="fc" id="L1002">        .addColumn(projectUuidCol)</span>
<span class="fc" id="L1003">        .addColumn(branchUuidCol)</span>
<span class="fc" id="L1004">        .addColumn(typeCol)</span>
<span class="fc" id="L1005">        .addColumn(valueCol)</span>
<span class="fc" id="L1006">        .addColumn(TECHNICAL_UPDATED_AT_COL)</span>
<span class="fc" id="L1007">        .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L1008">        .addColumn(newVarcharColumnDefBuilder().setColumnName(&quot;previous_non_compliant_value&quot;).setLimit(255).setIsNullable(true).build())</span>
<span class="fc" id="L1009">        .build());</span>

<span class="fc" id="L1011">    addIndex(context, tableName, &quot;uniq_new_code_periods&quot;, true, projectUuidCol, branchUuidCol);</span>
<span class="fc" id="L1012">    addIndex(context, tableName, &quot;idx_ncp_type&quot;, false, typeCol);</span>
<span class="fc" id="L1013">    addIndex(context, tableName, &quot;idx_ncp_value&quot;, false, valueCol);</span>
<span class="fc" id="L1014">  }</span>

  private void createNewCodeReferenceIssues(Context context) {
<span class="fc" id="L1017">    String tableName = &quot;new_code_reference_issues&quot;;</span>
<span class="fc" id="L1018">    VarcharColumnDef issueKeyCol = newVarcharColumnDefBuilder(&quot;issue_key&quot;).setLimit(50).setIsNullable(false).build();</span>
<span class="fc" id="L1019">    context.execute(</span>
<span class="fc" id="L1020">      newTableBuilder(tableName)</span>
<span class="fc" id="L1021">        .addPkColumn(UUID_COL)</span>
<span class="fc" id="L1022">        .addColumn(issueKeyCol)</span>
<span class="fc" id="L1023">        .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L1024">        .build());</span>

<span class="fc" id="L1026">    addIndex(context, tableName, &quot;uniq_new_code_reference_issues&quot;, true, issueKeyCol);</span>
<span class="fc" id="L1027">  }</span>

  private void createNotifications(Context context) {
<span class="fc" id="L1030">    context.execute(</span>
<span class="fc" id="L1031">      newTableBuilder(&quot;notifications&quot;)</span>
<span class="fc" id="L1032">        .addPkColumn(UUID_COL)</span>
<span class="fc" id="L1033">        .addColumn(newBlobColumnDefBuilder().setColumnName(&quot;data&quot;).build())</span>
<span class="fc" id="L1034">        .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L1035">        .build());</span>
<span class="fc" id="L1036">  }</span>

  private void createOrgQProfiles(Context context) {
<span class="fc" id="L1039">    String tableName = &quot;org_qprofiles&quot;;</span>
<span class="fc" id="L1040">    int profileUuidSize = 255;</span>
<span class="fc" id="L1041">    VarcharColumnDef rulesProfileUuidCol = newVarcharColumnDefBuilder(&quot;rules_profile_uuid&quot;).setLimit(profileUuidSize).setIsNullable(false).build();</span>
<span class="fc" id="L1042">    VarcharColumnDef parentUuidCol = newVarcharColumnDefBuilder(&quot;parent_uuid&quot;).setLimit(profileUuidSize).setIsNullable(true).build();</span>
<span class="fc" id="L1043">    context.execute(</span>
<span class="fc" id="L1044">      newTableBuilder(tableName)</span>
<span class="fc" id="L1045">        .addPkColumn(newVarcharColumnDefBuilder().setColumnName(&quot;uuid&quot;).setIsNullable(false).setLimit(255).build())</span>
<span class="fc" id="L1046">        .addColumn(rulesProfileUuidCol)</span>
<span class="fc" id="L1047">        .addColumn(parentUuidCol)</span>
<span class="fc" id="L1048">        .addColumn(newBigIntegerColumnDefBuilder().setColumnName(&quot;last_used&quot;).setIsNullable(true).build())</span>
<span class="fc" id="L1049">        .addColumn(newBigIntegerColumnDefBuilder().setColumnName(&quot;user_updated_at&quot;).setIsNullable(true).build())</span>
<span class="fc" id="L1050">        .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L1051">        .addColumn(TECHNICAL_UPDATED_AT_COL)</span>
<span class="fc" id="L1052">        .build());</span>
<span class="fc" id="L1053">    addIndex(context, tableName, &quot;qprofiles_rp_uuid&quot;, false, rulesProfileUuidCol);</span>
<span class="fc" id="L1054">    addIndex(context, tableName, &quot;org_qprofiles_parent_uuid&quot;, false, parentUuidCol);</span>
<span class="fc" id="L1055">  }</span>

  private void createPermTemplatesGroups(Context context) {
<span class="fc" id="L1058">    context.execute(</span>
<span class="fc" id="L1059">      newTableBuilder(&quot;perm_templates_groups&quot;)</span>
<span class="fc" id="L1060">        .addPkColumn(UUID_COL)</span>
<span class="fc" id="L1061">        .addColumn(newVarcharColumnDefBuilder(&quot;permission_reference&quot;).setLimit(64).setIsNullable(false).build())</span>
<span class="fc" id="L1062">        .addColumn(DEPRECATED_TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L1063">        .addColumn(DEPRECATED_TECHNICAL_UPDATED_AT_COL)</span>
<span class="fc" id="L1064">        .addColumn(newVarcharColumnDefBuilder(TEMPLATE_UUID_COL_NAME).setLimit(UUID_SIZE).setIsNullable(false).build())</span>
<span class="fc" id="L1065">        .addColumn(newVarcharColumnDefBuilder(GROUP_UUID_COL_NAME).setLimit(UUID_SIZE).setIsNullable(true).build())</span>
<span class="fc" id="L1066">        .build());</span>
<span class="fc" id="L1067">  }</span>

  private void createPermTemplatesUsers(Context context) {
<span class="fc" id="L1070">    context.execute(</span>
<span class="fc" id="L1071">      newTableBuilder(&quot;perm_templates_users&quot;)</span>
<span class="fc" id="L1072">        .addPkColumn(UUID_COL)</span>
<span class="fc" id="L1073">        .addColumn(newVarcharColumnDefBuilder(&quot;permission_reference&quot;).setLimit(64).setIsNullable(false).build())</span>
<span class="fc" id="L1074">        .addColumn(DEPRECATED_TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L1075">        .addColumn(DEPRECATED_TECHNICAL_UPDATED_AT_COL)</span>
<span class="fc" id="L1076">        .addColumn(newVarcharColumnDefBuilder(TEMPLATE_UUID_COL_NAME).setLimit(UUID_SIZE).setIsNullable(false).build())</span>
<span class="fc" id="L1077">        .addColumn(newVarcharColumnDefBuilder(USER_UUID_COL_NAME).setLimit(USER_UUID_SIZE).setIsNullable(false).build())</span>
<span class="fc" id="L1078">        .build());</span>
<span class="fc" id="L1079">  }</span>

  private void createPermTemplatesCharacteristics(Context context) {
<span class="fc" id="L1082">    String tableName = &quot;perm_tpl_characteristics&quot;;</span>
<span class="fc" id="L1083">    VarcharColumnDef permissionKeyColumn = newVarcharColumnDefBuilder(&quot;permission_key&quot;).setLimit(64).setIsNullable(false).build();</span>
<span class="fc" id="L1084">    VarcharColumnDef templateUuidColumn = newVarcharColumnDefBuilder(TEMPLATE_UUID_COL_NAME).setLimit(UUID_SIZE).setIsNullable(false).build();</span>
<span class="fc" id="L1085">    context.execute(</span>
<span class="fc" id="L1086">      newTableBuilder(tableName)</span>
<span class="fc" id="L1087">        .addPkColumn(UUID_COL)</span>
<span class="fc" id="L1088">        .addColumn(permissionKeyColumn)</span>
<span class="fc" id="L1089">        .addColumn(newBooleanColumnDefBuilder().setColumnName(&quot;with_project_creator&quot;).setIsNullable(false).setDefaultValue(false).build())</span>
<span class="fc" id="L1090">        .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L1091">        .addColumn(TECHNICAL_UPDATED_AT_COL)</span>
<span class="fc" id="L1092">        .addColumn(templateUuidColumn)</span>
<span class="fc" id="L1093">        .build());</span>

<span class="fc" id="L1095">    addIndex(context, tableName, &quot;uniq_perm_tpl_charac&quot;, true, templateUuidColumn, permissionKeyColumn);</span>
<span class="fc" id="L1096">  }</span>

  private void createPermissionTemplates(Context context) {
<span class="fc" id="L1099">    context.execute(</span>
<span class="fc" id="L1100">      newTableBuilder(&quot;permission_templates&quot;)</span>
<span class="fc" id="L1101">        .addPkColumn(UUID_COL)</span>
<span class="fc" id="L1102">        .addColumn(newVarcharColumnDefBuilder(&quot;name&quot;).setLimit(100).setIsNullable(false).build())</span>
<span class="fc" id="L1103">        .addColumn(newVarcharColumnDefBuilder(DESCRIPTION_COL_NAME).setLimit(MAX_SIZE).build())</span>
<span class="fc" id="L1104">        .addColumn(DEPRECATED_TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L1105">        .addColumn(DEPRECATED_TECHNICAL_UPDATED_AT_COL)</span>
<span class="fc" id="L1106">        .addColumn(newVarcharColumnDefBuilder(&quot;key_pattern&quot;).setLimit(500).build())</span>
<span class="fc" id="L1107">        .build());</span>
<span class="fc" id="L1108">  }</span>

  private void createPlugins(Context context) {
<span class="fc" id="L1111">    int pluginKeyMaxSize = 200;</span>
<span class="fc" id="L1112">    String tableName = &quot;plugins&quot;;</span>
<span class="fc" id="L1113">    VarcharColumnDef keyColumn = newVarcharColumnDefBuilder(&quot;kee&quot;).setLimit(pluginKeyMaxSize).setIsNullable(false).build();</span>
<span class="fc" id="L1114">    context.execute(</span>
<span class="fc" id="L1115">      newTableBuilder(tableName)</span>
<span class="fc" id="L1116">        .addPkColumn(UUID_COL)</span>
<span class="fc" id="L1117">        .addColumn(keyColumn)</span>
<span class="fc" id="L1118">        .addColumn(newVarcharColumnDefBuilder(&quot;base_plugin_key&quot;).setLimit(pluginKeyMaxSize).setIsNullable(true).build())</span>
<span class="fc" id="L1119">        .addColumn(newVarcharColumnDefBuilder(&quot;file_hash&quot;).setLimit(200).setIsNullable(false).build())</span>
<span class="fc" id="L1120">        .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L1121">        .addColumn(TECHNICAL_UPDATED_AT_COL)</span>
<span class="fc" id="L1122">        .addColumn(newVarcharColumnDefBuilder(&quot;type&quot;).setLimit(10).setIsNullable(false).build())</span>
<span class="fc" id="L1123">        .addColumn(newBooleanColumnDefBuilder(&quot;removed&quot;).setDefaultValue(false).setIsNullable(false).build())</span>
<span class="fc" id="L1124">        .build());</span>
<span class="fc" id="L1125">    addIndex(context, tableName, &quot;plugins_key&quot;, true, keyColumn);</span>
<span class="fc" id="L1126">  }</span>

  private void createPortfolioProjBranches(Context context) {
<span class="fc" id="L1129">    String tableName = &quot;portfolio_proj_branches&quot;;</span>
<span class="fc" id="L1130">    context.execute(new CreateTableBuilder(getDialect(), tableName)</span>
<span class="fc" id="L1131">      .addPkColumn(UUID_COL)</span>
<span class="fc" id="L1132">      .addColumn(newVarcharColumnDefBuilder().setColumnName(&quot;portfolio_project_uuid&quot;).setIsNullable(false).setLimit(UUID_SIZE).build())</span>
<span class="fc" id="L1133">      .addColumn(newVarcharColumnDefBuilder().setColumnName(BRANCH_UUID_COL_NAME).setIsNullable(false).setLimit(UUID_SIZE).build())</span>
<span class="fc" id="L1134">      .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L1135">      .build());</span>
<span class="fc" id="L1136">  }</span>

  private void createPortfolioProjects(Context context) {
<span class="fc" id="L1139">    String tableName = &quot;portfolio_projects&quot;;</span>
<span class="fc" id="L1140">    VarcharColumnDef portfolioUuidColumn = newVarcharColumnDefBuilder().setColumnName(&quot;portfolio_uuid&quot;).setIsNullable(false).setLimit(UUID_SIZE).build();</span>
<span class="fc" id="L1141">    VarcharColumnDef projectUuidColumn = newVarcharColumnDefBuilder().setColumnName(PROJECT_UUID_COL_NAME).setIsNullable(false).setLimit(UUID_SIZE).build();</span>
<span class="fc" id="L1142">    context.execute(new CreateTableBuilder(getDialect(), tableName)</span>
<span class="fc" id="L1143">      .addPkColumn(UUID_COL)</span>
<span class="fc" id="L1144">      .addColumn(portfolioUuidColumn)</span>
<span class="fc" id="L1145">      .addColumn(projectUuidColumn)</span>
<span class="fc" id="L1146">      .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L1147">      .build());</span>
<span class="fc" id="L1148">    addIndex(context, tableName, &quot;uniq_portfolio_projects&quot;, true, portfolioUuidColumn, projectUuidColumn);</span>
<span class="fc" id="L1149">  }</span>

  private void createPortfolioReferences(Context context) {
<span class="fc" id="L1152">    String tableName = &quot;portfolio_references&quot;;</span>
<span class="fc" id="L1153">    VarcharColumnDef portfolioUuidColumn = newVarcharColumnDefBuilder().setColumnName(&quot;portfolio_uuid&quot;).setIsNullable(false).setLimit(UUID_SIZE).build();</span>
<span class="fc" id="L1154">    VarcharColumnDef referenceUuidColumn = newVarcharColumnDefBuilder().setColumnName(&quot;reference_uuid&quot;).setIsNullable(false).setLimit(UUID_SIZE).build();</span>
<span class="fc" id="L1155">    VarcharColumnDef branchUuidColumn = newVarcharColumnDefBuilder().setColumnName(BRANCH_UUID_COL_NAME).setIsNullable(true).setLimit(255).build();</span>
<span class="fc" id="L1156">    context.execute(new CreateTableBuilder(getDialect(), tableName)</span>
<span class="fc" id="L1157">      .addPkColumn(UUID_COL)</span>
<span class="fc" id="L1158">      .addColumn(portfolioUuidColumn)</span>
<span class="fc" id="L1159">      .addColumn(referenceUuidColumn)</span>
<span class="fc" id="L1160">      .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L1161">      .addColumn(branchUuidColumn)</span>
<span class="fc" id="L1162">      .build());</span>
<span class="fc" id="L1163">    addIndex(context, tableName, &quot;uniq_portfolio_references&quot;, true, portfolioUuidColumn, referenceUuidColumn, branchUuidColumn);</span>
<span class="fc" id="L1164">  }</span>

  private void createPortfolios(Context context) {
<span class="fc" id="L1167">    String tableName = &quot;portfolios&quot;;</span>
<span class="fc" id="L1168">    VarcharColumnDef keeColumn = newVarcharColumnDefBuilder().setColumnName(&quot;kee&quot;).setIsNullable(false).setLimit(400).build();</span>
<span class="fc" id="L1169">    context.execute(new CreateTableBuilder(getDialect(), tableName)</span>
<span class="fc" id="L1170">      .addPkColumn(UUID_COL)</span>
<span class="fc" id="L1171">      .addColumn(keeColumn)</span>
<span class="fc" id="L1172">      .addColumn(newVarcharColumnDefBuilder().setColumnName(&quot;name&quot;).setIsNullable(false).setLimit(2000).build())</span>
<span class="fc" id="L1173">      .addColumn(newVarcharColumnDefBuilder().setColumnName(DESCRIPTION_COL_NAME).setIsNullable(true).setLimit(2000).build())</span>
<span class="fc" id="L1174">      .addColumn(newVarcharColumnDefBuilder().setColumnName(&quot;root_uuid&quot;).setIsNullable(false).setLimit(UUID_SIZE).build())</span>
<span class="fc" id="L1175">      .addColumn(newVarcharColumnDefBuilder().setColumnName(&quot;parent_uuid&quot;).setIsNullable(true).setLimit(UUID_SIZE).build())</span>
<span class="fc" id="L1176">      .addColumn(newBooleanColumnDefBuilder(PRIVATE_COL_NAME).setIsNullable(false).build())</span>
<span class="fc" id="L1177">      .addColumn(newVarcharColumnDefBuilder().setColumnName(&quot;selection_mode&quot;).setIsNullable(false).setLimit(50).build())</span>
<span class="fc" id="L1178">      .addColumn(newVarcharColumnDefBuilder().setColumnName(&quot;selection_expression&quot;).setIsNullable(true).setLimit(4000).build())</span>
<span class="fc" id="L1179">      .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L1180">      .addColumn(TECHNICAL_UPDATED_AT_COL)</span>
<span class="fc" id="L1181">      .addColumn(newVarcharColumnDefBuilder().setColumnName(&quot;branch_key&quot;).setIsNullable(true).setLimit(255).build())</span>
<span class="fc" id="L1182">      .build());</span>
<span class="fc" id="L1183">    addIndex(context, tableName, &quot;uniq_portfolios_kee&quot;, true, keeColumn);</span>
<span class="fc" id="L1184">  }</span>

  private void createProjectBadgeToken(Context context) {
<span class="fc" id="L1187">    String tableName = &quot;project_badge_token&quot;;</span>
<span class="fc" id="L1188">    VarcharColumnDef projectUuidCol = newVarcharColumnDefBuilder(PROJECT_UUID_COL_NAME).setIsNullable(false).setLimit(UUID_SIZE).build();</span>
<span class="fc" id="L1189">    context.execute(</span>
<span class="fc" id="L1190">      newTableBuilder(tableName)</span>
<span class="fc" id="L1191">        .addPkColumn(UUID_COL)</span>
<span class="fc" id="L1192">        .addColumn(newVarcharColumnDefBuilder(&quot;token&quot;).setIsNullable(false).setLimit(255).build())</span>
<span class="fc" id="L1193">        .addColumn(projectUuidCol)</span>
<span class="fc" id="L1194">        .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L1195">        .addColumn(TECHNICAL_UPDATED_AT_COL)</span>
<span class="fc" id="L1196">        .build());</span>
<span class="fc" id="L1197">    addIndex(context, tableName, &quot;uniq_project_badge_token&quot;, true, projectUuidCol);</span>
<span class="fc" id="L1198">  }</span>

  private void createProjectBranches(Context context) {
<span class="fc" id="L1201">    String tableName = &quot;project_branches&quot;;</span>
<span class="fc" id="L1202">    VarcharColumnDef projectUuidCol = newVarcharColumnDefBuilder(PROJECT_UUID_COL_NAME).setIsNullable(false).setLimit(OLD_UUID_VARCHAR_SIZE).build();</span>
<span class="fc" id="L1203">    VarcharColumnDef keeCol = newVarcharColumnDefBuilder(&quot;kee&quot;).setIsNullable(false).setLimit(255).build();</span>
<span class="fc" id="L1204">    VarcharColumnDef branchTypeCol = newVarcharColumnDefBuilder(&quot;branch_type&quot;).setIsNullable(false).setLimit(12).build();</span>
<span class="fc" id="L1205">    context.execute(</span>
<span class="fc" id="L1206">      newTableBuilder(tableName)</span>
<span class="fc" id="L1207">        .addPkColumn(newVarcharColumnDefBuilder(&quot;uuid&quot;).setIsNullable(false).setLimit(OLD_UUID_VARCHAR_SIZE).build())</span>
<span class="fc" id="L1208">        .addColumn(projectUuidCol)</span>
<span class="fc" id="L1209">        .addColumn(keeCol)</span>
<span class="fc" id="L1210">        .addColumn(branchTypeCol)</span>
<span class="fc" id="L1211">        .addColumn(newVarcharColumnDefBuilder(&quot;merge_branch_uuid&quot;).setIsNullable(true).setLimit(OLD_UUID_VARCHAR_SIZE).build())</span>
<span class="fc" id="L1212">        .addColumn(newBlobColumnDefBuilder().setColumnName(&quot;pull_request_binary&quot;).setIsNullable(true).build())</span>
<span class="fc" id="L1213">        .addColumn(newVarcharColumnDefBuilder(&quot;manual_baseline_analysis_uuid&quot;).setIsNullable(true).setLimit(UUID_SIZE).build())</span>
<span class="fc" id="L1214">        .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L1215">        .addColumn(TECHNICAL_UPDATED_AT_COL)</span>
<span class="fc" id="L1216">        .addColumn(newBooleanColumnDefBuilder(&quot;exclude_from_purge&quot;).setDefaultValue(false).setIsNullable(false).build())</span>
<span class="fc" id="L1217">        .addColumn(newBooleanColumnDefBuilder(&quot;need_issue_sync&quot;).setIsNullable(false).build())</span>
<span class="fc" id="L1218">        .addColumn(newBooleanColumnDefBuilder().setColumnName(&quot;is_main&quot;).setIsNullable(false).build())</span>
<span class="fc" id="L1219">        .build());</span>
<span class="fc" id="L1220">    addIndex(context, tableName, &quot;uniq_project_branches&quot;, true, branchTypeCol, projectUuidCol, keeCol);</span>
<span class="fc" id="L1221">    addIndex(context, tableName, &quot;project_branches_project_uuid&quot;, false, projectUuidCol);</span>
<span class="fc" id="L1222">  }</span>

  private void createProjectDependencies(Context context) {
<span class="fc" id="L1225">    String tableName = &quot;project_dependencies&quot;;</span>

<span class="fc" id="L1227">    String columnUuidName = &quot;uuid&quot;;</span>
<span class="fc" id="L1228">    String columnVersionName = &quot;version&quot;;</span>
<span class="fc" id="L1229">    String columnIncludePathsName = &quot;include_paths&quot;;</span>
<span class="fc" id="L1230">    String columnPackageManagerName = &quot;package_manager&quot;;</span>
<span class="fc" id="L1231">    String columnCreatedAtName = &quot;created_at&quot;;</span>
<span class="fc" id="L1232">    String columnUpdatedAtName = &quot;updated_at&quot;;</span>

<span class="fc" id="L1234">    context.execute(new CreateTableBuilder(getDialect(), tableName)</span>
<span class="fc" id="L1235">      .addPkColumn(newVarcharColumnDefBuilder().setColumnName(columnUuidName).setIsNullable(false).setLimit(UUID_SIZE).build())</span>
<span class="fc" id="L1236">      .addColumn(newClobColumnDefBuilder().setColumnName(columnVersionName).setIsNullable(true).build())</span>
<span class="fc" id="L1237">      .addColumn(newClobColumnDefBuilder().setColumnName(columnIncludePathsName).setIsNullable(true).build())</span>
<span class="fc" id="L1238">      .addColumn(newVarcharColumnDefBuilder().setColumnName(columnPackageManagerName).setIsNullable(true).setLimit(50).build())</span>
<span class="fc" id="L1239">      .addColumn(newBigIntegerColumnDefBuilder().setColumnName(columnCreatedAtName).setIsNullable(false).build())</span>
<span class="fc" id="L1240">      .addColumn(newBigIntegerColumnDefBuilder().setColumnName(columnUpdatedAtName).setIsNullable(false).build())</span>
<span class="fc" id="L1241">      .build());</span>
<span class="fc" id="L1242">  }</span>

  private void createProjectLinks(Context context) {
<span class="fc" id="L1245">    String tableName = &quot;project_links&quot;;</span>
<span class="fc" id="L1246">    VarcharColumnDef projectUuidCol = newVarcharColumnDefBuilder(PROJECT_UUID_COL_NAME).setLimit(UUID_SIZE).setIsNullable(false).build();</span>
<span class="fc" id="L1247">    context.execute(newTableBuilder(tableName)</span>
<span class="fc" id="L1248">      .addPkColumn(UUID_COL)</span>
<span class="fc" id="L1249">      .addColumn(projectUuidCol)</span>
<span class="fc" id="L1250">      .addColumn(newVarcharColumnDefBuilder(&quot;link_type&quot;).setLimit(20).setIsNullable(false).build())</span>
<span class="fc" id="L1251">      .addColumn(newVarcharColumnDefBuilder(&quot;name&quot;).setLimit(128).setIsNullable(true).build())</span>
<span class="fc" id="L1252">      .addColumn(newVarcharColumnDefBuilder(&quot;href&quot;).setLimit(2048).setIsNullable(false).build())</span>
<span class="fc" id="L1253">      .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L1254">      .addColumn(TECHNICAL_UPDATED_AT_COL)</span>
<span class="fc" id="L1255">      .build());</span>
<span class="fc" id="L1256">    addIndex(context, tableName, &quot;project_links_project&quot;, false, projectUuidCol);</span>
<span class="fc" id="L1257">  }</span>

  private void createProjectMeasures(Context context) {
<span class="fc" id="L1260">    String tableName = &quot;project_measures&quot;;</span>
<span class="fc" id="L1261">    IntegerColumnDef personIdCol = newIntegerColumnDefBuilder().setColumnName(&quot;person_id&quot;).build();</span>
<span class="fc" id="L1262">    VarcharColumnDef metricUuidCol = newVarcharColumnDefBuilder(METRIC_UUID_COL_NAME).setLimit(UUID_SIZE).setIsNullable(false).build();</span>
<span class="fc" id="L1263">    VarcharColumnDef analysisUuidCol = newVarcharColumnDefBuilder(ANALYSIS_UUID_COL_NAME).setLimit(OLD_UUID_VARCHAR_SIZE).setIsNullable(false).build();</span>
<span class="fc" id="L1264">    VarcharColumnDef componentUuidCol = newVarcharColumnDefBuilder(COMPONENT_UUID_COL_NAME).setLimit(OLD_UUID_VARCHAR_SIZE).setIsNullable(false).build();</span>
<span class="fc" id="L1265">    context.execute(</span>
<span class="fc" id="L1266">      newTableBuilder(tableName)</span>
<span class="fc" id="L1267">        .addPkColumn(UUID_COL)</span>
<span class="fc" id="L1268">        .addColumn(newDecimalColumnDefBuilder().setColumnName(VALUE_COL_NAME).setPrecision(38).setScale(20).build())</span>
<span class="fc" id="L1269">        .addColumn(analysisUuidCol)</span>
<span class="fc" id="L1270">        .addColumn(componentUuidCol)</span>
<span class="fc" id="L1271">        .addColumn(newVarcharColumnDefBuilder(TEXT_VALUE_COL_NAME).setLimit(MAX_SIZE).build())</span>
<span class="fc" id="L1272">        .addColumn(newVarcharColumnDefBuilder(&quot;alert_status&quot;).setLimit(5).build())</span>
<span class="fc" id="L1273">        .addColumn(newVarcharColumnDefBuilder(&quot;alert_text&quot;).setLimit(MAX_SIZE).build())</span>
<span class="fc" id="L1274">        .addColumn(personIdCol)</span>
<span class="fc" id="L1275">        .addColumn(newBlobColumnDefBuilder().setColumnName(&quot;measure_data&quot;).build())</span>
<span class="fc" id="L1276">        .addColumn(metricUuidCol)</span>
<span class="fc" id="L1277">        .build());</span>
<span class="fc" id="L1278">    addIndex(context, tableName, &quot;measures_component_uuid&quot;, false, componentUuidCol);</span>
<span class="fc" id="L1279">    addIndex(context, tableName, &quot;measures_analysis_metric&quot;, false, analysisUuidCol, metricUuidCol);</span>
<span class="fc" id="L1280">    addIndex(context, tableName, &quot;project_measures_metric&quot;, false, metricUuidCol);</span>
<span class="fc" id="L1281">  }</span>

  private void createProjectQprofiles(Context context) {
<span class="fc" id="L1284">    String tableName = &quot;project_qprofiles&quot;;</span>
<span class="fc" id="L1285">    VarcharColumnDef projectUuid = newVarcharColumnDefBuilder(PROJECT_UUID_COL_NAME).setLimit(50).setIsNullable(false).build();</span>
<span class="fc" id="L1286">    VarcharColumnDef profileKey = newVarcharColumnDefBuilder(&quot;profile_key&quot;).setLimit(50).setIsNullable(false).build();</span>
<span class="fc" id="L1287">    context.execute(</span>
<span class="fc" id="L1288">      newTableBuilder(tableName)</span>
<span class="fc" id="L1289">        .addPkColumn(UUID_COL)</span>
<span class="fc" id="L1290">        .addColumn(projectUuid)</span>
<span class="fc" id="L1291">        .addColumn(profileKey)</span>
<span class="fc" id="L1292">        .build());</span>
<span class="fc" id="L1293">    addIndex(context, tableName, &quot;uniq_project_qprofiles&quot;, true, projectUuid, profileKey);</span>
<span class="fc" id="L1294">  }</span>

  private void createProjects(Context context) {
<span class="fc" id="L1297">    String tableName = &quot;projects&quot;;</span>
<span class="fc" id="L1298">    VarcharColumnDef keeCol = newVarcharColumnDefBuilder(&quot;kee&quot;).setLimit(400).setIsNullable(false).build();</span>
<span class="fc" id="L1299">    VarcharColumnDef qualifierCol = newVarcharColumnDefBuilder(&quot;qualifier&quot;).setLimit(10).setIsNullable(false).build();</span>
<span class="fc" id="L1300">    context.execute(</span>
<span class="fc" id="L1301">      newTableBuilder(tableName)</span>
<span class="fc" id="L1302">        .addPkColumn(UUID_COL)</span>
<span class="fc" id="L1303">        .addColumn(keeCol)</span>
<span class="fc" id="L1304">        .addColumn(qualifierCol)</span>
<span class="fc" id="L1305">        .addColumn(newVarcharColumnDefBuilder(&quot;name&quot;).setLimit(2_000).setIsNullable(true).build())</span>
<span class="fc" id="L1306">        .addColumn(newVarcharColumnDefBuilder(DESCRIPTION_COL_NAME).setLimit(2_000).setIsNullable(true).build())</span>
<span class="fc" id="L1307">        .addColumn(newBooleanColumnDefBuilder().setColumnName(PRIVATE_COL_NAME).setIsNullable(false).build())</span>
<span class="fc" id="L1308">        .addColumn(newVarcharColumnDefBuilder(&quot;tags&quot;).setLimit(500).setIsNullable(true).build())</span>
<span class="fc" id="L1309">        .addColumn(NULLABLE_TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L1310">        .addColumn(TECHNICAL_UPDATED_AT_COL)</span>
<span class="fc" id="L1311">        .addColumn(newBigIntegerColumnDefBuilder().setColumnName(&quot;ncloc&quot;).setIsNullable(true).build())</span>
<span class="fc" id="L1312">        .addColumn(newVarcharColumnDefBuilder().setColumnName(&quot;creation_method&quot;).setLimit(50).setIsNullable(false).build())</span>
<span class="fc" id="L1313">        .addColumn(newBooleanColumnDefBuilder().setColumnName(&quot;contains_ai_code&quot;).setIsNullable(false).setDefaultValue(false).build())</span>
<span class="fc" id="L1314">        .addColumn(newBooleanColumnDefBuilder().setColumnName(&quot;ai_code_fix_enabled&quot;).setIsNullable(false).setDefaultValue(false).build())</span>
<span class="fc" id="L1315">        .withPkConstraintName(&quot;pk_new_projects&quot;)</span>
<span class="fc" id="L1316">        .build());</span>
<span class="fc" id="L1317">    addIndex(context, tableName, &quot;uniq_projects_kee&quot;, true, keeCol);</span>
<span class="fc" id="L1318">    addIndex(context, tableName, &quot;idx_qualifier&quot;, false, qualifierCol);</span>
<span class="fc" id="L1319">  }</span>

  private void createProjectQGates(Context context) {
<span class="fc" id="L1322">    String tableName = &quot;project_qgates&quot;;</span>
<span class="fc" id="L1323">    VarcharColumnDef projectUuidCol = newVarcharColumnDefBuilder(PROJECT_UUID_COL_NAME).setLimit(UUID_SIZE).setIsNullable(false).build();</span>
<span class="fc" id="L1324">    VarcharColumnDef qualityGateUuidCol = newVarcharColumnDefBuilder(QUALITY_GATE_UUID_COL_NAME).setLimit(UUID_SIZE).setIsNullable(false).build();</span>
<span class="fc" id="L1325">    context.execute(</span>
<span class="fc" id="L1326">      newTableBuilder(tableName)</span>
<span class="fc" id="L1327">        .addPkColumn(projectUuidCol)</span>
<span class="fc" id="L1328">        .addColumn(qualityGateUuidCol)</span>
<span class="fc" id="L1329">        .build());</span>
<span class="fc" id="L1330">    addIndex(context, tableName, &quot;uniq_project_qgates&quot;, true, projectUuidCol, qualityGateUuidCol);</span>
<span class="fc" id="L1331">  }</span>

  private void createProperties(Context context) {
<span class="fc" id="L1334">    String tableName = &quot;properties&quot;;</span>
<span class="fc" id="L1335">    VarcharColumnDef propKey = newVarcharColumnDefBuilder(&quot;prop_key&quot;).setLimit(512).setIsNullable(false).build();</span>
<span class="fc" id="L1336">    VarcharColumnDef entityUuidColumn = newVarcharColumnDefBuilder().setColumnName(&quot;entity_uuid&quot;).setIsNullable(true).setLimit(UUID_SIZE).build();</span>
<span class="fc" id="L1337">    VarcharColumnDef userUuidColumn = newVarcharColumnDefBuilder().setColumnName(USER_UUID_COL_NAME).setIsNullable(true).setLimit(USER_UUID_SIZE).build();</span>
<span class="fc" id="L1338">    context.execute(newTableBuilder(tableName)</span>
<span class="fc" id="L1339">      .addPkColumn(UUID_COL)</span>
<span class="fc" id="L1340">      .addColumn(propKey)</span>
<span class="fc" id="L1341">      .addColumn(newBooleanColumnDefBuilder().setColumnName(IS_EMPTY_COL_NAME).setIsNullable(false).build())</span>
<span class="fc" id="L1342">      .addColumn(newVarcharColumnDefBuilder(TEXT_VALUE_COL_NAME).setLimit(MAX_SIZE).build())</span>
<span class="fc" id="L1343">      .addColumn(newClobColumnDefBuilder().setColumnName(CLOB_VALUE_COL_NAME).setIsNullable(true).build())</span>
<span class="fc" id="L1344">      .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L1345">      .addColumn(entityUuidColumn)</span>
<span class="fc" id="L1346">      .addColumn(userUuidColumn)</span>
      // table with be renamed to properties in following migration, use final constraint name right away
<span class="fc" id="L1348">      .withPkConstraintName(&quot;pk_properties&quot;)</span>
<span class="fc" id="L1349">      .build());</span>
<span class="fc" id="L1350">    addIndex(context, tableName, &quot;properties_key&quot;, false, propKey);</span>
<span class="fc" id="L1351">    addIndex(context, tableName, &quot;uniq_properties&quot;, true, propKey, entityUuidColumn, userUuidColumn);</span>
<span class="fc" id="L1352">  }</span>

  private void createPushEvents(Context context) {
<span class="fc" id="L1355">    String tableName = &quot;push_events&quot;;</span>
<span class="fc" id="L1356">    VarcharColumnDef projectUuidCol = newVarcharColumnDefBuilder(PROJECT_UUID_COL_NAME).setLimit(UUID_SIZE).setIsNullable(false).build();</span>
<span class="fc" id="L1357">    context.execute(newTableBuilder(tableName)</span>
<span class="fc" id="L1358">      .addPkColumn(UUID_COL)</span>
<span class="fc" id="L1359">      .addColumn(newVarcharColumnDefBuilder(&quot;name&quot;).setLimit(40).setIsNullable(false).build())</span>
<span class="fc" id="L1360">      .addColumn(projectUuidCol)</span>
<span class="fc" id="L1361">      .addColumn(newBlobColumnDefBuilder().setColumnName(&quot;payload&quot;).setIsNullable(false).build())</span>
<span class="fc" id="L1362">      .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L1363">      .addColumn(newVarcharColumnDefBuilder(LANGUAGE_COL_NAME).setLimit(20).build())</span>
<span class="fc" id="L1364">      .build());</span>
<span class="fc" id="L1365">    addIndex(context, tableName, &quot;idx_push_even_crea_uuid_proj&quot;, false, TECHNICAL_CREATED_AT_COL, UUID_COL, projectUuidCol);</span>
<span class="fc" id="L1366">  }</span>

  private void createReportSchedules(Context context) {
<span class="fc" id="L1369">    String tableName = &quot;report_schedules&quot;;</span>
<span class="fc" id="L1370">    VarcharColumnDef portfolioUuidColumn = newVarcharColumnDefBuilder().setColumnName(&quot;portfolio_uuid&quot;).setIsNullable(true).setLimit(UUID_SIZE).build();</span>
<span class="fc" id="L1371">    VarcharColumnDef branchUuidColumn = newVarcharColumnDefBuilder().setColumnName(&quot;branch_uuid&quot;).setIsNullable(true).setLimit(UUID_SIZE).build();</span>
<span class="fc" id="L1372">    context.execute(new CreateTableBuilder(getDialect(), &quot;report_schedules&quot;)</span>
<span class="fc" id="L1373">      .addPkColumn(newVarcharColumnDefBuilder().setColumnName(&quot;uuid&quot;).setIsNullable(false).setLimit(UUID_SIZE).build())</span>
<span class="fc" id="L1374">      .addColumn(portfolioUuidColumn)</span>
<span class="fc" id="L1375">      .addColumn(branchUuidColumn)</span>
<span class="fc" id="L1376">      .addColumn(newBigIntegerColumnDefBuilder().setColumnName(&quot;last_send_time_in_ms&quot;).setIsNullable(false).build())</span>
<span class="fc" id="L1377">      .build());</span>

<span class="fc" id="L1379">    addIndex(context, tableName, &quot;uniq_report_schedules&quot;, true, portfolioUuidColumn, branchUuidColumn);</span>
<span class="fc" id="L1380">  }</span>

  private void createReportSubscriptions(Context context) {
<span class="fc" id="L1383">    String tableName = &quot;report_subscriptions&quot;;</span>
<span class="fc" id="L1384">    VarcharColumnDef portfolioUuidColumn = newVarcharColumnDefBuilder().setColumnName(&quot;portfolio_uuid&quot;).setIsNullable(true).setLimit(UUID_SIZE).build();</span>
<span class="fc" id="L1385">    VarcharColumnDef branchUuidColumn = newVarcharColumnDefBuilder().setColumnName(&quot;branch_uuid&quot;).setIsNullable(true).setLimit(UUID_SIZE).build();</span>
<span class="fc" id="L1386">    VarcharColumnDef userUuidColumn = newVarcharColumnDefBuilder().setColumnName(&quot;user_uuid&quot;).setIsNullable(false).setLimit(UUID_SIZE).build();</span>
<span class="fc" id="L1387">    context.execute(new CreateTableBuilder(getDialect(), tableName)</span>
<span class="fc" id="L1388">      .addPkColumn(newVarcharColumnDefBuilder().setColumnName(&quot;uuid&quot;).setIsNullable(false).setLimit(UUID_SIZE).build())</span>
<span class="fc" id="L1389">      .addColumn(portfolioUuidColumn)</span>
<span class="fc" id="L1390">      .addColumn(branchUuidColumn)</span>
<span class="fc" id="L1391">      .addColumn(userUuidColumn)</span>
<span class="fc" id="L1392">      .build());</span>

<span class="fc" id="L1394">    addIndex(context, tableName, &quot;uniq_report_subscriptions&quot;, true, portfolioUuidColumn, branchUuidColumn, userUuidColumn);</span>
<span class="fc" id="L1395">  }</span>

  private void createRuleChanges(Context context) {
<span class="fc" id="L1398">    String tableName = &quot;rule_changes&quot;;</span>
<span class="fc" id="L1399">    context.execute(new CreateTableBuilder(getDialect(), tableName)</span>
<span class="fc" id="L1400">      .addPkColumn(newVarcharColumnDefBuilder().setColumnName(&quot;uuid&quot;).setIsNullable(false).setLimit(UUID_SIZE).build())</span>
<span class="fc" id="L1401">      .addColumn(newVarcharColumnDefBuilder().setColumnName(&quot;new_clean_code_attribute&quot;).setIsNullable(true).setLimit(40).build())</span>
<span class="fc" id="L1402">      .addColumn(newVarcharColumnDefBuilder().setColumnName(&quot;old_clean_code_attribute&quot;).setIsNullable(true).setLimit(40).build())</span>
<span class="fc" id="L1403">      .addColumn(newVarcharColumnDefBuilder().setColumnName(&quot;rule_uuid&quot;).setIsNullable(false).setLimit(UUID_SIZE).build())</span>
<span class="fc" id="L1404">      .build());</span>
<span class="fc" id="L1405">  }</span>

  private void createRuleImpactChanges(Context context) {
<span class="fc" id="L1408">    String tableName = &quot;rule_impact_changes&quot;;</span>
<span class="fc" id="L1409">    VarcharColumnDef ruleChangeUuidColumn = newVarcharColumnDefBuilder().setColumnName(&quot;rule_change_uuid&quot;).setIsNullable(false).setLimit(40).build();</span>
<span class="fc" id="L1410">    context.execute(new CreateTableBuilder(getDialect(), tableName)</span>
<span class="fc" id="L1411">      .addColumn(newVarcharColumnDefBuilder().setColumnName(&quot;new_software_quality&quot;).setIsNullable(true).setLimit(40).build())</span>
<span class="fc" id="L1412">      .addColumn(newVarcharColumnDefBuilder().setColumnName(&quot;old_software_quality&quot;).setIsNullable(true).setLimit(40).build())</span>
<span class="fc" id="L1413">      .addColumn(newVarcharColumnDefBuilder().setColumnName(&quot;new_severity&quot;).setIsNullable(true).setLimit(40).build())</span>
<span class="fc" id="L1414">      .addColumn(newVarcharColumnDefBuilder().setColumnName(&quot;old_severity&quot;).setIsNullable(true).setLimit(40).build())</span>
<span class="fc" id="L1415">      .addColumn(ruleChangeUuidColumn)</span>
<span class="fc" id="L1416">      .build());</span>

<span class="fc" id="L1418">    addIndex(context, tableName, &quot;rule_impact_changes_r_c_uuid&quot;, false, ruleChangeUuidColumn);</span>
<span class="fc" id="L1419">  }</span>

  private void createQGateGroupPermissions(Context context) {
<span class="fc" id="L1422">    String tableName = &quot;qgate_group_permissions&quot;;</span>
<span class="fc" id="L1423">    VarcharColumnDef qualityGateUuidColumn = newVarcharColumnDefBuilder(QUALITY_GATE_UUID_COL_NAME).setLimit(UUID_SIZE).setIsNullable(false).build();</span>
<span class="fc" id="L1424">    context.execute(newTableBuilder(tableName)</span>
<span class="fc" id="L1425">      .addPkColumn(UUID_COL)</span>
<span class="fc" id="L1426">      .addColumn(qualityGateUuidColumn)</span>
<span class="fc" id="L1427">      .addColumn(newVarcharColumnDefBuilder(GROUP_UUID_COL_NAME).setLimit(UUID_SIZE).setIsNullable(false).build())</span>
<span class="fc" id="L1428">      .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L1429">      .build());</span>
<span class="fc" id="L1430">    addIndex(context, tableName, &quot;qg_groups_uuid_idx&quot;, false, qualityGateUuidColumn);</span>
<span class="fc" id="L1431">  }</span>

  private void createQGateUserPermissions(Context context) {
<span class="fc" id="L1434">    String tableName = &quot;qgate_user_permissions&quot;;</span>
<span class="fc" id="L1435">    VarcharColumnDef qualityGateUuidColumn = newVarcharColumnDefBuilder(QUALITY_GATE_UUID_COL_NAME).setLimit(UUID_SIZE).setIsNullable(false).build();</span>
<span class="fc" id="L1436">    context.execute(newTableBuilder(tableName)</span>
<span class="fc" id="L1437">      .addPkColumn(UUID_COL)</span>
<span class="fc" id="L1438">      .addColumn(qualityGateUuidColumn)</span>
<span class="fc" id="L1439">      .addColumn(newVarcharColumnDefBuilder(USER_UUID_COL_NAME).setLimit(UUID_SIZE).setIsNullable(false).build())</span>
<span class="fc" id="L1440">      .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L1441">      .build());</span>
<span class="fc" id="L1442">    addIndex(context, tableName, &quot;quality_gate_uuid_idx&quot;, false, qualityGateUuidColumn);</span>
<span class="fc" id="L1443">  }</span>

  private void createQProfileChanges(Context context) {
<span class="fc" id="L1446">    String tableName = &quot;qprofile_changes&quot;;</span>
<span class="fc" id="L1447">    VarcharColumnDef rulesProfileUuidCol = newVarcharColumnDefBuilder(&quot;rules_profile_uuid&quot;).setLimit(255).setIsNullable(false).build();</span>
<span class="fc" id="L1448">    context.execute(newTableBuilder(tableName)</span>
<span class="fc" id="L1449">      .addPkColumn(newVarcharColumnDefBuilder(&quot;kee&quot;).setLimit(UUID_SIZE).setIsNullable(false).build())</span>
<span class="fc" id="L1450">      .addColumn(rulesProfileUuidCol)</span>
<span class="fc" id="L1451">      .addColumn(newVarcharColumnDefBuilder(&quot;change_type&quot;).setLimit(20).setIsNullable(false).build())</span>
<span class="fc" id="L1452">      .addColumn(newVarcharColumnDefBuilder(USER_UUID_COL_NAME).setLimit(USER_UUID_SIZE).setIsNullable(true).build())</span>
<span class="fc" id="L1453">      .addColumn(newClobColumnDefBuilder().setColumnName(&quot;change_data&quot;).setIsNullable(true).build())</span>
<span class="fc" id="L1454">      .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L1455">      .addColumn(newVarcharColumnDefBuilder().setColumnName(&quot;rule_change_uuid&quot;).setLimit(40).setIsNullable(true).build())</span>
<span class="fc" id="L1456">      .addColumn(newVarcharColumnDefBuilder().setColumnName(&quot;sq_version&quot;).setLimit(40).setIsNullable(true).build())</span>
<span class="fc" id="L1457">      .build());</span>
<span class="fc" id="L1458">    addIndex(context, tableName, &quot;qp_changes_rules_profile_uuid&quot;, false, rulesProfileUuidCol);</span>
<span class="fc" id="L1459">  }</span>

  private void createQProfileEditGroups(Context context) {
<span class="fc" id="L1462">    String tableName = &quot;qprofile_edit_groups&quot;;</span>
<span class="fc" id="L1463">    VarcharColumnDef qProfileUuidCol = newVarcharColumnDefBuilder(QPROFILE_UUID_COL_NAME).setIsNullable(false).setLimit(255).build();</span>
<span class="fc" id="L1464">    VarcharColumnDef groupUuidCol = newVarcharColumnDefBuilder(GROUP_UUID_COL_NAME).setLimit(UUID_SIZE).setIsNullable(false).build();</span>
<span class="fc" id="L1465">    context.execute(newTableBuilder(tableName)</span>
<span class="fc" id="L1466">      .addPkColumn(UUID_COL)</span>
<span class="fc" id="L1467">      .addColumn(qProfileUuidCol)</span>
<span class="fc" id="L1468">      .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L1469">      .addColumn(groupUuidCol)</span>
<span class="fc" id="L1470">      .build());</span>
<span class="fc" id="L1471">    addIndex(context, tableName, tableName + &quot;_qprofile&quot;, false, qProfileUuidCol);</span>
<span class="fc" id="L1472">    addIndex(context, tableName, tableName + UNIQUE_INDEX_SUFFIX, true, groupUuidCol, qProfileUuidCol);</span>
<span class="fc" id="L1473">  }</span>

  private void createQProfileEditUsers(Context context) {
<span class="fc" id="L1476">    String tableName = &quot;qprofile_edit_users&quot;;</span>
<span class="fc" id="L1477">    VarcharColumnDef qProfileUuidCol = newVarcharColumnDefBuilder(QPROFILE_UUID_COL_NAME).setLimit(255).setIsNullable(false).build();</span>
<span class="fc" id="L1478">    VarcharColumnDef userUuidCol = newVarcharColumnDefBuilder(USER_UUID_COL_NAME).setLimit(255).setIsNullable(false).build();</span>
<span class="fc" id="L1479">    context.execute(newTableBuilder(tableName)</span>
<span class="fc" id="L1480">      .addPkColumn(UUID_COL)</span>
<span class="fc" id="L1481">      .addColumn(qProfileUuidCol)</span>
<span class="fc" id="L1482">      .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L1483">      .addColumn(userUuidCol)</span>
<span class="fc" id="L1484">      .build());</span>
<span class="fc" id="L1485">    addIndex(context, tableName, tableName + &quot;_qprofile&quot;, false, qProfileUuidCol);</span>
<span class="fc" id="L1486">    addIndex(context, tableName, tableName + UNIQUE_INDEX_SUFFIX, true, userUuidCol, qProfileUuidCol);</span>
<span class="fc" id="L1487">  }</span>

  private void createQualityGateConditions(Context context) {
<span class="fc" id="L1490">    context.execute(</span>
<span class="fc" id="L1491">      newTableBuilder(&quot;quality_gate_conditions&quot;)</span>
<span class="fc" id="L1492">        .addPkColumn(UUID_COL)</span>
<span class="fc" id="L1493">        .addColumn(newVarcharColumnDefBuilder(&quot;operator&quot;).setLimit(3).setIsNullable(true).build())</span>
<span class="fc" id="L1494">        .addColumn(newVarcharColumnDefBuilder(&quot;value_error&quot;).setLimit(64).setIsNullable(true).build())</span>
<span class="fc" id="L1495">        .addColumn(DEPRECATED_TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L1496">        .addColumn(DEPRECATED_TECHNICAL_UPDATED_AT_COL)</span>
<span class="fc" id="L1497">        .addColumn(newVarcharColumnDefBuilder(METRIC_UUID_COL_NAME).setLimit(UUID_SIZE).setIsNullable(false).build())</span>
<span class="fc" id="L1498">        .addColumn(newVarcharColumnDefBuilder(&quot;qgate_uuid&quot;).setLimit(UUID_SIZE).setIsNullable(false).build())</span>
<span class="fc" id="L1499">        .build());</span>
<span class="fc" id="L1500">  }</span>

  private void createQualityGates(Context context) {
<span class="fc" id="L1503">    context.execute(</span>
<span class="fc" id="L1504">      newTableBuilder(&quot;quality_gates&quot;)</span>
<span class="fc" id="L1505">        .addPkColumn(UUID_COL)</span>
<span class="fc" id="L1506">        .addColumn(newVarcharColumnDefBuilder(&quot;name&quot;).setLimit(100).setIsNullable(false).build())</span>
<span class="fc" id="L1507">        .addColumn(newBooleanColumnDefBuilder().setColumnName(&quot;is_built_in&quot;).setIsNullable(false).build())</span>
<span class="fc" id="L1508">        .addColumn(DEPRECATED_TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L1509">        .addColumn(DEPRECATED_TECHNICAL_UPDATED_AT_COL)</span>
<span class="fc" id="L1510">        .addColumn(newBooleanColumnDefBuilder().setColumnName(&quot;ai_code_supported&quot;).setIsNullable(false).setDefaultValue(false).build())</span>
<span class="fc" id="L1511">        .build());</span>
<span class="fc" id="L1512">  }</span>


  private void createScimGroups(Context context) {
<span class="fc" id="L1516">    String tableName = &quot;scim_groups&quot;;</span>
<span class="fc" id="L1517">    VarcharColumnDef groupUuidColumn = newVarcharColumnDefBuilder().setColumnName(&quot;group_uuid&quot;).setIsNullable(false).setLimit(UUID_SIZE).build();</span>
<span class="fc" id="L1518">    context.execute(new CreateTableBuilder(getDialect(), tableName)</span>
<span class="fc" id="L1519">      .addPkColumn(newVarcharColumnDefBuilder().setColumnName(&quot;scim_uuid&quot;).setIsNullable(false).setLimit(UUID_SIZE).build())</span>
<span class="fc" id="L1520">      .addColumn(groupUuidColumn)</span>
<span class="fc" id="L1521">      .build());</span>

<span class="fc" id="L1523">    addIndex(context, tableName, &quot;uniq_scim_group_uuid&quot;, true, groupUuidColumn);</span>
<span class="fc" id="L1524">  }</span>

  private void createScimUsers(Context context) {
<span class="fc" id="L1527">    String tableName = &quot;scim_users&quot;;</span>
<span class="fc" id="L1528">    VarcharColumnDef userUuidCol = newVarcharColumnDefBuilder(USER_UUID_COL_NAME).setLimit(UUID_SIZE).setIsNullable(false).build();</span>
<span class="fc" id="L1529">    context.execute(</span>
<span class="fc" id="L1530">      newTableBuilder(tableName)</span>
<span class="fc" id="L1531">        .addPkColumn(newVarcharColumnDefBuilder().setColumnName(&quot;scim_uuid&quot;).setIsNullable(false).setLimit(UUID_SIZE).build())</span>
<span class="fc" id="L1532">        .addColumn(userUuidCol)</span>
<span class="fc" id="L1533">        .build());</span>

<span class="fc" id="L1535">    addIndex(context, tableName, &quot;uniq_scim_users_user_uuid&quot;, true, userUuidCol);</span>
<span class="fc" id="L1536">  }</span>

  private void createScmAccounts(Context context) {
<span class="fc" id="L1539">    String tableName = &quot;scm_accounts&quot;;</span>
<span class="fc" id="L1540">    ColumnDef scmAccountColumn = newVarcharColumnDefBuilder().setColumnName(&quot;scm_account&quot;).setIsNullable(false).setLimit(255).build();</span>

<span class="fc" id="L1542">    context.execute(new CreateTableBuilder(getDialect(), tableName)</span>
<span class="fc" id="L1543">      .addPkColumn(newVarcharColumnDefBuilder().setColumnName(USER_UUID_COL_NAME).setIsNullable(false).setLimit(USER_UUID_SIZE).build())</span>
<span class="fc" id="L1544">      .addPkColumn(scmAccountColumn)</span>
<span class="fc" id="L1545">      .build());</span>

<span class="fc" id="L1547">    addIndex(context, tableName, &quot;scm_accounts_scm_account&quot;, false, scmAccountColumn);</span>
<span class="fc" id="L1548">  }</span>

  private void createSessionTokens(Context context) {
<span class="fc" id="L1551">    String tableName = &quot;session_tokens&quot;;</span>
<span class="fc" id="L1552">    VarcharColumnDef userUuidCol = newVarcharColumnDefBuilder(USER_UUID_COL_NAME).setLimit(255).setIsNullable(false).build();</span>
<span class="fc" id="L1553">    context.execute(</span>
<span class="fc" id="L1554">      newTableBuilder(tableName)</span>
<span class="fc" id="L1555">        .addPkColumn(UUID_COL)</span>
<span class="fc" id="L1556">        .addColumn(userUuidCol)</span>
<span class="fc" id="L1557">        .addColumn(newBigIntegerColumnDefBuilder().setColumnName(EXPIRATION_DATE_COL_NAME).setIsNullable(false).build())</span>
<span class="fc" id="L1558">        .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L1559">        .addColumn(TECHNICAL_UPDATED_AT_COL)</span>
<span class="fc" id="L1560">        .build());</span>

<span class="fc" id="L1562">    addIndex(context, tableName, &quot;session_tokens_user_uuid&quot;, false, userUuidCol);</span>
<span class="fc" id="L1563">  }</span>

  private void createRulesRepository(Context context) {
<span class="fc" id="L1566">    String tableName = &quot;rule_repositories&quot;;</span>
<span class="fc" id="L1567">    context.execute(newTableBuilder(tableName)</span>
<span class="fc" id="L1568">      .addPkColumn(newVarcharColumnDefBuilder(&quot;kee&quot;).setLimit(200).setIsNullable(false).build())</span>
<span class="fc" id="L1569">      .addColumn(newVarcharColumnDefBuilder(LANGUAGE_COL_NAME).setLimit(20).setIsNullable(false).build())</span>
<span class="fc" id="L1570">      .addColumn(newVarcharColumnDefBuilder(&quot;name&quot;).setLimit(4_000).setIsNullable(false).build())</span>
<span class="fc" id="L1571">      .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L1572">      .build());</span>
<span class="fc" id="L1573">  }</span>

  private void createRuleDescSections(Context context) {
<span class="fc" id="L1576">    String tableName = &quot;rule_desc_sections&quot;;</span>
<span class="fc" id="L1577">    VarcharColumnDef ruleUuidCol = newVarcharColumnDefBuilder().setColumnName(RULE_UUID_COL_NAME).setIsNullable(false).setLimit(UUID_SIZE).build();</span>
<span class="fc" id="L1578">    VarcharColumnDef keeCol = newVarcharColumnDefBuilder().setColumnName(&quot;kee&quot;).setIsNullable(false).setLimit(DESCRIPTION_SECTION_KEY_SIZE).build();</span>
<span class="fc" id="L1579">    VarcharColumnDef contextKeyCol = newVarcharColumnDefBuilder().setColumnName(&quot;context_key&quot;).setIsNullable(true).setLimit(DESCRIPTION_SECTION_KEY_SIZE).build();</span>
<span class="fc" id="L1580">    context.execute(newTableBuilder(tableName)</span>
<span class="fc" id="L1581">      .addPkColumn(newVarcharColumnDefBuilder().setColumnName(&quot;uuid&quot;).setIsNullable(false).setLimit(UUID_SIZE).build())</span>
<span class="fc" id="L1582">      .addColumn(ruleUuidCol)</span>
<span class="fc" id="L1583">      .addColumn(keeCol)</span>
<span class="fc" id="L1584">      .addColumn(newClobColumnDefBuilder().setColumnName(&quot;content&quot;).setIsNullable(false).build())</span>
<span class="fc" id="L1585">      .addColumn(contextKeyCol)</span>
<span class="fc" id="L1586">      .addColumn(newVarcharColumnDefBuilder().setColumnName(&quot;context_display_name&quot;).setIsNullable(true).setLimit(50).build())</span>
<span class="fc" id="L1587">      .build());</span>

<span class="fc" id="L1589">    addIndex(context, tableName, &quot;uniq_rule_desc_sections&quot;, true, ruleUuidCol, keeCol, contextKeyCol);</span>
<span class="fc" id="L1590">  }</span>

  private void createRules(Context context) {
<span class="fc" id="L1593">    VarcharColumnDef pluginRuleKeyCol = newVarcharColumnDefBuilder(&quot;plugin_rule_key&quot;).setLimit(200).setIsNullable(false).build();</span>
<span class="fc" id="L1594">    VarcharColumnDef pluginNameCol = newVarcharColumnDefBuilder(&quot;plugin_name&quot;).setLimit(255).setIsNullable(false).build();</span>
<span class="fc" id="L1595">    context.execute(</span>
<span class="fc" id="L1596">      newTableBuilder(&quot;rules&quot;)</span>
<span class="fc" id="L1597">        .addPkColumn(UUID_COL)</span>
<span class="fc" id="L1598">        .addColumn(newVarcharColumnDefBuilder(&quot;name&quot;).setLimit(200).setIsNullable(true).build())</span>
<span class="fc" id="L1599">        .addColumn(pluginRuleKeyCol)</span>
<span class="fc" id="L1600">        .addColumn(newVarcharColumnDefBuilder(&quot;plugin_key&quot;).setLimit(200).setIsNullable(true).build())</span>
<span class="fc" id="L1601">        .addColumn(newVarcharColumnDefBuilder(&quot;plugin_config_key&quot;).setLimit(200).setIsNullable(true).build())</span>
<span class="fc" id="L1602">        .addColumn(pluginNameCol)</span>
<span class="fc" id="L1603">        .addColumn(newVarcharColumnDefBuilder(&quot;scope&quot;).setLimit(20).setIsNullable(false).build())</span>
<span class="fc" id="L1604">        .addColumn(newIntegerColumnDefBuilder().setColumnName(&quot;priority&quot;).setIsNullable(true).build())</span>
<span class="fc" id="L1605">        .addColumn(newVarcharColumnDefBuilder(STATUS_COL_NAME).setLimit(40).setIsNullable(true).build())</span>
<span class="fc" id="L1606">        .addColumn(newVarcharColumnDefBuilder(LANGUAGE_COL_NAME).setLimit(20).setIsNullable(true).build())</span>
<span class="fc" id="L1607">        .addColumn(newVarcharColumnDefBuilder(&quot;def_remediation_function&quot;).setLimit(20).setIsNullable(true).build())</span>
<span class="fc" id="L1608">        .addColumn(newVarcharColumnDefBuilder(&quot;def_remediation_gap_mult&quot;).setLimit(20).setIsNullable(true).build())</span>
<span class="fc" id="L1609">        .addColumn(newVarcharColumnDefBuilder(&quot;def_remediation_base_effort&quot;).setLimit(20).setIsNullable(true).build())</span>
<span class="fc" id="L1610">        .addColumn(newVarcharColumnDefBuilder(&quot;gap_description&quot;).setLimit(MAX_SIZE).setIsNullable(true).build())</span>
<span class="fc" id="L1611">        .addColumn(newBooleanColumnDefBuilder().setColumnName(&quot;is_template&quot;).setIsNullable(false).setDefaultValue(false).build())</span>
<span class="fc" id="L1612">        .addColumn(newVarcharColumnDefBuilder(&quot;description_format&quot;).setLimit(20).setIsNullable(true).build())</span>
<span class="fc" id="L1613">        .addColumn(new TinyIntColumnDef.Builder().setColumnName(&quot;rule_type&quot;).setIsNullable(true).build())</span>
<span class="fc" id="L1614">        .addColumn(newVarcharColumnDefBuilder(&quot;security_standards&quot;).setIsNullable(true).setLimit(4_000).build())</span>
<span class="fc" id="L1615">        .addColumn(newBooleanColumnDefBuilder().setColumnName(&quot;is_ad_hoc&quot;).setIsNullable(false).build())</span>
<span class="fc" id="L1616">        .addColumn(newBooleanColumnDefBuilder().setColumnName(&quot;is_external&quot;).setIsNullable(false).build())</span>
<span class="fc" id="L1617">        .addColumn(NULLABLE_TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L1618">        .addColumn(NULLABLE_TECHNICAL_UPDATED_AT_COL)</span>
<span class="fc" id="L1619">        .addColumn(newVarcharColumnDefBuilder(TEMPLATE_UUID_COL_NAME).setIsNullable(true).setLimit(UUID_SIZE).build())</span>
<span class="fc" id="L1620">        .addColumn(newClobColumnDefBuilder().setColumnName(&quot;note_data&quot;).setIsNullable(true).build())</span>
<span class="fc" id="L1621">        .addColumn(newVarcharColumnDefBuilder(&quot;note_user_uuid&quot;).setLimit(USER_UUID_SIZE).setIsNullable(true).build())</span>
<span class="fc" id="L1622">        .addColumn(newBigIntegerColumnDefBuilder().setColumnName(&quot;note_created_at&quot;).setIsNullable(true).build())</span>
<span class="fc" id="L1623">        .addColumn(newBigIntegerColumnDefBuilder().setColumnName(&quot;note_updated_at&quot;).setIsNullable(true).build())</span>
<span class="fc" id="L1624">        .addColumn(newVarcharColumnDefBuilder(&quot;remediation_function&quot;).setLimit(20).setIsNullable(true).build())</span>
<span class="fc" id="L1625">        .addColumn(newVarcharColumnDefBuilder(&quot;remediation_gap_mult&quot;).setLimit(20).setIsNullable(true).build())</span>
<span class="fc" id="L1626">        .addColumn(newVarcharColumnDefBuilder(&quot;remediation_base_effort&quot;).setLimit(20).setIsNullable(true).build())</span>
<span class="fc" id="L1627">        .addColumn(newVarcharColumnDefBuilder(&quot;ad_hoc_name&quot;).setLimit(200).setIsNullable(true).build())</span>
<span class="fc" id="L1628">        .addColumn(newClobColumnDefBuilder().setColumnName(&quot;ad_hoc_description&quot;).setIsNullable(true).build())</span>
<span class="fc" id="L1629">        .addColumn(newVarcharColumnDefBuilder(&quot;ad_hoc_severity&quot;).setLimit(10).setIsNullable(true).build())</span>
<span class="fc" id="L1630">        .addColumn(newTinyIntColumnDefBuilder().setColumnName(&quot;ad_hoc_type&quot;).setIsNullable(true).build())</span>
<span class="fc" id="L1631">        .addColumn(newVarcharColumnDefBuilder(&quot;education_principles&quot;).setLimit(255).setIsNullable(true).build())</span>
<span class="fc" id="L1632">        .addColumn(newVarcharColumnDefBuilder().setColumnName(&quot;clean_code_attribute&quot;).setLimit(40).setIsNullable(true).build())</span>
<span class="fc" id="L1633">        .build());</span>
<span class="fc" id="L1634">    addIndex(context, &quot;rules&quot;, &quot;rules_repo_key&quot;, true, pluginRuleKeyCol, pluginNameCol);</span>
<span class="fc" id="L1635">  }</span>

  private void createRulesDefaultImpacts(Context context) {
<span class="fc" id="L1638">    String tableName = &quot;rules_default_impacts&quot;;</span>
<span class="fc" id="L1639">    VarcharColumnDef ruleUuidColumn = newVarcharColumnDefBuilder().setColumnName(&quot;rule_uuid&quot;).setIsNullable(false).setLimit(UUID_SIZE).build();</span>
<span class="fc" id="L1640">    VarcharColumnDef softwareQualityColumn = newVarcharColumnDefBuilder().setColumnName(&quot;software_quality&quot;).setIsNullable(false).setLimit(40).build();</span>
<span class="fc" id="L1641">    context.execute(new CreateTableBuilder(getDialect(), &quot;rules_default_impacts&quot;)</span>
<span class="fc" id="L1642">      .addColumn(ruleUuidColumn)</span>
<span class="fc" id="L1643">      .addColumn(softwareQualityColumn)</span>
<span class="fc" id="L1644">      .addColumn(newVarcharColumnDefBuilder().setColumnName(&quot;severity&quot;).setIsNullable(false).setLimit(40).build())</span>
<span class="fc" id="L1645">      .build());</span>

<span class="fc" id="L1647">    addIndex(context, tableName, &quot;uniq_rul_uuid_sof_qual&quot;, true, ruleUuidColumn, softwareQualityColumn);</span>

<span class="fc" id="L1649">    context.execute(new AddPrimaryKeyBuilder(tableName, &quot;rule_uuid&quot;, &quot;software_quality&quot;).build());</span>
<span class="fc" id="L1650">  }</span>

  private void createRulesParameters(Context context) {
<span class="fc" id="L1653">    String tableName = &quot;rules_parameters&quot;;</span>
<span class="fc" id="L1654">    VarcharColumnDef ruleUuidCol = newVarcharColumnDefBuilder(RULE_UUID_COL_NAME).setLimit(UUID_SIZE).setIsNullable(false).build();</span>
<span class="fc" id="L1655">    VarcharColumnDef nameCol = newVarcharColumnDefBuilder(&quot;name&quot;).setLimit(128).setIsNullable(false).build();</span>
<span class="fc" id="L1656">    context.execute(</span>
<span class="fc" id="L1657">      newTableBuilder(tableName)</span>
<span class="fc" id="L1658">        .addPkColumn(UUID_COL)</span>
<span class="fc" id="L1659">        .addColumn(nameCol)</span>
<span class="fc" id="L1660">        .addColumn(newVarcharColumnDefBuilder(DESCRIPTION_COL_NAME).setLimit(MAX_SIZE).setIsNullable(true).build())</span>
<span class="fc" id="L1661">        .addColumn(newVarcharColumnDefBuilder(&quot;param_type&quot;).setLimit(512).setIsNullable(false).build())</span>
<span class="fc" id="L1662">        .addColumn(newVarcharColumnDefBuilder(&quot;default_value&quot;).setLimit(MAX_SIZE).setIsNullable(true).build())</span>
<span class="fc" id="L1663">        .addColumn(ruleUuidCol)</span>
<span class="fc" id="L1664">        .build());</span>
<span class="fc" id="L1665">    addIndex(context, tableName, &quot;rules_parameters_rule_uuid&quot;, false, ruleUuidCol);</span>
<span class="fc" id="L1666">    addIndex(context, tableName, &quot;rules_parameters_unique&quot;, true, ruleUuidCol, nameCol);</span>
<span class="fc" id="L1667">  }</span>

  private void createRulesProfiles(Context context) {
<span class="fc" id="L1670">    String tableName = &quot;rules_profiles&quot;;</span>
<span class="fc" id="L1671">    context.execute(</span>
<span class="fc" id="L1672">      newTableBuilder(tableName)</span>
<span class="fc" id="L1673">        .addPkColumn(UUID_COL)</span>
<span class="fc" id="L1674">        .addColumn(newVarcharColumnDefBuilder(&quot;name&quot;).setLimit(100).setIsNullable(false).build())</span>
<span class="fc" id="L1675">        .addColumn(newVarcharColumnDefBuilder(LANGUAGE_COL_NAME).setLimit(20).setIsNullable(true).build())</span>
<span class="fc" id="L1676">        .addColumn(newBooleanColumnDefBuilder().setColumnName(&quot;is_built_in&quot;).setIsNullable(false).build())</span>
<span class="fc" id="L1677">        .addColumn(newVarcharColumnDefBuilder(&quot;rules_updated_at&quot;).setLimit(100).setIsNullable(true).build())</span>
<span class="fc" id="L1678">        .addColumn(DEPRECATED_TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L1679">        .addColumn(DEPRECATED_TECHNICAL_UPDATED_AT_COL)</span>
<span class="fc" id="L1680">        .build());</span>
<span class="fc" id="L1681">  }</span>

  private void createRuleTags(Context context) {
<span class="fc" id="L1684">    String tableName = &quot;rule_tags&quot;;</span>
<span class="fc" id="L1685">    context.execute(new CreateTableBuilder(getDialect(), tableName)</span>
<span class="fc" id="L1686">      .addPkColumn(newVarcharColumnDefBuilder().setColumnName(&quot;value&quot;).setIsNullable(false).setLimit(400).build())</span>
<span class="fc" id="L1687">      .addPkColumn(newVarcharColumnDefBuilder().setColumnName(&quot;rule_uuid&quot;).setIsNullable(false).setLimit(UUID_SIZE).build())</span>
<span class="fc" id="L1688">      .addColumn(newBooleanColumnDefBuilder().setColumnName(&quot;is_system_tag&quot;).setIsNullable(false).build())</span>
<span class="fc" id="L1689">      .build());</span>
<span class="fc" id="L1690">  }</span>

  private void createSamlMessageIds(Context context) {
<span class="fc" id="L1693">    String tableName = &quot;saml_message_ids&quot;;</span>
<span class="fc" id="L1694">    VarcharColumnDef messageIdCol = newVarcharColumnDefBuilder(&quot;message_id&quot;).setLimit(255).setIsNullable(false).build();</span>
<span class="fc" id="L1695">    context.execute(</span>
<span class="fc" id="L1696">      newTableBuilder(tableName)</span>
<span class="fc" id="L1697">        .addPkColumn(UUID_COL)</span>
<span class="fc" id="L1698">        .addColumn(messageIdCol)</span>
<span class="fc" id="L1699">        .addColumn(newBigIntegerColumnDefBuilder().setColumnName(EXPIRATION_DATE_COL_NAME).setIsNullable(false).build())</span>
<span class="fc" id="L1700">        .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L1701">        .build());</span>
<span class="fc" id="L1702">    addIndex(context, tableName, &quot;saml_message_ids_unique&quot;, true, messageIdCol);</span>
<span class="fc" id="L1703">  }</span>

  private void createScannerAnalysisCache(Context context) {
<span class="fc" id="L1706">    String tableName = &quot;scanner_analysis_cache&quot;;</span>
<span class="fc" id="L1707">    context.execute(</span>
<span class="fc" id="L1708">      newTableBuilder(tableName)</span>
<span class="fc" id="L1709">        .addPkColumn(newVarcharColumnDefBuilder().setColumnName(BRANCH_UUID_COL_NAME).setIsNullable(false).setLimit(UUID_SIZE).build())</span>
<span class="fc" id="L1710">        .addColumn(newBlobColumnDefBuilder().setColumnName(&quot;data&quot;).setIsNullable(false).build())</span>
<span class="fc" id="L1711">        .build());</span>
<span class="fc" id="L1712">  }</span>

  private void createSnapshots(Context context) {
<span class="fc" id="L1715">    String tableName = &quot;snapshots&quot;;</span>
<span class="fc" id="L1716">    VarcharColumnDef uuidCol = newVarcharColumnDefBuilder(&quot;uuid&quot;).setLimit(OLD_UUID_VARCHAR_SIZE).setIsNullable(false).build();</span>
<span class="fc" id="L1717">    VarcharColumnDef rootComponentUuidColumn = newVarcharColumnDefBuilder(&quot;root_component_uuid&quot;).setLimit(OLD_UUID_VARCHAR_SIZE).setIsNullable(false).build();</span>
<span class="fc" id="L1718">    context.execute(</span>
<span class="fc" id="L1719">      newTableBuilder(tableName)</span>
<span class="fc" id="L1720">        .addPkColumn(uuidCol)</span>
<span class="fc" id="L1721">        .addColumn(rootComponentUuidColumn)</span>
<span class="fc" id="L1722">        .addColumn(newVarcharColumnDefBuilder(STATUS_COL_NAME).setLimit(4).setIsNullable(false).setDefaultValue(&quot;U&quot;).build())</span>
<span class="fc" id="L1723">        .addColumn(newBooleanColumnDefBuilder().setColumnName(&quot;islast&quot;).setIsNullable(false).setDefaultValue(false).build())</span>
<span class="fc" id="L1724">        .addColumn(newVarcharColumnDefBuilder(&quot;version&quot;).setLimit(500).setIsNullable(true).build())</span>
<span class="fc" id="L1725">        .addColumn(newVarcharColumnDefBuilder(&quot;build_string&quot;).setLimit(100).setIsNullable(true).build())</span>
<span class="fc" id="L1726">        .addColumn(newVarcharColumnDefBuilder(&quot;revision&quot;).setLimit(100).setIsNullable(true).build())</span>
<span class="fc" id="L1727">        .addColumn(newBigIntegerColumnDefBuilder().setColumnName(&quot;analysis_date&quot;).setIsNullable(true).build())</span>
<span class="fc" id="L1728">        .addColumn(newVarcharColumnDefBuilder(&quot;period1_mode&quot;).setLimit(100).setIsNullable(true).build())</span>
<span class="fc" id="L1729">        .addColumn(newVarcharColumnDefBuilder(&quot;period1_param&quot;).setLimit(100).setIsNullable(true).build())</span>
<span class="fc" id="L1730">        .addColumn(newBigIntegerColumnDefBuilder().setColumnName(&quot;period1_date&quot;).setIsNullable(true).build())</span>
<span class="fc" id="L1731">        .addColumn(NULLABLE_TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L1732">        .addColumn(newBooleanColumnDefBuilder(&quot;purged&quot;).setIsNullable(false).build())</span>
<span class="fc" id="L1733">        .build());</span>
<span class="fc" id="L1734">    addIndex(context, tableName, &quot;snapshots_root_component_uuid&quot;, false, rootComponentUuidColumn);</span>
<span class="fc" id="L1735">  }</span>

  private void createTelemetryMetricsSent(Context context) {
<span class="fc" id="L1738">    String tableName = &quot;telemetry_metrics_sent&quot;;</span>
<span class="fc" id="L1739">    context.execute(new CreateTableBuilder(getDialect(), tableName)</span>
<span class="fc" id="L1740">      .addPkColumn(newVarcharColumnDefBuilder().setColumnName(&quot;metric_key&quot;).setIsNullable(false)</span>
<span class="fc" id="L1741">        .setLimit(40).build())</span>
<span class="fc" id="L1742">      .addPkColumn(newVarcharColumnDefBuilder().setColumnName(&quot;dimension&quot;).setIsNullable(false)</span>
<span class="fc" id="L1743">        .setLimit(40).build())</span>
<span class="fc" id="L1744">      .addColumn(newBigIntegerColumnDefBuilder().setColumnName(&quot;last_sent&quot;).setIsNullable(false).build())</span>
<span class="fc" id="L1745">      .build());</span>
<span class="fc" id="L1746">  }</span>

  private void createUserRoles(Context context) {
<span class="fc" id="L1749">    String tableName = &quot;user_roles&quot;;</span>
<span class="fc" id="L1750">    VarcharColumnDef componentUuidCol = newVarcharColumnDefBuilder(&quot;entity_uuid&quot;).setLimit(UUID_SIZE).setIsNullable(true).build();</span>
<span class="fc" id="L1751">    VarcharColumnDef userUuidCol = newVarcharColumnDefBuilder(USER_UUID_COL_NAME).setLimit(USER_UUID_SIZE).setIsNullable(true).build();</span>
<span class="fc" id="L1752">    context.execute(</span>
<span class="fc" id="L1753">      newTableBuilder(tableName)</span>
<span class="fc" id="L1754">        .addPkColumn(UUID_COL)</span>
<span class="fc" id="L1755">        .addColumn(newVarcharColumnDefBuilder(&quot;role&quot;).setLimit(64).setIsNullable(false).build())</span>
<span class="fc" id="L1756">        .addColumn(componentUuidCol)</span>
<span class="fc" id="L1757">        .addColumn(userUuidCol)</span>
<span class="fc" id="L1758">        .build());</span>
<span class="fc" id="L1759">    addIndex(context, tableName, &quot;user_roles_user&quot;, false, userUuidCol);</span>
<span class="fc" id="L1760">    addIndex(context, tableName, &quot;user_roles_entity_uuid&quot;, false, componentUuidCol);</span>
<span class="fc" id="L1761">  }</span>

  private void createUserDismissedMessage(Context context) {
<span class="fc" id="L1764">    String tableName = &quot;user_dismissed_messages&quot;;</span>
<span class="fc" id="L1765">    VarcharColumnDef userUuidCol = newVarcharColumnDefBuilder(USER_UUID_COL_NAME).setLimit(USER_UUID_SIZE).setIsNullable(false).build();</span>
<span class="fc" id="L1766">    VarcharColumnDef projectUuidCol = newVarcharColumnDefBuilder(PROJECT_UUID_COL_NAME).setLimit(UUID_SIZE).setIsNullable(true).build();</span>
<span class="fc" id="L1767">    VarcharColumnDef messageTypeCol = newVarcharColumnDefBuilder(&quot;message_type&quot;).setLimit(255).setIsNullable(false).build();</span>
<span class="fc" id="L1768">    context.execute(</span>
<span class="fc" id="L1769">      newTableBuilder(tableName)</span>
<span class="fc" id="L1770">        .addPkColumn(UUID_COL)</span>
<span class="fc" id="L1771">        .addColumn(userUuidCol)</span>
<span class="fc" id="L1772">        .addColumn(projectUuidCol)</span>
<span class="fc" id="L1773">        .addColumn(messageTypeCol)</span>
<span class="fc" id="L1774">        .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L1775">        .build());</span>
<span class="fc" id="L1776">    addIndex(context, tableName, &quot;uniq_user_dismissed_messages&quot;, true, userUuidCol, projectUuidCol, messageTypeCol);</span>
<span class="fc" id="L1777">    addIndex(context, tableName, &quot;udm_project_uuid&quot;, false, projectUuidCol);</span>
<span class="fc" id="L1778">    addIndex(context, tableName, &quot;udm_message_type&quot;, false, messageTypeCol);</span>
<span class="fc" id="L1779">  }</span>

  private void createUserTokens(Context context) {
<span class="fc" id="L1782">    String tableName = &quot;user_tokens&quot;;</span>
<span class="fc" id="L1783">    VarcharColumnDef userUuidCol = newVarcharColumnDefBuilder(USER_UUID_COL_NAME).setLimit(USER_UUID_SIZE).setIsNullable(false).build();</span>
<span class="fc" id="L1784">    VarcharColumnDef nameCol = newVarcharColumnDefBuilder(&quot;name&quot;).setLimit(100).setIsNullable(false).build();</span>
<span class="fc" id="L1785">    VarcharColumnDef tokenHashCol = newVarcharColumnDefBuilder(&quot;token_hash&quot;).setLimit(255).setIsNullable(false).build();</span>
<span class="fc" id="L1786">    VarcharColumnDef typeCol = newVarcharColumnDefBuilder(&quot;type&quot;).setLimit(100).setIsNullable(false).build();</span>
<span class="fc" id="L1787">    context.execute(</span>
<span class="fc" id="L1788">      newTableBuilder(tableName)</span>
<span class="fc" id="L1789">        .addPkColumn(UUID_COL)</span>
<span class="fc" id="L1790">        .addColumn(userUuidCol)</span>
<span class="fc" id="L1791">        .addColumn(nameCol)</span>
<span class="fc" id="L1792">        .addColumn(tokenHashCol)</span>
<span class="fc" id="L1793">        .addColumn(newBigIntegerColumnDefBuilder().setColumnName(&quot;last_connection_date&quot;).setIsNullable(true).build())</span>
<span class="fc" id="L1794">        .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L1795">        .addColumn(typeCol)</span>
<span class="fc" id="L1796">        .addColumn(newBigIntegerColumnDefBuilder().setColumnName(EXPIRATION_DATE_COL_NAME).setIsNullable(true).build())</span>
<span class="fc" id="L1797">        .addColumn(newVarcharColumnDefBuilder().setColumnName(&quot;project_uuid&quot;).setIsNullable(true).setLimit(UUID_SIZE).build())</span>
<span class="fc" id="L1798">        .build());</span>
<span class="fc" id="L1799">    addIndex(context, tableName, &quot;user_tokens_user_uuid_name&quot;, true, userUuidCol, nameCol);</span>
<span class="fc" id="L1800">    addIndex(context, tableName, &quot;user_tokens_token_hash&quot;, true, tokenHashCol);</span>
<span class="fc" id="L1801">  }</span>

  private void createUsers(Context context) {
<span class="fc" id="L1804">    String tableName = &quot;users&quot;;</span>
<span class="fc" id="L1805">    VarcharColumnDef loginCol = newVarcharColumnDefBuilder(&quot;login&quot;).setLimit(255).setIsNullable(false).build();</span>
<span class="fc" id="L1806">    VarcharColumnDef externalLoginCol = newVarcharColumnDefBuilder(&quot;external_login&quot;).setLimit(255).setIsNullable(false).build();</span>
<span class="fc" id="L1807">    VarcharColumnDef externalIdentityProviderCol = newVarcharColumnDefBuilder(&quot;external_identity_provider&quot;).setLimit(100).setIsNullable(false).build();</span>
<span class="fc" id="L1808">    VarcharColumnDef externalIdCol = newVarcharColumnDefBuilder(&quot;external_id&quot;).setLimit(255).setIsNullable(false).build();</span>
<span class="fc" id="L1809">    VarcharColumnDef emailColumn = newVarcharColumnDefBuilder(&quot;email&quot;).setLimit(100).setIsNullable(true).build();</span>
<span class="fc" id="L1810">    context.execute(</span>
<span class="fc" id="L1811">      newTableBuilder(tableName)</span>
<span class="fc" id="L1812">        .addPkColumn(newVarcharColumnDefBuilder(&quot;uuid&quot;).setLimit(USER_UUID_SIZE).setIsNullable(false).build())</span>
<span class="fc" id="L1813">        .addColumn(loginCol)</span>
<span class="fc" id="L1814">        .addColumn(newVarcharColumnDefBuilder(&quot;name&quot;).setLimit(200).setIsNullable(true).build())</span>
<span class="fc" id="L1815">        .addColumn(emailColumn)</span>
<span class="fc" id="L1816">        .addColumn(newVarcharColumnDefBuilder(&quot;crypted_password&quot;).setLimit(100).setIsNullable(true).build())</span>
<span class="fc" id="L1817">        .addColumn(newVarcharColumnDefBuilder(&quot;salt&quot;).setLimit(40).setIsNullable(true).build())</span>
<span class="fc" id="L1818">        .addColumn(newVarcharColumnDefBuilder(&quot;hash_method&quot;).setLimit(10).setIsNullable(true).build())</span>
<span class="fc" id="L1819">        .addColumn(newBooleanColumnDefBuilder().setColumnName(&quot;active&quot;).setDefaultValue(true).setIsNullable(true).build())</span>
<span class="fc" id="L1820">        .addColumn(externalLoginCol)</span>
<span class="fc" id="L1821">        .addColumn(externalIdentityProviderCol)</span>
<span class="fc" id="L1822">        .addColumn(externalIdCol)</span>
<span class="fc" id="L1823">        .addColumn(newBooleanColumnDefBuilder().setColumnName(&quot;user_local&quot;).setIsNullable(false).build())</span>
<span class="fc" id="L1824">        .addColumn(newVarcharColumnDefBuilder(&quot;homepage_type&quot;).setLimit(40).setIsNullable(true).build())</span>
<span class="fc" id="L1825">        .addColumn(newVarcharColumnDefBuilder(&quot;homepage_parameter&quot;).setLimit(40).setIsNullable(true).build())</span>
<span class="fc" id="L1826">        .addColumn(newBigIntegerColumnDefBuilder().setColumnName(&quot;last_connection_date&quot;).setIsNullable(true).build())</span>
<span class="fc" id="L1827">        .addColumn(NULLABLE_TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L1828">        .addColumn(NULLABLE_TECHNICAL_UPDATED_AT_COL)</span>
<span class="fc" id="L1829">        .addColumn(newBooleanColumnDefBuilder().setColumnName(&quot;reset_password&quot;).setIsNullable(false).build())</span>
<span class="fc" id="L1830">        .addColumn(newBigIntegerColumnDefBuilder().setColumnName(&quot;last_sonarlint_connection&quot;).setIsNullable(true).build())</span>
<span class="fc" id="L1831">        .build());</span>

<span class="fc" id="L1833">    addIndex(context, tableName, &quot;users_login&quot;, true, loginCol);</span>
<span class="fc" id="L1834">    addIndex(context, tableName, &quot;users_updated_at&quot;, false, NULLABLE_TECHNICAL_UPDATED_AT_COL);</span>
<span class="fc" id="L1835">    addIndex(context, tableName, &quot;uniq_external_id&quot;, true, externalIdentityProviderCol, externalIdCol);</span>
<span class="fc" id="L1836">    addIndex(context, tableName, &quot;uniq_external_login&quot;, true, externalIdentityProviderCol, externalLoginCol);</span>
<span class="fc" id="L1837">    addIndex(context, tableName, &quot;users_email&quot;, false, emailColumn);</span>
<span class="fc" id="L1838">  }</span>

  private void createWebhookDeliveries(Context context) {
<span class="fc" id="L1841">    String tableName = &quot;webhook_deliveries&quot;;</span>
<span class="fc" id="L1842">    VarcharColumnDef projectUuidColumn = newVarcharColumnDefBuilder(&quot;project_uuid&quot;).setLimit(UUID_SIZE).setIsNullable(false).build();</span>
<span class="fc" id="L1843">    VarcharColumnDef ceTaskUuidColumn = newVarcharColumnDefBuilder(&quot;ce_task_uuid&quot;).setLimit(UUID_SIZE).setIsNullable(true).build();</span>
<span class="fc" id="L1844">    VarcharColumnDef webhookUuidColumn = newVarcharColumnDefBuilder(&quot;webhook_uuid&quot;).setLimit(UUID_SIZE).setIsNullable(false).build();</span>
<span class="fc" id="L1845">    context.execute(newTableBuilder(tableName)</span>
<span class="fc" id="L1846">      .addPkColumn(UUID_COL)</span>
<span class="fc" id="L1847">      .addColumn(webhookUuidColumn)</span>
<span class="fc" id="L1848">      .addColumn(projectUuidColumn)</span>
<span class="fc" id="L1849">      .addColumn(ceTaskUuidColumn)</span>
<span class="fc" id="L1850">      .addColumn(newVarcharColumnDefBuilder(ANALYSIS_UUID_COL_NAME).setLimit(UUID_SIZE).setIsNullable(true).build())</span>
<span class="fc" id="L1851">      .addColumn(newVarcharColumnDefBuilder(&quot;name&quot;).setLimit(100).setIsNullable(false).build())</span>
<span class="fc" id="L1852">      .addColumn(newVarcharColumnDefBuilder(&quot;url&quot;).setLimit(2_000).setIsNullable(false).build())</span>
<span class="fc" id="L1853">      .addColumn(newBooleanColumnDefBuilder().setColumnName(&quot;success&quot;).setIsNullable(false).build())</span>
<span class="fc" id="L1854">      .addColumn(newIntegerColumnDefBuilder().setColumnName(&quot;http_status&quot;).setIsNullable(true).build())</span>
<span class="fc" id="L1855">      .addColumn(newBigIntegerColumnDefBuilder().setColumnName(&quot;duration_ms&quot;).setIsNullable(false).build())</span>
<span class="fc" id="L1856">      .addColumn(newClobColumnDefBuilder().setColumnName(&quot;payload&quot;).setIsNullable(false).build())</span>
<span class="fc" id="L1857">      .addColumn(newClobColumnDefBuilder().setColumnName(&quot;error_stacktrace&quot;).setIsNullable(true).build())</span>
<span class="fc" id="L1858">      .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L1859">      .build());</span>

<span class="fc" id="L1861">    addIndex(context, tableName, &quot;wd_webhook_uuid_created_at&quot;, false, webhookUuidColumn, TECHNICAL_CREATED_AT_COL);</span>
<span class="fc" id="L1862">    addIndex(context, tableName, &quot;wd_project_uuid_created_at&quot;, false, projectUuidColumn, TECHNICAL_CREATED_AT_COL);</span>
<span class="fc" id="L1863">    addIndex(context, tableName, &quot;wd_ce_task_uuid_created_at&quot;, false, ceTaskUuidColumn, TECHNICAL_CREATED_AT_COL);</span>
<span class="fc" id="L1864">    addIndex(context, tableName, &quot;wd_created_at&quot;, false, TECHNICAL_CREATED_AT_COL);</span>
<span class="fc" id="L1865">  }</span>

  private void createWebhooks(Context context) {
<span class="fc" id="L1868">    String tableName = &quot;webhooks&quot;;</span>
<span class="fc" id="L1869">    VarcharColumnDef projectUuidCol = newVarcharColumnDefBuilder(PROJECT_UUID_COL_NAME).setLimit(UUID_SIZE).setIsNullable(true).build();</span>
<span class="fc" id="L1870">    context.execute(newTableBuilder(tableName)</span>
<span class="fc" id="L1871">      .addPkColumn(UUID_COL)</span>
<span class="fc" id="L1872">      .addColumn(projectUuidCol)</span>
<span class="fc" id="L1873">      .addColumn(newVarcharColumnDefBuilder(&quot;name&quot;).setLimit(100).setIsNullable(false).build())</span>
<span class="fc" id="L1874">      .addColumn(newVarcharColumnDefBuilder(&quot;url&quot;).setLimit(2_000).setIsNullable(false).build())</span>
<span class="fc" id="L1875">      .addColumn(newVarcharColumnDefBuilder(&quot;secret&quot;).setLimit(200).setIsNullable(true).build())</span>
<span class="fc" id="L1876">      .addColumn(TECHNICAL_CREATED_AT_COL)</span>
<span class="fc" id="L1877">      .addColumn(NULLABLE_TECHNICAL_UPDATED_AT_COL)</span>
<span class="fc" id="L1878">      .build());</span>
<span class="fc" id="L1879">  }</span>

  private void addIndex(Context context, String table, String index, boolean unique, ColumnDef firstColumn, ColumnDef... otherColumns) {
<span class="fc" id="L1882">    CreateIndexBuilder builder = new CreateIndexBuilder(getDialect())</span>
<span class="fc" id="L1883">      .setTable(table)</span>
<span class="fc" id="L1884">      .setName(index)</span>
<span class="fc" id="L1885">      .setUnique(unique);</span>
<span class="fc" id="L1886">    concat(of(firstColumn), stream(otherColumns)).forEach(builder::addColumn);</span>
<span class="fc" id="L1887">    context.execute(builder.build());</span>
<span class="fc" id="L1888">  }</span>

  private CreateTableBuilder newTableBuilder(String tableName) {
<span class="fc" id="L1891">    return new CreateTableBuilder(getDialect(), tableName);</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>