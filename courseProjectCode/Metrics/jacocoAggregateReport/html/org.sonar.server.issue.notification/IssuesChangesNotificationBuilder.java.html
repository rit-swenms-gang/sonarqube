<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>IssuesChangesNotificationBuilder.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">sonarqube</a> &gt; <a href="index.source.html" class="el_package">org.sonar.server.issue.notification</a> &gt; <span class="el_source">IssuesChangesNotificationBuilder.java</span></div><h1>IssuesChangesNotificationBuilder.java</h1><pre class="source lang-java linenums">/*
 * SonarQube
 * Copyright (C) 2009-2025 SonarSource SA
 * mailto:info AT sonarsource DOT com
 *
 * This program is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 3 of the License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public License
 * along with this program; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
 */
package org.sonar.server.issue.notification;

import com.google.common.collect.ImmutableSet;
import java.util.Objects;
import java.util.Optional;
import java.util.Set;
import javax.annotation.CheckForNull;
import javax.annotation.Nullable;
import javax.annotation.concurrent.Immutable;
import org.sonar.api.issue.IssueStatus;
import org.sonar.api.rule.RuleKey;
import org.sonar.core.rule.RuleType;

import static com.google.common.base.Preconditions.checkArgument;
import static java.util.Objects.requireNonNull;
import static java.util.Optional.ofNullable;

@Immutable
public class IssuesChangesNotificationBuilder {

  private static final String KEY_CANT_BE_NULL_MESSAGE = &quot;key can't be null&quot;;
  private final Set&lt;ChangedIssue&gt; issues;
  private final Change change;

<span class="fc" id="L44">  public IssuesChangesNotificationBuilder(Set&lt;ChangedIssue&gt; issues, Change change) {</span>
<span class="fc bfc" id="L45" title="All 2 branches covered.">    checkArgument(!issues.isEmpty(), &quot;issues can't be empty&quot;);</span>

<span class="fc" id="L47">    this.issues = ImmutableSet.copyOf(issues);</span>
<span class="fc" id="L48">    this.change = requireNonNull(change, &quot;change can't be null&quot;);</span>
<span class="fc" id="L49">  }</span>

  public Set&lt;ChangedIssue&gt; getIssues() {
<span class="fc" id="L52">    return issues;</span>
  }

  public Change getChange() {
<span class="fc" id="L56">    return change;</span>
  }

  @Immutable
  public static final class ChangedIssue {
    private final String key;
    private final String newStatus;
    private final IssueStatus newIssueStatus;
    @CheckForNull
    private final User assignee;
    private final Rule rule;
    private final Project project;
    private final IssueStatus oldIssueStatus;

<span class="fc" id="L70">    public ChangedIssue(Builder builder) {</span>
<span class="fc" id="L71">      this.key = requireNonNull(builder.key, KEY_CANT_BE_NULL_MESSAGE);</span>
<span class="fc" id="L72">      this.newStatus = requireNonNull(builder.newStatus, &quot;newStatus can't be null&quot;);</span>
<span class="fc" id="L73">      this.newIssueStatus = builder.newIssueStatus;</span>
<span class="fc" id="L74">      this.oldIssueStatus = builder.oldIssueStatus;</span>
<span class="fc" id="L75">      this.assignee = builder.assignee;</span>
<span class="fc" id="L76">      this.rule = requireNonNull(builder.rule, &quot;rule can't be null&quot;);</span>
<span class="fc" id="L77">      this.project = requireNonNull(builder.project, &quot;project can't be null&quot;);</span>
<span class="fc" id="L78">    }</span>

    public String getKey() {
<span class="fc" id="L81">      return key;</span>
    }

    public String getNewStatus() {
<span class="fc" id="L85">      return newStatus;</span>
    }

    public Optional&lt;IssueStatus&gt; getNewIssueStatus() {
<span class="fc" id="L89">      return ofNullable(newIssueStatus);</span>
    }

    public Optional&lt;IssueStatus&gt; getOldIssueStatus() {
<span class="fc" id="L93">      return ofNullable(oldIssueStatus);</span>
    }

    public Optional&lt;User&gt; getAssignee() {
<span class="fc" id="L97">      return ofNullable(assignee);</span>
    }

    public Rule getRule() {
<span class="fc" id="L101">      return rule;</span>
    }

    public Project getProject() {
<span class="fc" id="L105">      return project;</span>
    }

    public static class Builder {
      private final String key;
      @CheckForNull
      private IssueStatus newIssueStatus;
      @CheckForNull
      private IssueStatus oldIssueStatus;
      private String newStatus;
      @CheckForNull
      private User assignee;
      private Rule rule;
      private Project project;

<span class="fc" id="L120">      public Builder(String key) {</span>
<span class="fc" id="L121">        this.key = key;</span>
<span class="fc" id="L122">      }</span>

      public Builder setNewStatus(String newStatus) {
<span class="fc" id="L125">        this.newStatus = newStatus;</span>
<span class="fc" id="L126">        return this;</span>
      }

      public Builder setAssignee(@Nullable User assignee) {
<span class="fc" id="L130">        this.assignee = assignee;</span>
<span class="fc" id="L131">        return this;</span>
      }

      public Builder setNewIssueStatus(@Nullable IssueStatus newIssueStatus) {
<span class="fc" id="L135">        this.newIssueStatus = newIssueStatus;</span>
<span class="fc" id="L136">        return this;</span>
      }

      public Builder setOldIssueStatus(@Nullable IssueStatus oldIssueStatus) {
<span class="fc" id="L140">        this.oldIssueStatus = oldIssueStatus;</span>
<span class="fc" id="L141">        return this;</span>
      }

      public Builder setRule(Rule rule) {
<span class="fc" id="L145">        this.rule = rule;</span>
<span class="fc" id="L146">        return this;</span>
      }

      public Builder setProject(Project project) {
<span class="fc" id="L150">        this.project = project;</span>
<span class="fc" id="L151">        return this;</span>
      }

      public ChangedIssue build() {
<span class="fc" id="L155">        return new ChangedIssue(this);</span>
      }
    }

    @Override
    public boolean equals(Object o) {
<span class="fc bfc" id="L161" title="All 2 branches covered.">      if (this == o) {</span>
<span class="fc" id="L162">        return true;</span>
      }
<span class="fc bfc" id="L164" title="All 4 branches covered.">      if (o == null || getClass() != o.getClass()) {</span>
<span class="fc" id="L165">        return false;</span>
      }
<span class="fc" id="L167">      ChangedIssue that = (ChangedIssue) o;</span>
<span class="fc bfc" id="L168" title="All 2 branches covered.">      return key.equals(that.key) &amp;&amp;</span>
<span class="fc bfc" id="L169" title="All 4 branches covered.">        newStatus.equals(that.newStatus) &amp;&amp;</span>
        newIssueStatus == that.newIssueStatus &amp;&amp;
<span class="fc bfc" id="L171" title="All 2 branches covered.">        Objects.equals(assignee, that.assignee) &amp;&amp;</span>
<span class="fc bfc" id="L172" title="All 2 branches covered.">        rule.equals(that.rule) &amp;&amp;</span>
<span class="pc bpc" id="L173" title="1 of 2 branches missed.">        project.equals(that.project);</span>
    }

    @Override
    public int hashCode() {
<span class="fc" id="L178">      return Objects.hash(key, newStatus, newIssueStatus, assignee, rule, project);</span>
    }

    @Override
    public String toString() {
<span class="fc" id="L183">      return &quot;ChangedIssue{&quot; +</span>
        &quot;key='&quot; + key + '\'' +
        &quot;, newStatus='&quot; + newStatus + '\'' +
        &quot;, newIssueStatus='&quot; + newIssueStatus + '\'' +
        &quot;, assignee=&quot; + assignee +
        &quot;, rule=&quot; + rule +
        &quot;, project=&quot; + project +
        '}';
    }
  }

  public static final class User {
    private final String uuid;
    private final String login;
    @CheckForNull
    private final String name;

<span class="fc" id="L200">    public User(String uuid, String login, @Nullable String name) {</span>
<span class="fc" id="L201">      this.uuid = requireNonNull(uuid, &quot;uuid can't be null&quot;);</span>
<span class="fc" id="L202">      this.login = requireNonNull(login, &quot;login can't be null&quot;);</span>
<span class="fc" id="L203">      this.name = name;</span>
<span class="fc" id="L204">    }</span>

    public String getUuid() {
<span class="fc" id="L207">      return uuid;</span>
    }

    public String getLogin() {
<span class="fc" id="L211">      return login;</span>
    }

    public Optional&lt;String&gt; getName() {
<span class="fc" id="L215">      return ofNullable(name);</span>
    }

    @Override
    public String toString() {
<span class="fc" id="L220">      return &quot;User{&quot; +</span>
        &quot;uuid='&quot; + uuid + '\'' +
        &quot;, login='&quot; + login + '\'' +
        &quot;, name='&quot; + name + '\'' +
        '}';
    }

    @Override
    public boolean equals(Object o) {
<span class="fc bfc" id="L229" title="All 2 branches covered.">      if (this == o) {</span>
<span class="fc" id="L230">        return true;</span>
      }
<span class="pc bpc" id="L232" title="2 of 4 branches missed.">      if (o == null || getClass() != o.getClass()) {</span>
<span class="nc" id="L233">        return false;</span>
      }
<span class="fc" id="L235">      User user = (User) o;</span>
<span class="fc bfc" id="L236" title="All 2 branches covered.">      return uuid.equals(user.uuid) &amp;&amp;</span>
<span class="pc bpc" id="L237" title="1 of 2 branches missed.">        login.equals(user.login) &amp;&amp;</span>
<span class="pc bpc" id="L238" title="1 of 2 branches missed.">        Objects.equals(name, user.name);</span>
    }

    @Override
    public int hashCode() {
<span class="fc" id="L243">      return Objects.hash(uuid, login, name);</span>
    }
  }

  @Immutable
  public static final class Rule {
    private final RuleKey key;
    private final RuleType ruleType;
    private final String name;

    public Rule(RuleKey key, @Nullable String ruleType, String name) {
<span class="fc bfc" id="L254" title="All 2 branches covered.">      this(key, ruleType != null ? RuleType.valueOf(ruleType) : null, name);</span>
<span class="fc" id="L255">    }</span>

<span class="fc" id="L257">    public Rule(RuleKey key, @Nullable RuleType ruleType, String name) {</span>
<span class="fc" id="L258">      this.key = requireNonNull(key, KEY_CANT_BE_NULL_MESSAGE);</span>
<span class="fc" id="L259">      this.ruleType = ruleType;</span>
<span class="fc" id="L260">      this.name = requireNonNull(name, &quot;name can't be null&quot;);</span>
<span class="fc" id="L261">    }</span>

    public RuleKey getKey() {
<span class="fc" id="L264">      return key;</span>
    }

    @CheckForNull
    public RuleType getRuleType() {
<span class="fc" id="L269">      return ruleType;</span>
    }

    public String getName() {
<span class="fc" id="L273">      return name;</span>
    }

    @Override
    public boolean equals(Object o) {
<span class="fc bfc" id="L278" title="All 2 branches covered.">      if (this == o) {</span>
<span class="fc" id="L279">        return true;</span>
      }
<span class="fc bfc" id="L281" title="All 4 branches covered.">      if (o == null || getClass() != o.getClass()) {</span>
<span class="fc" id="L282">        return false;</span>
      }
<span class="fc" id="L284">      Rule that = (Rule) o;</span>
<span class="fc bfc" id="L285" title="All 6 branches covered.">      return key.equals(that.key) &amp;&amp; ruleType == that.ruleType &amp;&amp; name.equals(that.name);</span>
    }

    @Override
    public int hashCode() {
<span class="fc" id="L290">      return Objects.hash(key, ruleType, name);</span>
    }

    @Override
    public String toString() {
<span class="fc" id="L295">      return &quot;Rule{&quot; +</span>
        &quot;key=&quot; + key +
        &quot;, type=&quot; + ruleType +
        &quot;, name='&quot; + name + '\'' +
        '}';
    }
  }

  @Immutable
  public static final class Project {
    private final String uuid;
    private final String key;
    private final String projectName;
    @Nullable
    private final String branchName;

<span class="fc" id="L311">    public Project(Builder builder) {</span>
<span class="fc" id="L312">      this.uuid = requireNonNull(builder.uuid, &quot;uuid can't be null&quot;);</span>
<span class="fc" id="L313">      this.key = requireNonNull(builder.key, KEY_CANT_BE_NULL_MESSAGE);</span>
<span class="fc" id="L314">      this.projectName = requireNonNull(builder.projectName, &quot;projectName can't be null&quot;);</span>
<span class="fc" id="L315">      this.branchName = builder.branchName;</span>
<span class="fc" id="L316">    }</span>

    public String getUuid() {
<span class="fc" id="L319">      return uuid;</span>
    }

    public String getKey() {
<span class="fc" id="L323">      return key;</span>
    }

    public String getProjectName() {
<span class="fc" id="L327">      return projectName;</span>
    }

    public Optional&lt;String&gt; getBranchName() {
<span class="fc" id="L331">      return ofNullable(branchName);</span>
    }

    @Override
    public boolean equals(Object o) {
<span class="fc bfc" id="L336" title="All 2 branches covered.">      if (this == o) {</span>
<span class="fc" id="L337">        return true;</span>
      }
<span class="fc bfc" id="L339" title="All 4 branches covered.">      if (o == null || getClass() != o.getClass()) {</span>
<span class="fc" id="L340">        return false;</span>
      }
<span class="fc" id="L342">      Project project = (Project) o;</span>
<span class="fc bfc" id="L343" title="All 2 branches covered.">      return uuid.equals(project.uuid) &amp;&amp;</span>
<span class="fc bfc" id="L344" title="All 2 branches covered.">        key.equals(project.key) &amp;&amp;</span>
<span class="fc bfc" id="L345" title="All 2 branches covered.">        projectName.equals(project.projectName) &amp;&amp;</span>
<span class="fc bfc" id="L346" title="All 2 branches covered.">        Objects.equals(branchName, project.branchName);</span>
    }

    @Override
    public int hashCode() {
<span class="fc" id="L351">      return Objects.hash(uuid, key, projectName, branchName);</span>
    }

    @Override
    public String toString() {
<span class="fc" id="L356">      return &quot;Project{&quot; +</span>
        &quot;uuid='&quot; + uuid + '\'' +
        &quot;, key='&quot; + key + '\'' +
        &quot;, projectName='&quot; + projectName + '\'' +
        &quot;, branchName='&quot; + branchName + '\'' +
        '}';
    }

    public static class Builder {
      private final String uuid;
      private String key;
      private String projectName;
      @CheckForNull
      private String branchName;

<span class="fc" id="L371">      public Builder(String uuid) {</span>
<span class="fc" id="L372">        this.uuid = uuid;</span>
<span class="fc" id="L373">      }</span>

      public Builder setKey(String key) {
<span class="fc" id="L376">        this.key = key;</span>
<span class="fc" id="L377">        return this;</span>
      }

      public Builder setProjectName(String projectName) {
<span class="fc" id="L381">        this.projectName = projectName;</span>
<span class="fc" id="L382">        return this;</span>
      }

      public Builder setBranchName(@Nullable String branchName) {
<span class="fc" id="L386">        this.branchName = branchName;</span>
<span class="fc" id="L387">        return this;</span>
      }

      public Project build() {
<span class="fc" id="L391">        return new Project(this);</span>
      }
    }
  }

  public abstract static class Change {
    protected final long date;

<span class="fc" id="L399">    private Change(long date) {</span>
<span class="fc" id="L400">      this.date = date;</span>
<span class="fc" id="L401">    }</span>

    public long getDate() {
<span class="fc" id="L404">      return date;</span>
    }

    public abstract boolean isAuthorLogin(String login);
  }

  @Immutable
  public static final class AnalysisChange extends Change {
    public AnalysisChange(long date) {
<span class="fc" id="L413">      super(date);</span>
<span class="fc" id="L414">    }</span>

    @Override
    public boolean isAuthorLogin(String login) {
<span class="fc" id="L418">      return false;</span>
    }

    @Override
    public boolean equals(Object o) {
<span class="fc bfc" id="L423" title="All 2 branches covered.">      if (this == o) {</span>
<span class="fc" id="L424">        return true;</span>
      }
<span class="pc bpc" id="L426" title="1 of 4 branches missed.">      if (o == null || getClass() != o.getClass()) {</span>
<span class="fc" id="L427">        return false;</span>
      }
<span class="fc" id="L429">      Change change = (Change) o;</span>
<span class="fc bfc" id="L430" title="All 2 branches covered.">      return date == change.date;</span>
    }

    @Override
    public int hashCode() {
<span class="fc" id="L435">      return Objects.hash(date);</span>
    }

    @Override
    public String toString() {
<span class="fc" id="L440">      return &quot;AnalysisChange{&quot; + date + '}';</span>
    }
  }

  @Immutable
  public static final class UserChange extends Change {
    private final User user;

    public UserChange(long date, User user) {
<span class="fc" id="L449">      super(date);</span>
<span class="fc" id="L450">      this.user = requireNonNull(user, &quot;user can't be null&quot;);</span>
<span class="fc" id="L451">    }</span>

    public User getUser() {
<span class="fc" id="L454">      return user;</span>
    }

    @Override
    public boolean isAuthorLogin(String login) {
<span class="fc" id="L459">      return this.user.login.equals(login);</span>
    }

    @Override
    public boolean equals(Object o) {
<span class="fc bfc" id="L464" title="All 2 branches covered.">      if (this == o) {</span>
<span class="fc" id="L465">        return true;</span>
      }
<span class="fc bfc" id="L467" title="All 4 branches covered.">      if (o == null || getClass() != o.getClass()) {</span>
<span class="fc" id="L468">        return false;</span>
      }
<span class="fc" id="L470">      UserChange that = (UserChange) o;</span>
<span class="pc bpc" id="L471" title="1 of 4 branches missed.">      return date == that.date &amp;&amp; user.equals(that.user);</span>
    }

    @Override
    public int hashCode() {
<span class="fc" id="L476">      return Objects.hash(user, date);</span>
    }

    @Override
    public String toString() {
<span class="fc" id="L481">      return &quot;UserChange{&quot; +</span>
        &quot;date=&quot; + date +
        &quot;, user=&quot; + user +
        '}';
    }
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>