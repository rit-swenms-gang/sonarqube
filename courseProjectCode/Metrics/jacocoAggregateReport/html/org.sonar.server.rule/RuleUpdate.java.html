<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RuleUpdate.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">sonarqube</a> &gt; <a href="index.source.html" class="el_package">org.sonar.server.rule</a> &gt; <span class="el_source">RuleUpdate.java</span></div><h1>RuleUpdate.java</h1><pre class="source lang-java linenums">/*
 * SonarQube
 * Copyright (C) 2009-2025 SonarSource SA
 * mailto:info AT sonarsource DOT com
 *
 * This program is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 3 of the License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public License
 * along with this program; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
 */
package org.sonar.server.rule;

import java.util.EnumMap;
import java.util.HashMap;
import java.util.Map;
import java.util.Set;
import javax.annotation.CheckForNull;
import javax.annotation.Nullable;
import org.apache.commons.lang3.StringUtils;
import org.sonar.api.issue.impact.Severity;
import org.sonar.api.issue.impact.SoftwareQuality;
import org.sonar.api.rule.RuleKey;
import org.sonar.api.rule.RuleStatus;
import org.sonar.api.server.debt.DebtRemediationFunction;

import static com.google.common.base.Preconditions.checkArgument;
import static org.sonar.server.rule.RuleUpdate.RuleUpdateUseCase.CUSTOM_RULE;
import static org.sonar.server.rule.RuleUpdate.RuleUpdateUseCase.PLUGIN_RULE;

public class RuleUpdate {

  private final RuleKey ruleKey;

<span class="fc" id="L43">  private boolean changeTags = false;</span>
<span class="fc" id="L44">  private boolean changeMarkdownNote = false;</span>
<span class="fc" id="L45">  private boolean changeDebtRemediationFunction = false;</span>
<span class="fc" id="L46">  private boolean changeName = false;</span>
<span class="fc" id="L47">  private boolean changeDescription = false;</span>
<span class="fc" id="L48">  private boolean changeSeverity = false;</span>
<span class="fc" id="L49">  private boolean changeImpacts = false;</span>
<span class="fc" id="L50">  private boolean changeStatus = false;</span>
<span class="fc" id="L51">  private boolean changeParameters = false;</span>
  private final RuleUpdateUseCase useCase;
  private Set&lt;String&gt; tags;
  private String markdownNote;
  private DebtRemediationFunction debtRemediationFunction;

  private String name;
  private String markdownDescription;
  private String severity;
<span class="fc" id="L60">  private final Map&lt;SoftwareQuality, Severity&gt; impactSeverities = new EnumMap&lt;&gt;(SoftwareQuality.class);</span>
  private RuleStatus status;
<span class="fc" id="L62">  private final Map&lt;String, String&gt; parameters = new HashMap&lt;&gt;();</span>

<span class="fc" id="L64">  private RuleUpdate(RuleKey ruleKey, RuleUpdateUseCase useCase) {</span>
<span class="fc" id="L65">    this.ruleKey = ruleKey;</span>
<span class="fc" id="L66">    this.useCase = useCase;</span>
<span class="fc" id="L67">  }</span>

  public RuleKey getRuleKey() {
<span class="fc" id="L70">    return ruleKey;</span>
  }

  @CheckForNull
  public Set&lt;String&gt; getTags() {
<span class="fc" id="L75">    return tags;</span>
  }

  /**
   * Set to &lt;code&gt;null&lt;/code&gt; or empty set to remove existing tags.
   */
  public RuleUpdate setTags(@Nullable Set&lt;String&gt; tags) {
<span class="fc" id="L82">    this.tags = tags;</span>
<span class="fc" id="L83">    this.changeTags = true;</span>
<span class="fc" id="L84">    return this;</span>
  }

  @CheckForNull
  public String getMarkdownNote() {
<span class="fc" id="L89">    return markdownNote;</span>
  }

  /**
   * Set to &lt;code&gt;null&lt;/code&gt; or blank to remove existing note.
   */
  public RuleUpdate setMarkdownNote(@Nullable String s) {
<span class="fc bfc" id="L96" title="All 2 branches covered.">    this.markdownNote = s == null ? null : StringUtils.defaultIfBlank(s, null);</span>
<span class="fc" id="L97">    this.changeMarkdownNote = true;</span>
<span class="fc" id="L98">    return this;</span>
  }

  @CheckForNull
  public DebtRemediationFunction getDebtRemediationFunction() {
<span class="fc" id="L103">    return debtRemediationFunction;</span>
  }

  public RuleUpdate setDebtRemediationFunction(@Nullable DebtRemediationFunction fn) {
<span class="fc" id="L107">    this.debtRemediationFunction = fn;</span>
<span class="fc" id="L108">    this.changeDebtRemediationFunction = true;</span>
<span class="fc" id="L109">    return this;</span>
  }

  @CheckForNull
  public String getName() {
<span class="fc" id="L114">    return name;</span>
  }

  public RuleUpdate setName(@Nullable String name) {
<span class="fc" id="L118">    checkCustomRule();</span>
<span class="fc" id="L119">    this.name = name;</span>
<span class="fc" id="L120">    this.changeName = true;</span>
<span class="fc" id="L121">    return this;</span>
  }

  @CheckForNull
  public String getMarkdownDescription() {
<span class="fc" id="L126">    return markdownDescription;</span>
  }

  public RuleUpdate setMarkdownDescription(@Nullable String markdownDescription) {
<span class="fc" id="L130">    checkCustomRule();</span>
<span class="fc" id="L131">    this.markdownDescription = markdownDescription;</span>
<span class="fc" id="L132">    this.changeDescription = true;</span>
<span class="fc" id="L133">    return this;</span>
  }

  @CheckForNull
  public String getSeverity() {
<span class="fc" id="L138">    return severity;</span>
  }

  public RuleUpdate setSeverity(@Nullable String severity) {
<span class="fc" id="L142">    checkCustomRule();</span>
<span class="fc" id="L143">    this.severity = severity;</span>
<span class="fc" id="L144">    this.changeSeverity = true;</span>
<span class="fc" id="L145">    return this;</span>
  }

  public Map&lt;SoftwareQuality, Severity&gt; getImpactSeverities() {
<span class="fc" id="L149">    return impactSeverities;</span>
  }

  /**
   * Impacts to be updated (only for custom rules)
   */
  public RuleUpdate setImpactSeverities(Map&lt;SoftwareQuality, Severity&gt; impactSeverities) {
<span class="fc" id="L156">    checkCustomRule();</span>
<span class="fc" id="L157">    this.impactSeverities.clear();</span>
<span class="fc" id="L158">    this.impactSeverities.putAll(impactSeverities);</span>
<span class="fc" id="L159">    changeImpacts = true;</span>
<span class="fc" id="L160">    return this;</span>
  }

  @CheckForNull
  public RuleStatus getStatus() {
<span class="fc" id="L165">    return status;</span>
  }

  public RuleUpdate setStatus(@Nullable RuleStatus status) {
<span class="fc" id="L169">    checkCustomRule();</span>
<span class="fc" id="L170">    this.status = status;</span>
<span class="fc" id="L171">    this.changeStatus = true;</span>
<span class="fc" id="L172">    return this;</span>
  }

  /**
   * Parameters to be updated (only for custom rules)
   */
  public RuleUpdate setParameters(Map&lt;String, String&gt; params) {
<span class="fc" id="L179">    checkCustomRule();</span>
<span class="fc" id="L180">    this.parameters.clear();</span>
<span class="fc" id="L181">    this.parameters.putAll(params);</span>
<span class="fc" id="L182">    this.changeParameters = true;</span>
<span class="fc" id="L183">    return this;</span>
  }

  public Map&lt;String, String&gt; getParameters() {
<span class="nc" id="L187">    return parameters;</span>
  }

  @CheckForNull
  public String parameter(final String paramKey) {
<span class="fc" id="L192">    return parameters.get(paramKey);</span>
  }

  boolean isCustomRule() {
<span class="fc" id="L196">    return useCase.isCustomRule;</span>
  }

  public boolean isChangeTags() {
<span class="fc" id="L200">    return changeTags;</span>
  }

  public boolean isChangeMarkdownNote() {
<span class="fc" id="L204">    return changeMarkdownNote;</span>
  }

  public boolean isChangeDebtRemediationFunction() {
<span class="fc" id="L208">    return changeDebtRemediationFunction;</span>
  }

  public boolean isChangeName() {
<span class="fc" id="L212">    return changeName;</span>
  }

  public boolean isChangeDescription() {
<span class="fc" id="L216">    return changeDescription;</span>
  }

  public boolean isChangeSeverity() {
<span class="fc" id="L220">    return changeSeverity;</span>
  }

  public boolean isChangeImpacts() {
<span class="fc" id="L224">    return changeImpacts;</span>
  }

  public boolean isChangeStatus() {
<span class="fc" id="L228">    return changeStatus;</span>
  }

  public boolean isChangeParameters() {
<span class="fc" id="L232">    return changeParameters;</span>
  }

  public boolean isEmpty() {
<span class="fc bfc" id="L236" title="All 8 branches covered.">    return !changeMarkdownNote &amp;&amp; !changeTags &amp;&amp; !changeDebtRemediationFunction &amp;&amp; isCustomRuleFieldsEmpty();</span>
  }

  private boolean isCustomRuleFieldsEmpty() {
<span class="pc bpc" id="L240" title="3 of 12 branches missed.">    return !changeName &amp;&amp; !changeDescription &amp;&amp; !changeSeverity &amp;&amp; !changeStatus &amp;&amp; !changeParameters &amp;&amp; !changeImpacts;</span>
  }

  private void checkCustomRule() {
<span class="fc bfc" id="L244" title="All 2 branches covered.">    checkArgument(useCase == CUSTOM_RULE, &quot;Not a custom rule&quot;);</span>
<span class="fc" id="L245">  }</span>

  /**
   * Use to update a rule provided by a plugin (name, description, severity, status and parameters cannot by changed)
   */
  public static RuleUpdate createForPluginRule(RuleKey ruleKey) {
<span class="fc" id="L251">    return new RuleUpdate(ruleKey, PLUGIN_RULE);</span>
  }

  /**
   * Use to update a custom rule
   */
  public static RuleUpdate createForCustomRule(RuleKey ruleKey) {
<span class="fc" id="L258">    return new RuleUpdate(ruleKey, CUSTOM_RULE);</span>
  }

<span class="fc" id="L261">  public enum RuleUpdateUseCase {</span>
<span class="fc" id="L262">    PLUGIN_RULE(false),</span>
<span class="fc" id="L263">    CUSTOM_RULE(true);</span>

    public final boolean isCustomRule;

<span class="fc" id="L267">    RuleUpdateUseCase(boolean isCustomRule) {</span>
<span class="fc" id="L268">      this.isCustomRule = isCustomRule;</span>
<span class="fc" id="L269">    }</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>